var f=Object.defineProperty;var m=(o,e,i)=>e in o?f(o,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):o[e]=i;var t=(o,e,i)=>(m(o,typeof e!="symbol"?e+"":e,i),i);import{a as p,d as n,f as g}from"./tw-merge-ea924f16.js";import{L as w,E as v,C as b}from"./FixImages-3d450d68.js";import{C as y}from"./Constants-89143ec9.js";import{U as c}from"./UIEventSource-e47c8002.js";class L{constructor(e,i){t(this,"icon");t(this,"text");t(this,"href");t(this,"newTab");t(this,"requirements");this.icon=e.icon,this.text=p.T(e.text,"themes:"+i+".text"),this.href=e.href,this.newTab=e.newTab,this.requirements=new Set(e.requirements);for(let a of e.requirements)if(this.requirements.has("no-"+a))throw"Conflicting requirements found for "+i+".extraLink: both '"+a+"' and 'no-"+a+"' found";if(this.icon===void 0&&this.text===void 0)throw"At "+i+".extraLink: define at least an icon or a text to show. Both are undefined, this is not allowed"}}const h=class h{constructor(e,i=!0,a){t(this,"id");t(this,"credits");t(this,"language");t(this,"title");t(this,"shortDescription");t(this,"description");t(this,"descriptionTail");t(this,"icon");t(this,"socialImage");t(this,"startZoom");t(this,"startLat");t(this,"startLon");t(this,"widenFactor");t(this,"defaultBackgroundId");t(this,"layers");t(this,"tileLayerSources");t(this,"hideFromOverview");t(this,"lockLocation");t(this,"enableUserBadge");t(this,"enableShareScreen");t(this,"enableMoreQuests");t(this,"enableAddNewPoints");t(this,"enableLayers");t(this,"enableSearch");t(this,"enableGeolocation");t(this,"enableBackgroundLayerSelection");t(this,"enableShowAllQuestions");t(this,"enableExportButton");t(this,"enablePdfDownload");t(this,"enableTerrain");t(this,"enableMorePrivacy");t(this,"customCss");t(this,"overpassUrl");t(this,"overpassTimeout");t(this,"overpassMaxZoom");t(this,"osmApiTileSize");t(this,"official");t(this,"usedImages");t(this,"extraLink");t(this,"definedAtUrl");t(this,"definitionRaw");t(this,"layersDict");t(this,"source");if(e===void 0)throw"Cannot construct a layout config, the parameter 'json' is undefined";if(this.source=e,this.official=i,this.id=e.id,this.definedAtUrl=a==null?void 0:a.definedAtUrl,this.definitionRaw=a==null?void 0:a.definitionRaw,i){if(e.id.toLowerCase()!==e.id)throw"The id of a theme should be lowercase: "+e.id;if(e.id.match(/[a-z0-9-_]/)==null)throw"The id of a theme should match [a-z0-9-_]*: "+e.id}const r=this.id;if(this.credits=Array.isArray(e.credits)?e.credits.join("; "):e.credits,!e.title)throw`The theme ${e.id} does not have a title defined.`;this.language=e.mustHaveLanguage??Object.keys(e.title);{if(typeof e.title=="string")throw`The title of a theme should always be a translation, as it sets the corresponding languages (${r}.title). The themenID is ${this.id}; the offending object is ${JSON.stringify(e.title)} which is a ${typeof e.title})`;if(this.language.length==0)throw"No languages defined. Define at least one language. You can do this by adding a title";if(e.title===void 0)throw"Title not defined in "+this.id;if(e.description===void 0)throw"Description not defined in "+this.id;if(e.hideInOverview)throw"The json for "+this.id+" contains a 'hideInOverview'. Did you mean hideFromOverview instead?";if(e.layers===void 0)throw"Got undefined layers for "+e.id+" at "+r}if(this.title=new n(e.title,"themes:"+r+".title"),this.description=new n(e.description,"themes:"+r+".description"),this.shortDescription=e.shortDescription===void 0?this.description.FirstSentence():new n(e.shortDescription,"themes:"+r+".shortdescription"),this.descriptionTail=e.descriptionTail===void 0?void 0:new n(e.descriptionTail,"themes:"+r+".descriptionTail"),this.icon=e.icon,this.socialImage=e.socialImage??h.defaultSocialImage,this.socialImage===""&&i)throw"Theme "+e.id+" has empty string as social image";this.startZoom=e.startZoom,this.startLat=e.startLat,this.startLon=e.startLon,this.widenFactor=1.5,this.defaultBackgroundId=e.defaultBackgroundId,this.tileLayerSources=e.tileLayerSources??[],this.layers=e.layers.map(s=>new w(s,e.id+".layers."+s.id,i)),this.extraLink=new L(e.extraLink??{icon:"./assets/svg/pop-out.svg",href:"https://{basepath}/{theme}.html?lat={lat}&lon={lon}&z={zoom}&language={language}",newTab:!0,requirements:["iframe","no-welcome-message"]},r+".extraLink"),this.hideFromOverview=e.hideFromOverview??!1,this.lockLocation=e.lockLocation??void 0,this.enableUserBadge=e.enableUserBadge??!0,this.enableShareScreen=e.enableShareScreen??!0,this.enableMoreQuests=e.enableMoreQuests??!0,this.enableLayers=e.enableLayers??!0,this.enableSearch=e.enableSearch??!0,this.enableGeolocation=e.enableGeolocation??!0,this.enableAddNewPoints=e.enableAddNewPoints??!0,this.enableBackgroundLayerSelection=e.enableBackgroundLayerSelection??!0,this.enableShowAllQuestions=e.enableShowAllQuestions??!1,this.enableExportButton=e.enableDownload??!0,this.enablePdfDownload=e.enablePdfDownload??!0,this.enableTerrain=e.enableTerrain??!1,this.customCss=e.customCss,this.overpassUrl=e.overpassUrl??y.defaultOverpassUrls,this.overpassTimeout=e.overpassTimeout??30,this.overpassMaxZoom=e.overpassMaxZoom??16,this.osmApiTileSize=e.osmApiTileSize??this.overpassMaxZoom+1,this.enableMorePrivacy=e.enableMorePrivacy||e.layers.some(s=>s.enableMorePrivacy),this.layersDict=new Map;for(const s of this.layers)this.layersDict.set(s.id,s)}CustomCodeSnippets(){if(this.official)return[];const e="<br/><b>This layout uses <span class='alert'>custom javascript</span>, loaded for the wide internet. The code is printed below, please report suspicious code on the issue tracker of MapComplete:</b><br/>",i=[];for(const a of this.layers)i.push(...a.CustomCodeSnippets().map(r=>r+"<br />"));return i.length===0||i.splice(0,0,e),i}getLayer(e){return this.layersDict.get(e)}isLeftRightSensitive(){return this.layers.some(e=>e.isLeftRightSensitive())}hasNoteLayer(){return this.layers.some(e=>e.id==="note")}hasPresets(){return this.layers.some(e=>{var i;return((i=e.presets)==null?void 0:i.length)>0})}missingTranslations(e){let i=0;const a=new Map;return c.WalkObject([this,e],r=>{const s=r;s.translations["*"]===void 0&&(s.context===void 0||s.context.indexOf(":")<0||(i++,g.usedLanguagesSorted.forEach(l=>{const d=s.translations;d["*"]===void 0&&(s.context.indexOf(":")<0||d[l]===void 0&&(a.has(l)||a.set(l,[]),a.get(l).push(s.context.replace(/^note_import_[a-zA-Z0-9_]*/,"note_import"))))})))},r=>r==null?!1:r instanceof n),{untranslated:a,total:i}}getMatchingLayer(e){var i;if(e!==void 0){if(e.id.startsWith("current_view"))return this.getLayer("current_view");for(const a of this.layers){if(!a.source){if((i=a.isShown)!=null&&i.matchesProperties(e))return a;continue}if(a.source.osmTags.matchesProperties(e)&&(!a.isShown||a.isShown.matchesProperties(e)))return a}console.log("Fallthrough",this,e)}}getUsedImages(){if(this.usedImages)return this.usedImages;const e=this.source,i={...e,layers:e.layers.filter(r=>r.id!=="favourite")},a=new v(this.official,void 0).convertStrict(i,b.construct([e.id],["ExtractImages"])).flatMap(r=>r.path);return a.sort(),this.usedImages=c.Dedup(a),this.usedImages}};t(h,"defaultSocialImage","assets/SocialImage.png");let u=h;export{u as L};
//# sourceMappingURL=LayoutConfig-32cdf140.js.map
