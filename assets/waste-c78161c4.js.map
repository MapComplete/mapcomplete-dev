{"version":3,"file":"waste-c78161c4.js","sources":["../../src/assets/generated/metatagging/waste.ts","../../index_waste.ts"],"sourcesContent":["import {Feature} from 'geojson'\nimport { ExtraFuncType } from \"../../../Logic/ExtraFunctions\";\nimport { Utils } from \"../../../Utils\"\nexport class ThemeMetaTagging {\n   public static readonly themeName = \"waste\"\n\n   public metaTaggging_for_waste_basket(feat: Feature, helperFunctions: Record<ExtraFuncType, (feature: Feature) => Function>) {\n      const {distanceTo, overlapWith, enclosingFeatures, intersectionsWith, closest, closestn, get} = helperFunctions\n   }\n   public metaTaggging_for_recycling(feat: Feature, helperFunctions: Record<ExtraFuncType, (feature: Feature) => Function>) {\n      const {distanceTo, overlapWith, enclosingFeatures, intersectionsWith, closest, closestn, get} = helperFunctions\n      Utils.AddLazyProperty(feat.properties, '_waste_amount', () => Object.keys(feat.properties).filter(key => key.startsWith('recycling:')).filter(k => feat.properties[k] === 'yes').length ) \n   }\n   public metaTaggging_for_waste_disposal(feat: Feature, helperFunctions: Record<ExtraFuncType, (feature: Feature) => Function>) {\n      const {distanceTo, overlapWith, enclosingFeatures, intersectionsWith, closest, closestn, get} = helperFunctions\n   }\n   public metaTaggging_for_note_import_waste_basket(feat: Feature, helperFunctions: Record<ExtraFuncType, (feature: Feature) => Function>) {\n      const {distanceTo, overlapWith, enclosingFeatures, intersectionsWith, closest, closestn, get} = helperFunctions\n      Utils.AddLazyProperty(feat.properties, '_first_comment', () => get(feat)('comments')[0].text.toLowerCase() ) \n      Utils.AddLazyProperty(feat.properties, '_trigger_index', () => (() => {const lines = feat.properties['_first_comment'].split('\\n'); const matchesMapCompleteURL = lines.map(l => l.match(\".*https://mapcomplete.\\(org|osm.be\\)/\\([a-zA-Z_-]+\\)\\(.html\\)?.*#import\")); const matchedIndexes = matchesMapCompleteURL.map((doesMatch, i) => [doesMatch !== null, i]).filter(v => v[0]).map(v => v[1]); return matchedIndexes[0] })() ) \n      Utils.AddLazyProperty(feat.properties, '_comments_count', () => get(feat)('comments').length ) \n      Utils.AddLazyProperty(feat.properties, '_intro', () => (() => {const lines = get(feat)('comments')[0].text.split('\\n'); lines.splice(get(feat)('_trigger_index')-1, lines.length); return lines.filter(l => l !== '').join('<br/>');})() ) \n      Utils.AddLazyProperty(feat.properties, '_tags', () => (() => {let lines = get(feat)('comments')[0].text.split('\\n').map(l => l.trim()); lines.splice(0, get(feat)('_trigger_index') + 1); lines = lines.filter(l => l != ''); return lines.join(';');})() ) \n   }\n   public metaTaggging_for_note_import_recycling(feat: Feature, helperFunctions: Record<ExtraFuncType, (feature: Feature) => Function>) {\n      const {distanceTo, overlapWith, enclosingFeatures, intersectionsWith, closest, closestn, get} = helperFunctions\n      Utils.AddLazyProperty(feat.properties, '_first_comment', () => get(feat)('comments')[0].text.toLowerCase() ) \n      Utils.AddLazyProperty(feat.properties, '_trigger_index', () => (() => {const lines = feat.properties['_first_comment'].split('\\n'); const matchesMapCompleteURL = lines.map(l => l.match(\".*https://mapcomplete.\\(org|osm.be\\)/\\([a-zA-Z_-]+\\)\\(.html\\)?.*#import\")); const matchedIndexes = matchesMapCompleteURL.map((doesMatch, i) => [doesMatch !== null, i]).filter(v => v[0]).map(v => v[1]); return matchedIndexes[0] })() ) \n      Utils.AddLazyProperty(feat.properties, '_comments_count', () => get(feat)('comments').length ) \n      Utils.AddLazyProperty(feat.properties, '_intro', () => (() => {const lines = get(feat)('comments')[0].text.split('\\n'); lines.splice(get(feat)('_trigger_index')-1, lines.length); return lines.filter(l => l !== '').join('<br/>');})() ) \n      Utils.AddLazyProperty(feat.properties, '_tags', () => (() => {let lines = get(feat)('comments')[0].text.split('\\n').map(l => l.trim()); lines.splice(0, get(feat)('_trigger_index') + 1); lines = lines.filter(l => l != ''); return lines.join(';');})() ) \n   }\n   public metaTaggging_for_note_import_waste_disposal(feat: Feature, helperFunctions: Record<ExtraFuncType, (feature: Feature) => Function>) {\n      const {distanceTo, overlapWith, enclosingFeatures, intersectionsWith, closest, closestn, get} = helperFunctions\n      Utils.AddLazyProperty(feat.properties, '_first_comment', () => get(feat)('comments')[0].text.toLowerCase() ) \n      Utils.AddLazyProperty(feat.properties, '_trigger_index', () => (() => {const lines = feat.properties['_first_comment'].split('\\n'); const matchesMapCompleteURL = lines.map(l => l.match(\".*https://mapcomplete.\\(org|osm.be\\)/\\([a-zA-Z_-]+\\)\\(.html\\)?.*#import\")); const matchedIndexes = matchesMapCompleteURL.map((doesMatch, i) => [doesMatch !== null, i]).filter(v => v[0]).map(v => v[1]); return matchedIndexes[0] })() ) \n      Utils.AddLazyProperty(feat.properties, '_comments_count', () => get(feat)('comments').length ) \n      Utils.AddLazyProperty(feat.properties, '_intro', () => (() => {const lines = get(feat)('comments')[0].text.split('\\n'); lines.splice(get(feat)('_trigger_index')-1, lines.length); return lines.filter(l => l !== '').join('<br/>');})() ) \n      Utils.AddLazyProperty(feat.properties, '_tags', () => (() => {let lines = get(feat)('comments')[0].text.split('\\n').map(l => l.trim()); lines.splice(0, get(feat)('_trigger_index') + 1); lines = lines.filter(l => l != ''); return lines.join(';');})() ) \n   }\n}","import layout from \"./src/assets/generated/themes/waste.json\"\nimport { ThemeMetaTagging } from \"./src/assets/generated/metatagging/waste\"\nimport selected_element from \"./src/assets/generated/layers/selected_element.json\"\nimport gps_location from \"./src/assets/generated/layers/gps_location.json\"\nimport gps_location_history from \"./src/assets/generated/layers/gps_location_history.json\"\nimport home_location from \"./src/assets/generated/layers/home_location.json\"\nimport gps_track from \"./src/assets/generated/layers/gps_track.json\"\nimport range from \"./src/assets/generated/layers/range.json\"\nimport last_click from \"./src/assets/generated/layers/last_click.json\"\nimport favourite from \"./src/assets/generated/layers/favourite.json\"\nimport summary from \"./src/assets/generated/layers/summary.json\"\nimport ThemeViewState from \"./src/Models/ThemeViewState\"\nimport ThemeViewGUI from \"./src/UI/ThemeViewGUI.svelte\"\nimport LayoutConfig from \"./src/Models/ThemeConfig/LayoutConfig\";\nimport MetaTagging from \"./src/Logic/MetaTagging\";\nimport { FixedUiElement } from \"./src/UI/Base/FixedUiElement\";\nimport { Utils } from \"./src/Utils\"\nimport Constants from \"./src/Models/Constants\"\n\nfunction webgl_support() {\n    try {\n        var canvas = document.createElement(\"canvas\")\n        return (\n            !!window.WebGLRenderingContext &&\n            (canvas.getContext(\"webgl\") || canvas.getContext(\"experimental-webgl\"))\n        )\n    } catch (e) {\n        return false\n    }\n}\n\nasync function timeout(timeMS: number): Promise<{ layers: string[] }> {\n    await Utils.waitFor(timeMS)\n    return { layers: [] }\n}\n\n\nasync function getAvailableLayers(): Promise<Set<string>> {\n    try {\n        const host = new URL(Constants.VectorTileServer).host\n        const status = await Promise.any([\n                                   Utils.downloadJson(\"https://\" + host + \"/summary/status.json\"),\n                                   timeout(0)\n                               ])\n        return new Set<string>(status.layers)\n    } catch (e) {\n        console.error(\"Could not get MVT available layers due to\", e)\n        return new Set<string>()\n    }\n}\n\nasync function main() {\n    if (!webgl_support()) {\n         new FixedUiElement(\"WebGL is not supported or not enabled. This is essential for MapComplete to function, please enable this.\").SetClass(\"block alert\").AttachTo(\"maindiv\")\n    }else{\n        const availableLayers = await getAvailableLayers()\n        MetaTagging.setThemeMetatagging(new ThemeMetaTagging())\n        layout.layers.push(<any> selected_element)\n    layout.layers.push(<any> gps_location)\n    layout.layers.push(<any> gps_location_history)\n    layout.layers.push(<any> home_location)\n    layout.layers.push(<any> gps_track)\n    layout.layers.push(<any> range)\n    layout.layers.push(<any> last_click)\n    layout.layers.push(<any> favourite)\n    layout.layers.push(<any> summary)\n        // LAYOUT.ADD_CONFIG\n        const state = new ThemeViewState(new LayoutConfig(<any> layout), availableLayers)\n        const target =  document.getElementById(\"maindiv\")\n        const childs = Array.from(target.children)\n        new ThemeViewGUI({\n            target,\n            props: { state },\n        })\n        childs.forEach(ch => target.removeChild(ch))\n        Array.from(document.getElementsByClassName(\"delete-on-load\")).forEach(el => {\n                    el.parentElement.removeChild(el)\n                })\n    }\n}\nmain()\n"],"names":["ThemeMetaTagging","feat","helperFunctions","Utils","key","k","distanceTo","overlapWith","enclosingFeatures","intersectionsWith","closest","closestn","get","l","doesMatch","i","v","lines","__publicField","webgl_support","canvas","timeout","timeMS","getAvailableLayers","host","Constants","status","e","main","FixedUiElement","availableLayers","MetaTagging","layout","selected_element","gps_location","gps_location_history","home_location","gps_track","range","last_click","favourite","summary","state","ThemeViewState","LayoutConfig","target","childs","ThemeViewGUI","ch","el"],"mappings":"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"}