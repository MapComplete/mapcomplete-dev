var he=Object.defineProperty;var me=(r,e,i)=>e in r?he(r,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):r[e]=i;var f=(r,e,i)=>(me(r,typeof e!="symbol"?e+"":e,i),i);import{a as se,d as B,f as pe,L as ge,T as _e}from"./Tr-83bf1e28.js";import{E as be,L as ve,C as we}from"./FixImages-cc2560d9.js";import{U as ne}from"./Utils-74342990.js";import{S as O,i as M,s as N,e as S,b as U,d as k,y as oe,n as C,h as L,x as ye,Y as ke,Z as W,z as Le,A as Se,C as $e,t as u,g as p,_ as Te,u as T,v as D,P as E,q as fe,w as ce,o as G,Q as P,R as Z,c as I,a as $,m as F,f as y,j as z,V as De,p as Ie}from"./Svg-62af0783.js";import{U as Fe,I as H}from"./LocalStorageSource-11332f0f.js";import{T as ue}from"./ToSvelte-7144d128.js";import{F as ze,V as Ce,I as Ue}from"./ValidatedInput-010b3fe9.js";class Ae{constructor(e,i){f(this,"icon");f(this,"text");f(this,"href");f(this,"newTab");f(this,"requirements");this.icon=e.icon,this.text=se.T(e.text,"themes:"+i+".text"),this.href=e.href,this.newTab=e.newTab,this.requirements=new Set(e.requirements);for(let t of e.requirements)if(this.requirements.has("no-"+t))throw"Conflicting requirements found for "+i+".extraLink: both '"+t+"' and 'no-"+t+"' found";if(this.icon===void 0&&this.text===void 0)throw"At "+i+".extraLink: define at least an icon or a text to show. Both are undefined, this is not allowed"}}const V=class{constructor(e,i=!0,t){f(this,"id");f(this,"credits");f(this,"language");f(this,"title");f(this,"shortDescription");f(this,"description");f(this,"descriptionTail");f(this,"icon");f(this,"socialImage");f(this,"startZoom");f(this,"startLat");f(this,"startLon");f(this,"widenFactor");f(this,"defaultBackgroundId");f(this,"layers");f(this,"tileLayerSources");f(this,"hideFromOverview");f(this,"lockLocation");f(this,"enableUserBadge");f(this,"enableShareScreen");f(this,"enableMoreQuests");f(this,"enableAddNewPoints");f(this,"enableLayers");f(this,"enableSearch");f(this,"enableGeolocation");f(this,"enableBackgroundLayerSelection");f(this,"enableShowAllQuestions");f(this,"enableExportButton");f(this,"enablePdfDownload");f(this,"customCss");f(this,"overpassUrl");f(this,"overpassTimeout");f(this,"overpassMaxZoom");f(this,"osmApiTileSize");f(this,"official");f(this,"usedImages");f(this,"extraLink");f(this,"definedAtUrl");f(this,"definitionRaw");f(this,"layersDict");if(this.official=i,this.id=e.id,this.definedAtUrl=t==null?void 0:t.definedAtUrl,this.definitionRaw=t==null?void 0:t.definitionRaw,i){if(e.id.toLowerCase()!==e.id)throw"The id of a theme should be lowercase: "+e.id;if(e.id.match(/[a-z0-9-_]/)==null)throw"The id of a theme should match [a-z0-9-_]*: "+e.id}const l=this.id;this.credits=e.credits,this.language=e.mustHaveLanguage??Object.keys(e.title),this.usedImages=Array.from(new be(i,void 0).convertStrict(e,"while extracting the images of "+e.id+" "+l).map(s=>s.path)).sort();{if(typeof e.title=="string")throw`The title of a theme should always be a translation, as it sets the corresponding languages (${l}.title). The themenID is ${this.id}; the offending object is ${JSON.stringify(e.title)} which is a ${typeof e.title})`;if(this.language.length==0)throw`No languages defined. Define at least one language. (${l}.languages)`;if(e.title===void 0)throw"Title not defined in "+this.id;if(e.description===void 0)throw"Description not defined in "+this.id;if(e.widenFactor<=0)throw"Widenfactor too small, shoud be > 0";if(e.widenFactor>20)throw"Widenfactor is very big, use a value between 1 and 5 (current value is "+e.widenFactor+") at "+l;if(e.hideInOverview)throw"The json for "+this.id+" contains a 'hideInOverview'. Did you mean hideFromOverview instead?";if(e.layers===void 0)throw"Got undefined layers for "+e.id+" at "+l}if(this.title=new B(e.title,"themes:"+l+".title"),this.description=new B(e.description,"themes:"+l+".description"),this.shortDescription=e.shortDescription===void 0?this.description.FirstSentence():new B(e.shortDescription,"themes:"+l+".shortdescription"),this.descriptionTail=e.descriptionTail===void 0?void 0:new B(e.descriptionTail,"themes:"+l+".descriptionTail"),this.icon=e.icon,this.socialImage=e.socialImage??V.defaultSocialImage,this.socialImage===""&&i)throw"Theme "+e.id+" has empty string as social image";this.startZoom=e.startZoom,this.startLat=e.startLat,this.startLon=e.startLon,this.widenFactor=e.widenFactor??1.5,this.defaultBackgroundId=e.defaultBackgroundId,this.tileLayerSources=e.tileLayerSources??[],this.layers=e.layers.map(s=>new ve(s,e.id+".layers."+s.id,i)),this.extraLink=new Ae(e.extraLink??{icon:"./assets/svg/pop-out.svg",href:"https://{basepath}/{theme}.html?lat={lat}&lon={lon}&z={zoom}&language={language}",newTab:!0,requirements:["iframe","no-welcome-message"]},l+".extraLink"),this.hideFromOverview=e.hideFromOverview??!1,this.lockLocation=e.lockLocation??void 0,this.enableUserBadge=e.enableUserBadge??!0,this.enableShareScreen=e.enableShareScreen??!0,this.enableMoreQuests=e.enableMoreQuests??!0,this.enableLayers=e.enableLayers??!0,this.enableSearch=e.enableSearch??!0,this.enableGeolocation=e.enableGeolocation??!0,this.enableAddNewPoints=e.enableAddNewPoints??!0,this.enableBackgroundLayerSelection=e.enableBackgroundLayerSelection??!0,this.enableShowAllQuestions=e.enableShowAllQuestions??!1,this.enableExportButton=e.enableDownload??!0,this.enablePdfDownload=e.enablePdfDownload??!0,this.customCss=e.customCss,this.overpassUrl=we.defaultOverpassUrls,e.overpassUrl!==void 0&&(typeof e.overpassUrl=="string"?this.overpassUrl=[e.overpassUrl]:this.overpassUrl=e.overpassUrl),this.overpassTimeout=e.overpassTimeout??30,this.overpassMaxZoom=e.overpassMaxZoom??16,this.osmApiTileSize=e.osmApiTileSize??this.overpassMaxZoom+1,this.layersDict=new Map;for(const s of this.layers)this.layersDict.set(s.id,s)}CustomCodeSnippets(){if(this.official)return[];const e="<br/><b>This layout uses <span class='alert'>custom javascript</span>, loaded for the wide internet. The code is printed below, please report suspicious code on the issue tracker of MapComplete:</b><br/>",i=[];for(const t of this.layers)i.push(...t.CustomCodeSnippets().map(l=>l+"<br />"));return i.length===0||i.splice(0,0,e),i}getLayer(e){return this.layersDict.get(e)}isLeftRightSensitive(){return this.layers.some(e=>e.isLeftRightSensitive())}missingTranslations(){const e=this;let i=0;const t=new Map;return ne.WalkObject(e,l=>{const s=l;s.translations["*"]===void 0&&(s.context===void 0||s.context.indexOf(":")<0||(i++,pe.usedLanguagesSorted.forEach(a=>{const n=s.translations;n["*"]===void 0&&(s.context.indexOf(":")<0||n[a]===void 0&&(t.has(a)||t.set(a,[]),t.get(a).push(s.context.replace(/^note_import_[a-zA-Z0-9_]*/,"note_import"))))})))},l=>l==null?!1:l instanceof B),{untranslated:t,total:i}}getMatchingLayer(e){if(e!==void 0){for(const i of this.layers)if(i.source&&i.source.osmTags.matchesProperties(e))return i}}};let R=V;f(R,"defaultSocialImage","assets/SocialImage.png");function qe(r){let e,i,t;return{c(){e=S("input"),U(e,"type","checkbox")},m(l,s){k(l,e,s),e.checked=r[0],i||(t=oe(e,"change",r[2]),i=!0)},p(l,[s]){s&1&&(e.checked=l[0])},i:C,o:C,d(l){l&&L(e),i=!1,t()}}}function Be(r,e,i){let{selected:t}=e,l=t.data??!0;function s(){l=this.checked,i(0,l)}return r.$$set=a=>{"selected"in a&&i(1,t=a.selected)},r.$$.update=()=>{r.$$.dirty&3&&t.setData(l)},[l,t,s]}class de extends O{constructor(e){super(),M(this,e,Be,qe,N,{selected:1})}}function Oe(r){let e,i,t,l;const s=r[3].default,a=ye(s,r,r[2],null);return{c(){e=S("select"),a&&a.c(),r[0]===void 0&&ke(()=>r[4].call(e))},m(n,o){k(n,e,o),a&&a.m(e,null),W(e,r[0]),i=!0,t||(l=oe(e,"change",r[4]),t=!0)},p(n,[o]){a&&a.p&&(!i||o&4)&&Le(a,s,n,n[2],i?$e(s,n[2],o,null):Se(n[2]),null),o&1&&W(e,n[0])},i(n){i||(u(a,n),i=!0)},o(n){p(a,n),i=!1},d(n){n&&L(e),a&&a.d(n),t=!1,l()}}}function Me(r,e,i){let{$$slots:t={},$$scope:l}=e,{value:s}=e,a=s.data;function n(){a=Te(this),i(0,a)}return r.$$set=o=>{"value"in o&&i(1,s=o.value),"$$scope"in o&&i(2,l=o.$$scope)},r.$$.update=()=>{r.$$.dirty&3&&s.setData(a)},[a,s,l,t,n]}class Ne extends O{constructor(e){super(),M(this,e,Me,Oe,N,{value:1})}}function Y(r,e,i){const t=r.slice();return t[11]=e[i],t[13]=i,t}function Pe(r){let e=r[11].message+"",i;return{c(){i=P(e)},m(t,l){k(t,i,l)},p(t,l){l&1&&e!==(e=t[11].message+"")&&Z(i,e)},i:C,o:C,d(t){t&&L(i)}}}function Ze(r){let e,i,t,l;return i=new Ce({props:{value:r[1][r[11].subs],type:r[2][r[11].subs]}}),{c(){e=S("span"),I(i.$$.fragment),t=$(),U(e,"class","mx-1")},m(s,a){k(s,e,a),F(i,e,null),y(e,t),l=!0},p(s,a){const n={};a&3&&(n.value=s[1][s[11].subs]),a&5&&(n.type=s[2][s[11].subs]),i.$set(n)},i(s){l||(u(i.$$.fragment,s),l=!0)},o(s){p(i.$$.fragment,s),l=!1},d(s){s&&L(e),z(i)}}}function K(r){let e,i,t,l;const s=[Ze,Pe],a=[];function n(o,c){return o[11].subs?0:1}return e=n(r),i=a[e]=s[e](r),{c(){i.c(),t=G()},m(o,c){a[e].m(o,c),k(o,t,c),l=!0},p(o,c){let g=e;e=n(o),e===g?a[e].p(o,c):(T(),p(a[g],1,1,()=>{a[g]=null}),D(),i=a[e],i?i.p(o,c):(i=a[e]=s[e](o),i.c()),u(i,1),i.m(t.parentNode,t))},i(o){l||(u(i),l=!0)},o(o){p(i),l=!1},d(o){a[e].d(o),o&&L(t)}}}function Qe(r){let e,i,t=r[0],l=[];for(let a=0;a<t.length;a+=1)l[a]=K(Y(r,t,a));const s=a=>p(l[a],1,1,()=>{l[a]=null});return{c(){e=S("div");for(let a=0;a<l.length;a+=1)l[a].c()},m(a,n){k(a,e,n);for(let o=0;o<l.length;o+=1)l[o].m(e,null);i=!0},p(a,[n]){if(n&7){t=a[0];let o;for(o=0;o<t.length;o+=1){const c=Y(a,t,o);l[o]?(l[o].p(c,n),u(l[o],1)):(l[o]=K(c),l[o].c(),u(l[o],1),l[o].m(e,null))}for(T(),o=t.length;o<l.length;o+=1)s(o);D()}},i(a){if(!i){for(let n=0;n<t.length;n+=1)u(l[n]);i=!0}},o(a){l=l.filter(Boolean);for(let n=0;n<l.length;n+=1)p(l[n]);i=!1},d(a){a&&L(e),E(l,a)}}}function Re(r,e,i){let t,{filteredLayer:l}=e,{option:s}=e,{id:a}=e,n,o=ge.language;fe(r,o,d=>i(7,t=d));let c={},g={},v=l.appliedFilters.get(a),_=JSON.parse((v==null?void 0:v.data)??"{}");function b(){const d={};for(const h in c){const w=c[h].data;w===void 0?d[h]=void 0:d[h]=w}v==null||v.setData(ze.fieldsToString(d))}for(const d of s.fields){const h=new Fe(_[d.name]??"");g[d.name]=d.type,c[d.name]=h,ce(h.stabilized(200).addCallback(()=>{b()}))}return r.$$set=d=>{"filteredLayer"in d&&i(4,l=d.filteredLayer),"option"in d&&i(5,s=d.option),"id"in d&&i(6,a=d.id)},r.$$.update=()=>{if(r.$$.dirty&160){const d=s.question.textFor(t);i(0,n=ne.splitIntoSubstitutionParts(d))}},[n,c,g,o,l,s,a,t]}class Ee extends O{constructor(e){super(),M(this,e,Re,Qe,N,{filteredLayer:4,option:5,id:6})}}function X(r,e,i){const t=r.slice();return t[13]=e[i],t}function J(r,e,i){const t=r.slice();return t[16]=e[i],t[18]=i,t}function x(r){var d;let e,i,t,l,s,a,n=r[0].layerDef.name+"",o,c,g,v;t=new de({props:{selected:r[6]}}),s=new Ue({props:{condition:r[0].isDisplayed,$$slots:{else:[Ve],default:[Ge]},$$scope:{ctx:r}}});let _=r[3]<r[5].minzoom&&j(),b=r[4]&&((d=r[0].layerDef.filters)==null?void 0:d.length)>0&&ee(r);return{c(){e=S("div"),i=S("label"),I(t.$$.fragment),l=$(),I(s.$$.fragment),a=$(),o=P(n),c=$(),_&&_.c(),g=$(),b&&b.c(),U(i,"class","no-image-background flex gap-1"),U(e,"class","mb-1.5")},m(h,w){k(h,e,w),y(e,i),F(t,i,null),y(i,l),F(s,i,null),y(i,a),y(i,o),y(i,c),_&&_.m(i,null),y(e,g),b&&b.m(e,null),r[12](e),v=!0},p(h,w){var m;const q={};w&1&&(q.condition=h[0].isDisplayed),w&524288&&(q.$$scope={dirty:w,ctx:h}),s.$set(q),(!v||w&1)&&n!==(n=h[0].layerDef.name+"")&&Z(o,n),h[3]<h[5].minzoom?_?(_.p(h,w),w&8&&u(_,1)):(_=j(),_.c(),u(_,1),_.m(i,null)):_&&(T(),p(_,1,1,()=>{_=null}),D()),h[4]&&((m=h[0].layerDef.filters)==null?void 0:m.length)>0?b?(b.p(h,w),w&17&&u(b,1)):(b=ee(h),b.c(),u(b,1),b.m(e,null)):b&&(T(),p(b,1,1,()=>{b=null}),D())},i(h){v||(u(t.$$.fragment,h),u(s.$$.fragment,h),u(_),u(b),v=!0)},o(h){p(t.$$.fragment,h),p(s.$$.fragment,h),p(_),p(b),v=!1},d(h){h&&L(e),z(t),z(s),_&&_.d(),b&&b.d(),r[12](null)}}}function Ge(r){let e,i;return e=new ue({props:{construct:r[11]}}),{c(){I(e.$$.fragment)},m(t,l){F(e,t,l),i=!0},p:C,i(t){i||(u(e.$$.fragment,t),i=!0)},o(t){p(e.$$.fragment,t),i=!1},d(t){z(e,t)}}}function Ve(r){let e,i;return e=new ue({props:{slot:"else",construct:r[10]}}),{c(){I(e.$$.fragment)},m(t,l){F(e,t,l),i=!0},p:C,i(t){i||(u(e.$$.fragment,t),i=!0)},o(t){p(e.$$.fragment,t),i=!1},d(t){z(e,t)}}}function j(r){let e,i,t;return i=new _e({props:{t:se.t.general.layerSelection.zoomInToSeeThisLayer}}),{c(){e=S("span"),I(i.$$.fragment),U(e,"class","alert")},m(l,s){k(l,e,s),F(i,e,null),t=!0},p:C,i(l){t||(u(i.$$.fragment,l),t=!0)},o(l){p(i.$$.fragment,l),t=!1},d(l){l&&L(e),z(i)}}}function ee(r){let e,i,t=r[0].layerDef.filters,l=[];for(let a=0;a<t.length;a+=1)l[a]=re(X(r,t,a));const s=a=>p(l[a],1,1,()=>{l[a]=null});return{c(){e=S("div");for(let a=0;a<l.length;a+=1)l[a].c();U(e,"id","subfilters"),U(e,"class","ml-4 flex flex-col gap-y-1")},m(a,n){k(a,e,n);for(let o=0;o<l.length;o+=1)l[o].m(e,null);i=!0},p(a,n){if(n&385){t=a[0].layerDef.filters;let o;for(o=0;o<t.length;o+=1){const c=X(a,t,o);l[o]?(l[o].p(c,n),u(l[o],1)):(l[o]=re(c),l[o].c(),u(l[o],1),l[o].m(e,null))}for(T(),o=t.length;o<l.length;o+=1)s(o);D()}},i(a){if(!i){for(let n=0;n<t.length;n+=1)u(l[n]);i=!0}},o(a){l=l.filter(Boolean);for(let n=0;n<l.length;n+=1)p(l[n]);i=!1},d(a){a&&L(e),E(l,a)}}}function te(r){let e,i,t,l=r[13].options[0].question+"",s,a;return i=new de({props:{selected:r[7](r[13])}}),{c(){e=S("label"),I(i.$$.fragment),t=$(),s=P(l)},m(n,o){k(n,e,o),F(i,e,null),y(e,t),y(e,s),a=!0},p(n,o){const c={};o&1&&(c.selected=n[7](n[13])),i.$set(c),(!a||o&1)&&l!==(l=n[13].options[0].question+"")&&Z(s,l)},i(n){a||(u(i.$$.fragment,n),a=!0)},o(n){p(i.$$.fragment,n),a=!1},d(n){n&&L(e),z(i)}}}function ie(r){let e,i;return e=new Ee({props:{id:r[13].id,filteredLayer:r[0],option:r[13].options[0]}}),{c(){I(e.$$.fragment)},m(t,l){F(e,t,l),i=!0},p(t,l){const s={};l&1&&(s.id=t[13].id),l&1&&(s.filteredLayer=t[0]),l&1&&(s.option=t[13].options[0]),e.$set(s)},i(t){i||(u(e.$$.fragment,t),i=!0)},o(t){p(e.$$.fragment,t),i=!1},d(t){z(e,t)}}}function le(r){let e,i;return e=new Ne({props:{value:r[8](r[13]),$$slots:{default:[We]},$$scope:{ctx:r}}}),{c(){I(e.$$.fragment)},m(t,l){F(e,t,l),i=!0},p(t,l){const s={};l&1&&(s.value=t[8](t[13])),l&524289&&(s.$$scope={dirty:l,ctx:t}),e.$set(s)},i(t){i||(u(e.$$.fragment,t),i=!0)},o(t){p(e.$$.fragment,t),i=!1},d(t){z(e,t)}}}function ae(r){let e,i=r[16].question+"",t,l;return{c(){e=S("option"),t=P(i),l=$(),e.__value=r[18],e.value=e.__value},m(s,a){k(s,e,a),y(e,t),y(e,l)},p(s,a){a&1&&i!==(i=s[16].question+"")&&Z(t,i)},d(s){s&&L(e)}}}function We(r){let e,i=r[13].options,t=[];for(let l=0;l<i.length;l+=1)t[l]=ae(J(r,i,l));return{c(){for(let l=0;l<t.length;l+=1)t[l].c();e=G()},m(l,s){for(let a=0;a<t.length;a+=1)t[a].m(l,s);k(l,e,s)},p(l,s){if(s&1){i=l[13].options;let a;for(a=0;a<i.length;a+=1){const n=J(l,i,a);t[a]?t[a].p(n,s):(t[a]=ae(n),t[a].c(),t[a].m(e.parentNode,e))}for(;a<t.length;a+=1)t[a].d(1);t.length=i.length}},d(l){E(t,l),l&&L(e)}}}function re(r){let e,i,t,l,s,a=r[13].options.length===1&&r[13].options[0].fields.length===0&&te(r),n=r[13].options.length===1&&r[13].options[0].fields.length>0&&ie(r),o=r[13].options.length>1&&le(r);return{c(){e=S("div"),a&&a.c(),i=$(),n&&n.c(),t=$(),o&&o.c(),l=$()},m(c,g){k(c,e,g),a&&a.m(e,null),y(e,i),n&&n.m(e,null),y(e,t),o&&o.m(e,null),y(e,l),s=!0},p(c,g){c[13].options.length===1&&c[13].options[0].fields.length===0?a?(a.p(c,g),g&1&&u(a,1)):(a=te(c),a.c(),u(a,1),a.m(e,i)):a&&(T(),p(a,1,1,()=>{a=null}),D()),c[13].options.length===1&&c[13].options[0].fields.length>0?n?(n.p(c,g),g&1&&u(n,1)):(n=ie(c),n.c(),u(n,1),n.m(e,t)):n&&(T(),p(n,1,1,()=>{n=null}),D()),c[13].options.length>1?o?(o.p(c,g),g&1&&u(o,1)):(o=le(c),o.c(),u(o,1),o.m(e,l)):o&&(T(),p(o,1,1,()=>{o=null}),D())},i(c){s||(u(a),u(n),u(o),s=!0)},o(c){p(a),p(n),p(o),s=!1},d(c){c&&L(e),a&&a.d(),n&&n.d(),o&&o.d()}}}function He(r){let e,i,t=r[0].layerDef.name&&x(r);return{c(){t&&t.c(),e=G()},m(l,s){t&&t.m(l,s),k(l,e,s),i=!0},p(l,[s]){l[0].layerDef.name?t?(t.p(l,s),s&1&&u(t,1)):(t=x(l),t.c(),u(t,1),t.m(e.parentNode,e)):t&&(T(),p(t,1,1,()=>{t=null}),D())},i(l){i||(u(t),i=!0)},o(l){p(t),i=!1},d(l){t&&t.d(l),l&&L(e)}}}function Ye(r,e,i){let t,l=C,s=()=>(l(),l=De(c,m=>i(3,t=m)),c),a;r.$$.on_destroy.push(()=>l());let{filteredLayer:n}=e,{highlightedLayer:o=new H(void 0)}=e,{zoomlevel:c=new H(22)}=e;s();let g=n.layerDef,v=n.isDisplayed;fe(r,v,m=>i(4,a=m));function _(m){return n.appliedFilters.get(m.id).sync(A=>A===0,[],A=>A?0:void 0)}function b(m){return n.appliedFilters.get(m.id)}let d;const h=()=>{var m;return(m=g.defaultIcon())==null?void 0:m.SetClass("block h-6 w-6 no-image-background opacity-50")},w=()=>{var m;return(m=g.defaultIcon())==null?void 0:m.SetClass("block h-6 w-6 no-image-background")};function q(m){Ie[m?"unshift":"push"](()=>{d=m,i(2,d)})}return r.$$set=m=>{"filteredLayer"in m&&i(0,n=m.filteredLayer),"highlightedLayer"in m&&i(9,o=m.highlightedLayer),"zoomlevel"in m&&s(i(1,c=m.zoomlevel))},r.$$.update=()=>{r.$$.dirty&517&&ce(o.addCallbackAndRun(m=>{var Q,A;m===n.layerDef.id?(Q=d==null?void 0:d.classList)==null||Q.add("glowing-shadow"):(A=d==null?void 0:d.classList)==null||A.remove("glowing-shadow")}))},[n,c,d,t,a,g,v,_,b,o,h,w,q]}class lt extends O{constructor(e){super(),M(this,e,Ye,He,N,{filteredLayer:0,highlightedLayer:9,zoomlevel:1})}}export{de as C,lt as F,R as L};
