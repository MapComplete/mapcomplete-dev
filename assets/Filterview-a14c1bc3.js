var de=Object.defineProperty;var he=(n,e,l)=>e in n?de(n,e,{enumerable:!0,configurable:!0,writable:!0,value:l}):n[e]=l;var u=(n,e,l)=>(he(n,typeof e!="symbol"?e+"":e,l),l);import{a as re,d as z,f as me,L as pe,T as ge}from"./Tr-3a19d2b1.js";import{E as _e,L as be}from"./FixImages-9f5ebe64.js";import{C as ve}from"./Constants-c981b44b.js";import{U as ae}from"./Utils-81aafc52.js";import{S as P,i as Q,s as R,x as we,e as T,Y as ye,d as g,Z as W,y as ke,z as Le,A as $e,C as Se,t as d,g as m,h as _,_ as Te,u as v,v as w,Q as E,q as ne,w as oe,o as A,R as q,T as B,n as F,c as y,a as S,b as C,m as k,f as D,j as L,N as De,p as Ie}from"./Svg-32095da9.js";import{U as Fe,I as V}from"./LocalStorageSource-df033e8b.js";import{T as fe}from"./ToSvelte-77ee3eec.js";import{F as ze,V as Ce,C as ue,I as Ue}from"./If-3b27b8a1.js";class Ae{constructor(e,l){u(this,"icon");u(this,"text");u(this,"href");u(this,"newTab");u(this,"requirements");this.icon=e.icon,this.text=re.T(e.text,"themes:"+l+".text"),this.href=e.href,this.newTab=e.newTab,this.requirements=new Set(e.requirements);for(let t of e.requirements)if(this.requirements.has("no-"+t))throw"Conflicting requirements found for "+l+".extraLink: both '"+t+"' and 'no-"+t+"' found";if(this.icon===void 0&&this.text===void 0)throw"At "+l+".extraLink: define at least an icon or a text to show. Both are undefined, this is not allowed"}}const G=class{constructor(e,l=!0,t){u(this,"id");u(this,"credits");u(this,"language");u(this,"title");u(this,"shortDescription");u(this,"description");u(this,"descriptionTail");u(this,"icon");u(this,"socialImage");u(this,"startZoom");u(this,"startLat");u(this,"startLon");u(this,"widenFactor");u(this,"defaultBackgroundId");u(this,"layers");u(this,"tileLayerSources");u(this,"hideFromOverview");u(this,"lockLocation");u(this,"enableUserBadge");u(this,"enableShareScreen");u(this,"enableMoreQuests");u(this,"enableAddNewPoints");u(this,"enableLayers");u(this,"enableSearch");u(this,"enableGeolocation");u(this,"enableBackgroundLayerSelection");u(this,"enableShowAllQuestions");u(this,"enableExportButton");u(this,"enablePdfDownload");u(this,"customCss");u(this,"overpassUrl");u(this,"overpassTimeout");u(this,"overpassMaxZoom");u(this,"osmApiTileSize");u(this,"official");u(this,"usedImages");u(this,"extraLink");u(this,"definedAtUrl");u(this,"definitionRaw");u(this,"layersDict");if(this.official=l,this.id=e.id,this.definedAtUrl=t==null?void 0:t.definedAtUrl,this.definitionRaw=t==null?void 0:t.definitionRaw,l){if(e.id.toLowerCase()!==e.id)throw"The id of a theme should be lowercase: "+e.id;if(e.id.match(/[a-z0-9-_]/)==null)throw"The id of a theme should match [a-z0-9-_]*: "+e.id}const i=this.id;if(this.credits=e.credits,!e.title)throw`The theme ${e.id} does not have a title defined.`;this.language=e.mustHaveLanguage??Object.keys(e.title),this.usedImages=Array.from(new _e(l,void 0).convertStrict(e,"while extracting the images of "+e.id+" "+i).map(a=>a.path)).sort();{if(typeof e.title=="string")throw`The title of a theme should always be a translation, as it sets the corresponding languages (${i}.title). The themenID is ${this.id}; the offending object is ${JSON.stringify(e.title)} which is a ${typeof e.title})`;if(this.language.length==0)throw`No languages defined. Define at least one language. (${i}.languages)`;if(e.title===void 0)throw"Title not defined in "+this.id;if(e.description===void 0)throw"Description not defined in "+this.id;if(e.widenFactor<=0)throw"Widenfactor too small, shoud be > 0";if(e.widenFactor>20)throw"Widenfactor is very big, use a value between 1 and 5 (current value is "+e.widenFactor+") at "+i;if(e.hideInOverview)throw"The json for "+this.id+" contains a 'hideInOverview'. Did you mean hideFromOverview instead?";if(e.layers===void 0)throw"Got undefined layers for "+e.id+" at "+i}if(this.title=new z(e.title,"themes:"+i+".title"),this.description=new z(e.description,"themes:"+i+".description"),this.shortDescription=e.shortDescription===void 0?this.description.FirstSentence():new z(e.shortDescription,"themes:"+i+".shortdescription"),this.descriptionTail=e.descriptionTail===void 0?void 0:new z(e.descriptionTail,"themes:"+i+".descriptionTail"),this.icon=e.icon,this.socialImage=e.socialImage??G.defaultSocialImage,this.socialImage===""&&l)throw"Theme "+e.id+" has empty string as social image";this.startZoom=e.startZoom,this.startLat=e.startLat,this.startLon=e.startLon,this.widenFactor=e.widenFactor??1.5,this.defaultBackgroundId=e.defaultBackgroundId,this.tileLayerSources=e.tileLayerSources??[],this.layers=e.layers.map(a=>new be(a,e.id+".layers."+a.id,l)),this.extraLink=new Ae(e.extraLink??{icon:"./assets/svg/pop-out.svg",href:"https://{basepath}/{theme}.html?lat={lat}&lon={lon}&z={zoom}&language={language}",newTab:!0,requirements:["iframe","no-welcome-message"]},i+".extraLink"),this.hideFromOverview=e.hideFromOverview??!1,this.lockLocation=e.lockLocation??void 0,this.enableUserBadge=e.enableUserBadge??!0,this.enableShareScreen=e.enableShareScreen??!0,this.enableMoreQuests=e.enableMoreQuests??!0,this.enableLayers=e.enableLayers??!0,this.enableSearch=e.enableSearch??!0,this.enableGeolocation=e.enableGeolocation??!0,this.enableAddNewPoints=e.enableAddNewPoints??!0,this.enableBackgroundLayerSelection=e.enableBackgroundLayerSelection??!0,this.enableShowAllQuestions=e.enableShowAllQuestions??!1,this.enableExportButton=e.enableDownload??!0,this.enablePdfDownload=e.enablePdfDownload??!0,this.customCss=e.customCss,this.overpassUrl=ve.defaultOverpassUrls,e.overpassUrl!==void 0&&(typeof e.overpassUrl=="string"?this.overpassUrl=[e.overpassUrl]:this.overpassUrl=e.overpassUrl),this.overpassTimeout=e.overpassTimeout??30,this.overpassMaxZoom=e.overpassMaxZoom??16,this.osmApiTileSize=e.osmApiTileSize??this.overpassMaxZoom+1,this.layersDict=new Map;for(const a of this.layers)this.layersDict.set(a.id,a)}CustomCodeSnippets(){if(this.official)return[];const e="<br/><b>This layout uses <span class='alert'>custom javascript</span>, loaded for the wide internet. The code is printed below, please report suspicious code on the issue tracker of MapComplete:</b><br/>",l=[];for(const t of this.layers)l.push(...t.CustomCodeSnippets().map(i=>i+"<br />"));return l.length===0||l.splice(0,0,e),l}getLayer(e){return this.layersDict.get(e)}isLeftRightSensitive(){return this.layers.some(e=>e.isLeftRightSensitive())}missingTranslations(){const e=this;let l=0;const t=new Map;return ae.WalkObject(e,i=>{const a=i;a.translations["*"]===void 0&&(a.context===void 0||a.context.indexOf(":")<0||(l++,me.usedLanguagesSorted.forEach(s=>{const o=a.translations;o["*"]===void 0&&(a.context.indexOf(":")<0||o[s]===void 0&&(t.has(s)||t.set(s,[]),t.get(s).push(a.context.replace(/^note_import_[a-zA-Z0-9_]*/,"note_import"))))})))},i=>i==null?!1:i instanceof z),{untranslated:t,total:l}}getMatchingLayer(e){if(e!==void 0){for(const l of this.layers)if(l.source&&l.source.osmTags.matchesProperties(e))return l}}};let Z=G;u(Z,"defaultSocialImage","assets/SocialImage.png");function qe(n){let e,l,t,i;const a=n[3].default,s=we(a,n,n[2],null);return{c(){e=T("select"),s&&s.c(),n[0]===void 0&&ye(()=>n[4].call(e))},m(o,r){g(o,e,r),s&&s.m(e,null),W(e,n[0],!0),l=!0,t||(i=ke(e,"change",n[4]),t=!0)},p(o,[r]){s&&s.p&&(!l||r&4)&&Le(s,a,o,o[2],l?Se(a,o[2],r,null):$e(o[2]),null),r&1&&W(e,o[0])},i(o){l||(d(s,o),l=!0)},o(o){m(s,o),l=!1},d(o){o&&_(e),s&&s.d(o),t=!1,i()}}}function Be(n,e,l){let{$$slots:t={},$$scope:i}=e,{value:a}=e,s=a.data;function o(){s=Te(this),l(0,s)}return n.$$set=r=>{"value"in r&&l(1,a=r.value),"$$scope"in r&&l(2,i=r.$$scope)},n.$$.update=()=>{n.$$.dirty&3&&a.setData(s)},[s,a,i,t,o]}class Oe extends P{constructor(e){super(),Q(this,e,Be,qe,R,{value:1})}}function H(n,e,l){const t=n.slice();return t[11]=e[l],t[13]=l,t}function Me(n){let e=n[11].message+"",l;return{c(){l=q(e)},m(t,i){g(t,l,i)},p(t,i){i&1&&e!==(e=t[11].message+"")&&B(l,e)},i:F,o:F,d(t){t&&_(l)}}}function Ne(n){let e,l,t,i;return l=new Ce({props:{value:n[1][n[11].subs],type:n[2][n[11].subs]}}),{c(){e=T("span"),y(l.$$.fragment),t=S(),C(e,"class","mx-1")},m(a,s){g(a,e,s),k(l,e,null),D(e,t),i=!0},p(a,s){const o={};s&3&&(o.value=a[1][a[11].subs]),s&5&&(o.type=a[2][a[11].subs]),l.$set(o)},i(a){i||(d(l.$$.fragment,a),i=!0)},o(a){m(l.$$.fragment,a),i=!1},d(a){a&&_(e),L(l)}}}function Y(n){let e,l,t,i;const a=[Ne,Me],s=[];function o(r,f){return r[11].subs?0:1}return e=o(n),l=s[e]=a[e](n),{c(){l.c(),t=A()},m(r,f){s[e].m(r,f),g(r,t,f),i=!0},p(r,f){let c=e;e=o(r),e===c?s[e].p(r,f):(v(),m(s[c],1,1,()=>{s[c]=null}),w(),l=s[e],l?l.p(r,f):(l=s[e]=a[e](r),l.c()),d(l,1),l.m(t.parentNode,t))},i(r){i||(d(l),i=!0)},o(r){m(l),i=!1},d(r){s[e].d(r),r&&_(t)}}}function Ze(n){let e,l,t=n[0],i=[];for(let s=0;s<t.length;s+=1)i[s]=Y(H(n,t,s));const a=s=>m(i[s],1,1,()=>{i[s]=null});return{c(){e=T("div");for(let s=0;s<i.length;s+=1)i[s].c()},m(s,o){g(s,e,o);for(let r=0;r<i.length;r+=1)i[r]&&i[r].m(e,null);l=!0},p(s,[o]){if(o&7){t=s[0];let r;for(r=0;r<t.length;r+=1){const f=H(s,t,r);i[r]?(i[r].p(f,o),d(i[r],1)):(i[r]=Y(f),i[r].c(),d(i[r],1),i[r].m(e,null))}for(v(),r=t.length;r<i.length;r+=1)a(r);w()}},i(s){if(!l){for(let o=0;o<t.length;o+=1)d(i[o]);l=!0}},o(s){i=i.filter(Boolean);for(let o=0;o<i.length;o+=1)m(i[o]);l=!1},d(s){s&&_(e),E(i,s)}}}function Pe(n,e,l){let t,{filteredLayer:i}=e,{option:a}=e,{id:s}=e,o,r=pe.language;ne(n,r,h=>l(7,t=h));let f={},c={},b=i.appliedFilters.get(s),O=JSON.parse((b==null?void 0:b.data)??"{}");function M(){const h={};for(const $ in f){const U=f[$].data;U===void 0?h[$]=void 0:h[$]=U}b==null||b.setData(ze.fieldsToString(h))}for(const h of a.fields){const $=new Fe(O[h.name]??"");c[h.name]=h.type,f[h.name]=$,oe($.stabilized(200).addCallback(()=>{M()}))}return n.$$set=h=>{"filteredLayer"in h&&l(4,i=h.filteredLayer),"option"in h&&l(5,a=h.option),"id"in h&&l(6,s=h.id)},n.$$.update=()=>{if(n.$$.dirty&160){const h=a.question.textFor(t);l(0,o=ae.splitIntoSubstitutionParts(h))}},[o,f,c,r,i,a,s,t]}class Qe extends P{constructor(e){super(),Q(this,e,Pe,Ze,R,{filteredLayer:4,option:5,id:6})}}function K(n,e,l){const t=n.slice();return t[13]=e[l],t}function X(n,e,l){const t=n.slice();return t[16]=e[l],t[18]=l,t}function J(n){var s;let e,l,t,i;l=new ue({props:{selected:n[6],$$slots:{default:[Ge]},$$scope:{ctx:n}}});let a=n[4]&&((s=n[0].layerDef.filters)==null?void 0:s.length)>0&&j(n);return{c(){e=T("div"),y(l.$$.fragment),t=S(),a&&a.c(),C(e,"class","mb-1.5")},m(o,r){g(o,e,r),k(l,e,null),D(e,t),a&&a.m(e,null),n[12](e),i=!0},p(o,r){var c;const f={};r&524297&&(f.$$scope={dirty:r,ctx:o}),l.$set(f),o[4]&&((c=o[0].layerDef.filters)==null?void 0:c.length)>0?a?(a.p(o,r),r&17&&d(a,1)):(a=j(o),a.c(),d(a,1),a.m(e,null)):a&&(v(),m(a,1,1,()=>{a=null}),w())},i(o){i||(d(l.$$.fragment,o),d(a),i=!0)},o(o){m(l.$$.fragment,o),m(a),i=!1},d(o){o&&_(e),L(l),a&&a.d(),n[12](null)}}}function Re(n){let e,l;return e=new fe({props:{construct:n[11]}}),{c(){y(e.$$.fragment)},m(t,i){k(e,t,i),l=!0},p:F,i(t){l||(d(e.$$.fragment,t),l=!0)},o(t){m(e.$$.fragment,t),l=!1},d(t){L(e,t)}}}function Ee(n){let e,l;return e=new fe({props:{slot:"else",construct:n[10]}}),{c(){y(e.$$.fragment)},m(t,i){k(e,t,i),l=!0},p:F,i(t){l||(d(e.$$.fragment,t),l=!0)},o(t){m(e.$$.fragment,t),l=!1},d(t){L(e,t)}}}function x(n){let e,l,t;return l=new ge({props:{t:re.t.general.layerSelection.zoomInToSeeThisLayer}}),{c(){e=T("span"),y(l.$$.fragment),C(e,"class","alert")},m(i,a){g(i,e,a),k(l,e,null),t=!0},p:F,i(i){t||(d(l.$$.fragment,i),t=!0)},o(i){m(l.$$.fragment,i),t=!1},d(i){i&&_(e),L(l)}}}function Ge(n){let e,l,t=n[0].layerDef.name+"",i,a,s,o;e=new Ue({props:{condition:n[0].isDisplayed,$$slots:{else:[Ee],default:[Re]},$$scope:{ctx:n}}});let r=n[3]<n[5].minzoom&&x();return{c(){y(e.$$.fragment),l=S(),i=q(t),a=S(),r&&r.c(),s=A()},m(f,c){k(e,f,c),g(f,l,c),g(f,i,c),g(f,a,c),r&&r.m(f,c),g(f,s,c),o=!0},p(f,c){const b={};c&1&&(b.condition=f[0].isDisplayed),c&524288&&(b.$$scope={dirty:c,ctx:f}),e.$set(b),(!o||c&1)&&t!==(t=f[0].layerDef.name+"")&&B(i,t),f[3]<f[5].minzoom?r?(r.p(f,c),c&8&&d(r,1)):(r=x(),r.c(),d(r,1),r.m(s.parentNode,s)):r&&(v(),m(r,1,1,()=>{r=null}),w())},i(f){o||(d(e.$$.fragment,f),d(r),o=!0)},o(f){m(e.$$.fragment,f),m(r),o=!1},d(f){L(e,f),f&&_(l),f&&_(i),f&&_(a),r&&r.d(f),f&&_(s)}}}function j(n){let e,l,t=n[0].layerDef.filters,i=[];for(let s=0;s<t.length;s+=1)i[s]=se(K(n,t,s));const a=s=>m(i[s],1,1,()=>{i[s]=null});return{c(){e=T("div");for(let s=0;s<i.length;s+=1)i[s].c();C(e,"id","subfilters"),C(e,"class","ml-4 flex flex-col gap-y-1")},m(s,o){g(s,e,o);for(let r=0;r<i.length;r+=1)i[r]&&i[r].m(e,null);l=!0},p(s,o){if(o&385){t=s[0].layerDef.filters;let r;for(r=0;r<t.length;r+=1){const f=K(s,t,r);i[r]?(i[r].p(f,o),d(i[r],1)):(i[r]=se(f),i[r].c(),d(i[r],1),i[r].m(e,null))}for(v(),r=t.length;r<i.length;r+=1)a(r);w()}},i(s){if(!l){for(let o=0;o<t.length;o+=1)d(i[o]);l=!0}},o(s){i=i.filter(Boolean);for(let o=0;o<i.length;o+=1)m(i[o]);l=!1},d(s){s&&_(e),E(i,s)}}}function ee(n){let e,l;return e=new ue({props:{selected:n[7](n[13]),$$slots:{default:[We]},$$scope:{ctx:n}}}),{c(){y(e.$$.fragment)},m(t,i){k(e,t,i),l=!0},p(t,i){const a={};i&1&&(a.selected=t[7](t[13])),i&524289&&(a.$$scope={dirty:i,ctx:t}),e.$set(a)},i(t){l||(d(e.$$.fragment,t),l=!0)},o(t){m(e.$$.fragment,t),l=!1},d(t){L(e,t)}}}function We(n){let e=n[13].options[0].question+"",l;return{c(){l=q(e)},m(t,i){g(t,l,i)},p(t,i){i&1&&e!==(e=t[13].options[0].question+"")&&B(l,e)},d(t){t&&_(l)}}}function te(n){let e,l;return e=new Qe({props:{id:n[13].id,filteredLayer:n[0],option:n[13].options[0]}}),{c(){y(e.$$.fragment)},m(t,i){k(e,t,i),l=!0},p(t,i){const a={};i&1&&(a.id=t[13].id),i&1&&(a.filteredLayer=t[0]),i&1&&(a.option=t[13].options[0]),e.$set(a)},i(t){l||(d(e.$$.fragment,t),l=!0)},o(t){m(e.$$.fragment,t),l=!1},d(t){L(e,t)}}}function ie(n){let e,l;return e=new Oe({props:{value:n[8](n[13]),$$slots:{default:[Ve]},$$scope:{ctx:n}}}),{c(){y(e.$$.fragment)},m(t,i){k(e,t,i),l=!0},p(t,i){const a={};i&1&&(a.value=t[8](t[13])),i&524289&&(a.$$scope={dirty:i,ctx:t}),e.$set(a)},i(t){l||(d(e.$$.fragment,t),l=!0)},o(t){m(e.$$.fragment,t),l=!1},d(t){L(e,t)}}}function le(n){let e,l=n[16].question+"",t,i;return{c(){e=T("option"),t=q(l),i=S(),e.__value=n[18],e.value=e.__value},m(a,s){g(a,e,s),D(e,t),D(e,i)},p(a,s){s&1&&l!==(l=a[16].question+"")&&B(t,l)},d(a){a&&_(e)}}}function Ve(n){let e,l=n[13].options,t=[];for(let i=0;i<l.length;i+=1)t[i]=le(X(n,l,i));return{c(){for(let i=0;i<t.length;i+=1)t[i].c();e=A()},m(i,a){for(let s=0;s<t.length;s+=1)t[s]&&t[s].m(i,a);g(i,e,a)},p(i,a){if(a&1){l=i[13].options;let s;for(s=0;s<l.length;s+=1){const o=X(i,l,s);t[s]?t[s].p(o,a):(t[s]=le(o),t[s].c(),t[s].m(e.parentNode,e))}for(;s<t.length;s+=1)t[s].d(1);t.length=l.length}},d(i){E(t,i),i&&_(e)}}}function se(n){let e,l,t,i,a,s=n[13].options.length===1&&n[13].options[0].fields.length===0&&ee(n),o=n[13].options.length===1&&n[13].options[0].fields.length>0&&te(n),r=n[13].options.length>1&&ie(n);return{c(){e=T("div"),s&&s.c(),l=S(),o&&o.c(),t=S(),r&&r.c(),i=S()},m(f,c){g(f,e,c),s&&s.m(e,null),D(e,l),o&&o.m(e,null),D(e,t),r&&r.m(e,null),D(e,i),a=!0},p(f,c){f[13].options.length===1&&f[13].options[0].fields.length===0?s?(s.p(f,c),c&1&&d(s,1)):(s=ee(f),s.c(),d(s,1),s.m(e,l)):s&&(v(),m(s,1,1,()=>{s=null}),w()),f[13].options.length===1&&f[13].options[0].fields.length>0?o?(o.p(f,c),c&1&&d(o,1)):(o=te(f),o.c(),d(o,1),o.m(e,t)):o&&(v(),m(o,1,1,()=>{o=null}),w()),f[13].options.length>1?r?(r.p(f,c),c&1&&d(r,1)):(r=ie(f),r.c(),d(r,1),r.m(e,i)):r&&(v(),m(r,1,1,()=>{r=null}),w())},i(f){a||(d(s),d(o),d(r),a=!0)},o(f){m(s),m(o),m(r),a=!1},d(f){f&&_(e),s&&s.d(),o&&o.d(),r&&r.d()}}}function He(n){let e,l,t=n[0].layerDef.name&&J(n);return{c(){t&&t.c(),e=A()},m(i,a){t&&t.m(i,a),g(i,e,a),l=!0},p(i,[a]){i[0].layerDef.name?t?(t.p(i,a),a&1&&d(t,1)):(t=J(i),t.c(),d(t,1),t.m(e.parentNode,e)):t&&(v(),m(t,1,1,()=>{t=null}),w())},i(i){l||(d(t),l=!0)},o(i){m(t),l=!1},d(i){t&&t.d(i),i&&_(e)}}}function Ye(n,e,l){let t,i=F,a=()=>(i(),i=De(f,p=>l(3,t=p)),f),s;n.$$.on_destroy.push(()=>i());let{filteredLayer:o}=e,{highlightedLayer:r=new V(void 0)}=e,{zoomlevel:f=new V(22)}=e;a();let c=o.layerDef,b=o.isDisplayed;ne(n,b,p=>l(4,s=p));function O(p){return o.appliedFilters.get(p.id).sync(I=>I===0,[],I=>I?0:void 0)}function M(p){return o.appliedFilters.get(p.id)}let h;const $=()=>{var p;return(p=c.defaultIcon())==null?void 0:p.SetClass("block h-6 w-6 no-image-background opacity-50")},U=()=>{var p;return(p=c.defaultIcon())==null?void 0:p.SetClass("block h-6 w-6 no-image-background")};function ce(p){Ie[p?"unshift":"push"](()=>{h=p,l(2,h)})}return n.$$set=p=>{"filteredLayer"in p&&l(0,o=p.filteredLayer),"highlightedLayer"in p&&l(9,r=p.highlightedLayer),"zoomlevel"in p&&a(l(1,f=p.zoomlevel))},n.$$.update=()=>{n.$$.dirty&517&&oe(r.addCallbackAndRun(p=>{var N,I;p===o.layerDef.id?(N=h==null?void 0:h.classList)==null||N.add("glowing-shadow"):(I=h==null?void 0:h.classList)==null||I.remove("glowing-shadow")}))},[o,f,h,t,s,c,b,O,M,r,$,U,ce]}class st extends P{constructor(e){super(),Q(this,e,Ye,He,R,{filteredLayer:0,highlightedLayer:9,zoomlevel:1})}}export{st as F,Z as L};
