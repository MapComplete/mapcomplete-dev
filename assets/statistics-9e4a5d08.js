var R=Object.defineProperty;var W=(p,e,r)=>e in p?R(p,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):p[e]=r;var f=(p,e,r)=>(W(p,typeof e!="symbol"?e+"":e,r),r);import"./modulepreload-polyfill-ec808ebb.js";import{U}from"./LocalStorageSource-7f535556.js";import{V as x,C as c,F as P}from"./Tr-412f00f5.js";import{j as L,c as b,k as V}from"./FixImages-49da9036.js";import{U as d}from"./Utils-7814fca2.js";import{L as A,F as B,S as J}from"./If-74314d7a.js";import{m as K}from"./mapcomplete-changes-8277ca3c.js";import{k as O}from"./tw-merge-84eb4a03.js";import{F as z}from"./Filterview-7003f2a9.js";import"./_commonjsHelpers-87174ba5.js";import"./Constants-c67befae.js";import"./ToSvelte-5c058492.js";class I extends c{constructor(e,r){r=r.filter(s=>!s.endsWith("file-overview.json"));const n=new A(K,!0).layers[0],a=new B(n),w=new c([new b("Filters"),new O(z,{filteredLayer:a})]),v=new U([]);for(const s of r)s.endsWith("file-overview.json")||d.downloadJson(e+s).then(o=>{var k;o!==void 0&&(o.features===void 0&&(o.features=o),(k=o==null?void 0:o.features)==null||k.forEach(l=>{l.properties={...l.properties,...l.properties.metadata},delete l.properties.metadata}),v.data.push(o),v.ping())});const N=new L(new x(v.map(s=>"Downloaded "+s.length+" items out of "+r.length)));super([w,new x(v.map(s=>{var F;if(s.length!==r.length)return N;const o=y.fromDirtyData([].concat(...s.map(t=>t.features))).filter(t=>a.isShown(t.properties));if(console.log("Overview is",o),o._meta.length===0)return"No data matched the filter";const l=d.NoNull(o._meta.map(t=>t.properties.date)).map(t=>new Date(t).getTime()),T=Math.min(...l),C=(Math.max(...l)-T)/(1e3*60*60*24);console.log("Diff in days is ",C,"got",o._meta.length);const E=n.tagRenderings.filter(t=>{var i,m;return((i=t.mappings)==null?void 0:i.length)>0||((m=t.freeform)==null?void 0:m.key)!==void 0}),D=new Set;for(const t of o._meta)for(const i in t.properties)D.add(i);console.log("All keys:",D);const M=["create","modify","delete","answer","move","deletion","add-image","plantnet-ai-detection","import","conflation","link-image","soft-delete"],j=d.Dedup(o._meta.map(t=>t.properties.theme)),_=new Set;j.length>1&&(_.add("grb"),_.add("etymology"));const q=M.map(t=>[t,o.sum(t,_)]).filter(t=>t[1]!=0).map(t=>t.join(": ")),S=[new b(j.length===1?"General statistics for "+j[0]:"General statistics (excluding etymology- and GRB-theme changes)"),new c([o._meta.length+" changesets match the filters",new V(q)]).SetClass("flex flex-col border rounded-xl"),new b("Breakdown")];for(const t of E){if(t.question===void 0)continue;console.log(t);let i;((F=t.freeform)==null?void 0:F.key)!==void 0&&(i=new Set(o._meta.map(m=>m.properties[t.freeform.key])).size);try{S.push(new c([new b(t.question??t.id).SetClass("p-2"),i>1?i+" unique value":void 0,new J(t,o._meta,{period:C<=367?"day":"month",groupToOtherCutoff:i>50?25:i>10?3:0}).SetStyle("width: 100%; height: 600px")]).SetClass("block border-2 border-subtle p-2 m-2 rounded-xl"))}catch(m){console.log("Could not generate a chart",m),S.push(new P("No relevant information for "+t.question.txt))}}return new c(S)},[a.currentFilter])).SetClass("block w-full h-full")]),this.SetClass("block w-full h-full")}}const g=class extends x{constructor(){const e=U.FromPromise(d.downloadJson(g.homeUrl+g.stats_files));super(e.map(r=>r===void 0?new L("Loading overview..."):new I(g.homeUrl,r))),this.SetClass("block w-full h-full")}};let h=g;f(h,"homeUrl","https://raw.githubusercontent.com/pietervdvn/MapComplete-data/main/changeset-metadata/"),f(h,"stats_files","file-overview.json");const u=class{constructor(e){f(this,"_meta");this._meta=d.NoNull(e)}static fromDirtyData(e){return new u(e==null?void 0:e.map(r=>u.cleanChangesetData(r)))}static cleanChangesetData(e){var n;if(e===void 0||(n=e.properties.editor)!=null&&n.startsWith("iD"))return;e.properties.theme===void 0&&(e.properties.theme=e.properties.comment.substr(e.properties.comment.lastIndexOf("#")+1)),e.properties.theme=e.properties.theme.toLowerCase();const r=u.theme_remappings[e.properties.theme];e.properties.theme=r??e.properties.theme,e.properties.theme.startsWith("https://raw.githubusercontent.com/")&&(e.properties.theme="gh://"+e.properties.theme.substr(34)),e.properties.modify+e.properties.delete+e.properties.create==0&&(e.properties.theme="EMPTY CS");try{e.properties.host=new URL(e.properties.host).host}catch{}return e}filter(e){return new u(this._meta.filter(e))}sum(e,r){let n=0;for(const a of this._meta){if(r.has(a.properties.theme))continue;const w=Number(a.properties[e]);isNaN(w)||(n+=w)}return n}};let y=u;f(y,"theme_remappings",{metamap:"maps",groen:"buurtnatuur","updaten van metadata met mapcomplete":"buurtnatuur","Toevoegen of dit natuurreservaat toegangkelijk is":"buurtnatuur","wiki:mapcomplete/fritures":"fritures","wiki:MapComplete/Fritures":"fritures",lits:"lit",pomp:"cyclofix","wiki:user:joost_schouppe/campersite":"campersite","wiki-user-joost_schouppe-geveltuintjes":"geveltuintjes","wiki-user-joost_schouppe-campersite":"campersite","wiki-User-joost_schouppe-campersite":"campersite","wiki-User-joost_schouppe-geveltuintjes":"geveltuintjes","wiki:User:joost_schouppe/campersite":"campersite",arbres:"arbres_llefia",aed_brugge:"aed","https://llefia.org/arbres/mapcomplete.json":"arbres_llefia","https://llefia.org/arbres/mapcomplete1.json":"arbres_llefia","toevoegen of dit natuurreservaat toegangkelijk is":"buurtnatuur","testing mapcomplete 0.0.0":"buurtnatuur",entrances:"indoor","https://raw.githubusercontent.com/osmbe/play/master/mapcomplete/geveltuinen/geveltuinen.json":"geveltuintjes"});new h().AttachTo("main");
//# sourceMappingURL=statistics-9e4a5d08.js.map
