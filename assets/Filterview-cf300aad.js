var he=Object.defineProperty;var me=(s,e,i)=>e in s?he(s,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[e]=i;var f=(s,e,i)=>(me(s,typeof e!="symbol"?e+"":e,i),i);import{a as ne,e as B,g as pe,U as ge,L as _e,I as V,T as be}from"./Tr-179fb62c.js";import{E as ve,L as we,C as ye}from"./FixImages-878a8a2c.js";import{U as re,S as O,i as M,s as N,e as S,b as U,d as k,y as oe,n as C,h as L,x as ke,Z as Le,_ as H,z as Se,A as $e,C as Te,t as u,g as p,$ as De,u as T,v as D,P as W,q as fe,w as ce,o as E,Q as P,R as Z,c as I,a as $,m as F,f as y,j as z,W as Ie,p as Fe}from"./Svg-d7be9025.js";import{T as ue}from"./ToSvelte-6115b9a9.js";import{F as ze,V as Ce,I as Ue}from"./ValidatedInput-5c2edbb0.js";class Ae{constructor(e,i){f(this,"icon");f(this,"text");f(this,"href");f(this,"newTab");f(this,"requirements");this.icon=e.icon,this.text=ne.T(e.text,"themes:"+i+".text"),this.href=e.href,this.newTab=e.newTab,this.requirements=new Set(e.requirements);for(let t of e.requirements)if(this.requirements.has("no-"+t))throw"Conflicting requirements found for "+i+".extraLink: both '"+t+"' and 'no-"+t+"' found";if(this.icon===void 0&&this.text===void 0)throw"At "+i+".extraLink: define at least an icon or a text to show. Both are undefined, this is not allowed"}}const G=class{constructor(e,i=!0,t){f(this,"id");f(this,"credits");f(this,"language");f(this,"title");f(this,"shortDescription");f(this,"description");f(this,"descriptionTail");f(this,"icon");f(this,"socialImage");f(this,"startZoom");f(this,"startLat");f(this,"startLon");f(this,"widenFactor");f(this,"defaultBackgroundId");f(this,"layers");f(this,"tileLayerSources");f(this,"hideFromOverview");f(this,"lockLocation");f(this,"enableUserBadge");f(this,"enableShareScreen");f(this,"enableMoreQuests");f(this,"enableAddNewPoints");f(this,"enableLayers");f(this,"enableSearch");f(this,"enableGeolocation");f(this,"enableBackgroundLayerSelection");f(this,"enableShowAllQuestions");f(this,"enableExportButton");f(this,"enablePdfDownload");f(this,"customCss");f(this,"overpassUrl");f(this,"overpassTimeout");f(this,"overpassMaxZoom");f(this,"osmApiTileSize");f(this,"official");f(this,"usedImages");f(this,"extraLink");f(this,"definedAtUrl");f(this,"definitionRaw");f(this,"layersDict");if(this.official=i,this.id=e.id,this.definedAtUrl=t==null?void 0:t.definedAtUrl,this.definitionRaw=t==null?void 0:t.definitionRaw,i){if(e.id.toLowerCase()!==e.id)throw"The id of a theme should be lowercase: "+e.id;if(e.id.match(/[a-z0-9-_]/)==null)throw"The id of a theme should match [a-z0-9-_]*: "+e.id}const l=this.id;this.credits=e.credits,this.language=e.mustHaveLanguage??Object.keys(e.title),this.usedImages=Array.from(new ve(i,void 0).convertStrict(e,"while extracting the images of "+e.id+" "+l).map(n=>n.path)).sort();{if(typeof e.title=="string")throw`The title of a theme should always be a translation, as it sets the corresponding languages (${l}.title). The themenID is ${this.id}; the offending object is ${JSON.stringify(e.title)} which is a ${typeof e.title})`;if(this.language.length==0)throw`No languages defined. Define at least one language. (${l}.languages)`;if(e.title===void 0)throw"Title not defined in "+this.id;if(e.description===void 0)throw"Description not defined in "+this.id;if(e.widenFactor<=0)throw"Widenfactor too small, shoud be > 0";if(e.widenFactor>20)throw"Widenfactor is very big, use a value between 1 and 5 (current value is "+e.widenFactor+") at "+l;if(e.hideInOverview)throw"The json for "+this.id+" contains a 'hideInOverview'. Did you mean hideFromOverview instead?";if(e.layers===void 0)throw"Got undefined layers for "+e.id+" at "+l}if(this.title=new B(e.title,"themes:"+l+".title"),this.description=new B(e.description,"themes:"+l+".description"),this.shortDescription=e.shortDescription===void 0?this.description.FirstSentence():new B(e.shortDescription,"themes:"+l+".shortdescription"),this.descriptionTail=e.descriptionTail===void 0?void 0:new B(e.descriptionTail,"themes:"+l+".descriptionTail"),this.icon=e.icon,this.socialImage=e.socialImage??G.defaultSocialImage,this.socialImage===""&&i)throw"Theme "+e.id+" has empty string as social image";this.startZoom=e.startZoom,this.startLat=e.startLat,this.startLon=e.startLon,this.widenFactor=e.widenFactor??1.5,this.defaultBackgroundId=e.defaultBackgroundId,this.tileLayerSources=e.tileLayerSources??[],this.layers=e.layers.map(n=>new we(n,e.id+".layers."+n.id,i)),this.extraLink=new Ae(e.extraLink??{icon:"./assets/svg/pop-out.svg",href:"https://{basepath}/{theme}.html?lat={lat}&lon={lon}&z={zoom}&language={language}",newTab:!0,requirements:["iframe","no-welcome-message"]},l+".extraLink"),this.hideFromOverview=e.hideFromOverview??!1,this.lockLocation=e.lockLocation??void 0,this.enableUserBadge=e.enableUserBadge??!0,this.enableShareScreen=e.enableShareScreen??!0,this.enableMoreQuests=e.enableMoreQuests??!0,this.enableLayers=e.enableLayers??!0,this.enableSearch=e.enableSearch??!0,this.enableGeolocation=e.enableGeolocation??!0,this.enableAddNewPoints=e.enableAddNewPoints??!0,this.enableBackgroundLayerSelection=e.enableBackgroundLayerSelection??!0,this.enableShowAllQuestions=e.enableShowAllQuestions??!1,this.enableExportButton=e.enableDownload??!0,this.enablePdfDownload=e.enablePdfDownload??!0,this.customCss=e.customCss,this.overpassUrl=ye.defaultOverpassUrls,e.overpassUrl!==void 0&&(typeof e.overpassUrl=="string"?this.overpassUrl=[e.overpassUrl]:this.overpassUrl=e.overpassUrl),this.overpassTimeout=e.overpassTimeout??30,this.overpassMaxZoom=e.overpassMaxZoom??16,this.osmApiTileSize=e.osmApiTileSize??this.overpassMaxZoom+1,this.layersDict=new Map;for(const n of this.layers)this.layersDict.set(n.id,n)}CustomCodeSnippets(){if(this.official)return[];const e="<br/><b>This layout uses <span class='alert'>custom javascript</span>, loaded for the wide internet. The code is printed below, please report suspicious code on the issue tracker of MapComplete:</b><br/>",i=[];for(const t of this.layers)i.push(...t.CustomCodeSnippets().map(l=>l+"<br />"));return i.length===0||i.splice(0,0,e),i}getLayer(e){return this.layersDict.get(e)}isLeftRightSensitive(){return this.layers.some(e=>e.isLeftRightSensitive())}missingTranslations(){const e=this;let i=0;const t=new Map;return re.WalkObject(e,l=>{const n=l;n.translations["*"]===void 0&&(n.context===void 0||n.context.indexOf(":")<0||(i++,pe.usedLanguagesSorted.forEach(a=>{const r=n.translations;r["*"]===void 0&&(n.context.indexOf(":")<0||r[a]===void 0&&(t.has(a)||t.set(a,[]),t.get(a).push(n.context.replace(/^note_import_[a-zA-Z0-9_]*/,"note_import"))))})))},l=>l==null?!1:l instanceof B),{untranslated:t,total:i}}getMatchingLayer(e){if(e!==void 0){for(const i of this.layers)if(i.source&&i.source.osmTags.matchesProperties(e))return i}}};let R=G;f(R,"defaultSocialImage","assets/SocialImage.png");function qe(s){let e,i,t;return{c(){e=S("input"),U(e,"type","checkbox")},m(l,n){k(l,e,n),e.checked=s[0],i||(t=oe(e,"change",s[2]),i=!0)},p(l,[n]){n&1&&(e.checked=l[0])},i:C,o:C,d(l){l&&L(e),i=!1,t()}}}function Be(s,e,i){let{selected:t}=e,l=t.data??!0;function n(){l=this.checked,i(0,l)}return s.$$set=a=>{"selected"in a&&i(1,t=a.selected)},s.$$.update=()=>{s.$$.dirty&3&&t.setData(l)},[l,t,n]}class de extends O{constructor(e){super(),M(this,e,Be,qe,N,{selected:1})}}function Oe(s){let e,i,t,l;const n=s[3].default,a=ke(n,s,s[2],null);return{c(){e=S("select"),a&&a.c(),s[0]===void 0&&Le(()=>s[4].call(e))},m(r,o){k(r,e,o),a&&a.m(e,null),H(e,s[0]),i=!0,t||(l=oe(e,"change",s[4]),t=!0)},p(r,[o]){a&&a.p&&(!i||o&4)&&Se(a,n,r,r[2],i?Te(n,r[2],o,null):$e(r[2]),null),o&1&&H(e,r[0])},i(r){i||(u(a,r),i=!0)},o(r){p(a,r),i=!1},d(r){r&&L(e),a&&a.d(r),t=!1,l()}}}function Me(s,e,i){let{$$slots:t={},$$scope:l}=e,{value:n}=e,a=n.data;function r(){a=De(this),i(0,a)}return s.$$set=o=>{"value"in o&&i(1,n=o.value),"$$scope"in o&&i(2,l=o.$$scope)},s.$$.update=()=>{s.$$.dirty&3&&n.setData(a)},[a,n,l,t,r]}class Ne extends O{constructor(e){super(),M(this,e,Me,Oe,N,{value:1})}}function K(s,e,i){const t=s.slice();return t[11]=e[i],t[13]=i,t}function Pe(s){let e=s[11].message+"",i;return{c(){i=P(e)},m(t,l){k(t,i,l)},p(t,l){l&1&&e!==(e=t[11].message+"")&&Z(i,e)},i:C,o:C,d(t){t&&L(i)}}}function Ze(s){let e,i,t,l;return i=new Ce({props:{value:s[1][s[11].subs],type:s[2][s[11].subs]}}),{c(){e=S("span"),I(i.$$.fragment),t=$(),U(e,"class","mx-1")},m(n,a){k(n,e,a),F(i,e,null),y(e,t),l=!0},p(n,a){const r={};a&3&&(r.value=n[1][n[11].subs]),a&5&&(r.type=n[2][n[11].subs]),i.$set(r)},i(n){l||(u(i.$$.fragment,n),l=!0)},o(n){p(i.$$.fragment,n),l=!1},d(n){n&&L(e),z(i)}}}function X(s){let e,i,t,l;const n=[Ze,Pe],a=[];function r(o,c){return o[11].subs?0:1}return e=r(s),i=a[e]=n[e](s),{c(){i.c(),t=E()},m(o,c){a[e].m(o,c),k(o,t,c),l=!0},p(o,c){let g=e;e=r(o),e===g?a[e].p(o,c):(T(),p(a[g],1,1,()=>{a[g]=null}),D(),i=a[e],i?i.p(o,c):(i=a[e]=n[e](o),i.c()),u(i,1),i.m(t.parentNode,t))},i(o){l||(u(i),l=!0)},o(o){p(i),l=!1},d(o){a[e].d(o),o&&L(t)}}}function Qe(s){let e,i,t=s[0],l=[];for(let a=0;a<t.length;a+=1)l[a]=X(K(s,t,a));const n=a=>p(l[a],1,1,()=>{l[a]=null});return{c(){e=S("div");for(let a=0;a<l.length;a+=1)l[a].c()},m(a,r){k(a,e,r);for(let o=0;o<l.length;o+=1)l[o].m(e,null);i=!0},p(a,[r]){if(r&7){t=a[0];let o;for(o=0;o<t.length;o+=1){const c=K(a,t,o);l[o]?(l[o].p(c,r),u(l[o],1)):(l[o]=X(c),l[o].c(),u(l[o],1),l[o].m(e,null))}for(T(),o=t.length;o<l.length;o+=1)n(o);D()}},i(a){if(!i){for(let r=0;r<t.length;r+=1)u(l[r]);i=!0}},o(a){l=l.filter(Boolean);for(let r=0;r<l.length;r+=1)p(l[r]);i=!1},d(a){a&&L(e),W(l,a)}}}function Re(s,e,i){let t,{filteredLayer:l}=e,{option:n}=e,{id:a}=e,r,o=_e.language;fe(s,o,d=>i(7,t=d));let c={},g={},v=l.appliedFilters.get(a),_=JSON.parse((v==null?void 0:v.data)??"{}");function b(){const d={};for(const h in c){const w=c[h].data;w===void 0?d[h]=void 0:d[h]=w}v==null||v.setData(ze.fieldsToString(d))}for(const d of n.fields){const h=new ge(_[d.name]??"");g[d.name]=d.type,c[d.name]=h,ce(h.stabilized(200).addCallback(()=>{b()}))}return s.$$set=d=>{"filteredLayer"in d&&i(4,l=d.filteredLayer),"option"in d&&i(5,n=d.option),"id"in d&&i(6,a=d.id)},s.$$.update=()=>{if(s.$$.dirty&160){const d=n.question.textFor(t);i(0,r=re.splitIntoSubstitutionParts(d))}},[r,c,g,o,l,n,a,t]}class We extends O{constructor(e){super(),M(this,e,Re,Qe,N,{filteredLayer:4,option:5,id:6})}}function Y(s,e,i){const t=s.slice();return t[13]=e[i],t}function J(s,e,i){const t=s.slice();return t[16]=e[i],t[18]=i,t}function x(s){var d;let e,i,t,l,n,a,r=s[0].layerDef.name+"",o,c,g,v;t=new de({props:{selected:s[6]}}),n=new Ue({props:{condition:s[0].isDisplayed,$$slots:{else:[Ge],default:[Ee]},$$scope:{ctx:s}}});let _=s[3]<s[5].minzoom&&j(),b=s[4]&&((d=s[0].layerDef.filters)==null?void 0:d.length)>0&&ee(s);return{c(){e=S("div"),i=S("label"),I(t.$$.fragment),l=$(),I(n.$$.fragment),a=$(),o=P(r),c=$(),_&&_.c(),g=$(),b&&b.c(),U(i,"class","no-image-background flex gap-1"),U(e,"class","mb-1.5")},m(h,w){k(h,e,w),y(e,i),F(t,i,null),y(i,l),F(n,i,null),y(i,a),y(i,o),y(i,c),_&&_.m(i,null),y(e,g),b&&b.m(e,null),s[12](e),v=!0},p(h,w){var m;const q={};w&1&&(q.condition=h[0].isDisplayed),w&524288&&(q.$$scope={dirty:w,ctx:h}),n.$set(q),(!v||w&1)&&r!==(r=h[0].layerDef.name+"")&&Z(o,r),h[3]<h[5].minzoom?_?(_.p(h,w),w&8&&u(_,1)):(_=j(),_.c(),u(_,1),_.m(i,null)):_&&(T(),p(_,1,1,()=>{_=null}),D()),h[4]&&((m=h[0].layerDef.filters)==null?void 0:m.length)>0?b?(b.p(h,w),w&17&&u(b,1)):(b=ee(h),b.c(),u(b,1),b.m(e,null)):b&&(T(),p(b,1,1,()=>{b=null}),D())},i(h){v||(u(t.$$.fragment,h),u(n.$$.fragment,h),u(_),u(b),v=!0)},o(h){p(t.$$.fragment,h),p(n.$$.fragment,h),p(_),p(b),v=!1},d(h){h&&L(e),z(t),z(n),_&&_.d(),b&&b.d(),s[12](null)}}}function Ee(s){let e,i;return e=new ue({props:{construct:s[11]}}),{c(){I(e.$$.fragment)},m(t,l){F(e,t,l),i=!0},p:C,i(t){i||(u(e.$$.fragment,t),i=!0)},o(t){p(e.$$.fragment,t),i=!1},d(t){z(e,t)}}}function Ge(s){let e,i;return e=new ue({props:{slot:"else",construct:s[10]}}),{c(){I(e.$$.fragment)},m(t,l){F(e,t,l),i=!0},p:C,i(t){i||(u(e.$$.fragment,t),i=!0)},o(t){p(e.$$.fragment,t),i=!1},d(t){z(e,t)}}}function j(s){let e,i,t;return i=new be({props:{t:ne.t.general.layerSelection.zoomInToSeeThisLayer}}),{c(){e=S("span"),I(i.$$.fragment),U(e,"class","alert")},m(l,n){k(l,e,n),F(i,e,null),t=!0},p:C,i(l){t||(u(i.$$.fragment,l),t=!0)},o(l){p(i.$$.fragment,l),t=!1},d(l){l&&L(e),z(i)}}}function ee(s){let e,i,t=s[0].layerDef.filters,l=[];for(let a=0;a<t.length;a+=1)l[a]=se(Y(s,t,a));const n=a=>p(l[a],1,1,()=>{l[a]=null});return{c(){e=S("div");for(let a=0;a<l.length;a+=1)l[a].c();U(e,"id","subfilters"),U(e,"class","ml-4 flex flex-col gap-y-1")},m(a,r){k(a,e,r);for(let o=0;o<l.length;o+=1)l[o].m(e,null);i=!0},p(a,r){if(r&385){t=a[0].layerDef.filters;let o;for(o=0;o<t.length;o+=1){const c=Y(a,t,o);l[o]?(l[o].p(c,r),u(l[o],1)):(l[o]=se(c),l[o].c(),u(l[o],1),l[o].m(e,null))}for(T(),o=t.length;o<l.length;o+=1)n(o);D()}},i(a){if(!i){for(let r=0;r<t.length;r+=1)u(l[r]);i=!0}},o(a){l=l.filter(Boolean);for(let r=0;r<l.length;r+=1)p(l[r]);i=!1},d(a){a&&L(e),W(l,a)}}}function te(s){let e,i,t,l=s[13].options[0].question+"",n,a;return i=new de({props:{selected:s[7](s[13])}}),{c(){e=S("label"),I(i.$$.fragment),t=$(),n=P(l)},m(r,o){k(r,e,o),F(i,e,null),y(e,t),y(e,n),a=!0},p(r,o){const c={};o&1&&(c.selected=r[7](r[13])),i.$set(c),(!a||o&1)&&l!==(l=r[13].options[0].question+"")&&Z(n,l)},i(r){a||(u(i.$$.fragment,r),a=!0)},o(r){p(i.$$.fragment,r),a=!1},d(r){r&&L(e),z(i)}}}function ie(s){let e,i;return e=new We({props:{id:s[13].id,filteredLayer:s[0],option:s[13].options[0]}}),{c(){I(e.$$.fragment)},m(t,l){F(e,t,l),i=!0},p(t,l){const n={};l&1&&(n.id=t[13].id),l&1&&(n.filteredLayer=t[0]),l&1&&(n.option=t[13].options[0]),e.$set(n)},i(t){i||(u(e.$$.fragment,t),i=!0)},o(t){p(e.$$.fragment,t),i=!1},d(t){z(e,t)}}}function le(s){let e,i;return e=new Ne({props:{value:s[8](s[13]),$$slots:{default:[Ve]},$$scope:{ctx:s}}}),{c(){I(e.$$.fragment)},m(t,l){F(e,t,l),i=!0},p(t,l){const n={};l&1&&(n.value=t[8](t[13])),l&524289&&(n.$$scope={dirty:l,ctx:t}),e.$set(n)},i(t){i||(u(e.$$.fragment,t),i=!0)},o(t){p(e.$$.fragment,t),i=!1},d(t){z(e,t)}}}function ae(s){let e,i=s[16].question+"",t,l;return{c(){e=S("option"),t=P(i),l=$(),e.__value=s[18],e.value=e.__value},m(n,a){k(n,e,a),y(e,t),y(e,l)},p(n,a){a&1&&i!==(i=n[16].question+"")&&Z(t,i)},d(n){n&&L(e)}}}function Ve(s){let e,i=s[13].options,t=[];for(let l=0;l<i.length;l+=1)t[l]=ae(J(s,i,l));return{c(){for(let l=0;l<t.length;l+=1)t[l].c();e=E()},m(l,n){for(let a=0;a<t.length;a+=1)t[a].m(l,n);k(l,e,n)},p(l,n){if(n&1){i=l[13].options;let a;for(a=0;a<i.length;a+=1){const r=J(l,i,a);t[a]?t[a].p(r,n):(t[a]=ae(r),t[a].c(),t[a].m(e.parentNode,e))}for(;a<t.length;a+=1)t[a].d(1);t.length=i.length}},d(l){W(t,l),l&&L(e)}}}function se(s){let e,i,t,l,n,a=s[13].options.length===1&&s[13].options[0].fields.length===0&&te(s),r=s[13].options.length===1&&s[13].options[0].fields.length>0&&ie(s),o=s[13].options.length>1&&le(s);return{c(){e=S("div"),a&&a.c(),i=$(),r&&r.c(),t=$(),o&&o.c(),l=$()},m(c,g){k(c,e,g),a&&a.m(e,null),y(e,i),r&&r.m(e,null),y(e,t),o&&o.m(e,null),y(e,l),n=!0},p(c,g){c[13].options.length===1&&c[13].options[0].fields.length===0?a?(a.p(c,g),g&1&&u(a,1)):(a=te(c),a.c(),u(a,1),a.m(e,i)):a&&(T(),p(a,1,1,()=>{a=null}),D()),c[13].options.length===1&&c[13].options[0].fields.length>0?r?(r.p(c,g),g&1&&u(r,1)):(r=ie(c),r.c(),u(r,1),r.m(e,t)):r&&(T(),p(r,1,1,()=>{r=null}),D()),c[13].options.length>1?o?(o.p(c,g),g&1&&u(o,1)):(o=le(c),o.c(),u(o,1),o.m(e,l)):o&&(T(),p(o,1,1,()=>{o=null}),D())},i(c){n||(u(a),u(r),u(o),n=!0)},o(c){p(a),p(r),p(o),n=!1},d(c){c&&L(e),a&&a.d(),r&&r.d(),o&&o.d()}}}function He(s){let e,i,t=s[0].layerDef.name&&x(s);return{c(){t&&t.c(),e=E()},m(l,n){t&&t.m(l,n),k(l,e,n),i=!0},p(l,[n]){l[0].layerDef.name?t?(t.p(l,n),n&1&&u(t,1)):(t=x(l),t.c(),u(t,1),t.m(e.parentNode,e)):t&&(T(),p(t,1,1,()=>{t=null}),D())},i(l){i||(u(t),i=!0)},o(l){p(t),i=!1},d(l){t&&t.d(l),l&&L(e)}}}function Ke(s,e,i){let t,l=C,n=()=>(l(),l=Ie(c,m=>i(3,t=m)),c),a;s.$$.on_destroy.push(()=>l());let{filteredLayer:r}=e,{highlightedLayer:o=new V(void 0)}=e,{zoomlevel:c=new V(22)}=e;n();let g=r.layerDef,v=r.isDisplayed;fe(s,v,m=>i(4,a=m));function _(m){return r.appliedFilters.get(m.id).sync(A=>A===0,[],A=>A?0:void 0)}function b(m){return r.appliedFilters.get(m.id)}let d;const h=()=>{var m;return(m=g.defaultIcon())==null?void 0:m.SetClass("block h-6 w-6 no-image-background opacity-50")},w=()=>{var m;return(m=g.defaultIcon())==null?void 0:m.SetClass("block h-6 w-6 no-image-background")};function q(m){Fe[m?"unshift":"push"](()=>{d=m,i(2,d)})}return s.$$set=m=>{"filteredLayer"in m&&i(0,r=m.filteredLayer),"highlightedLayer"in m&&i(9,o=m.highlightedLayer),"zoomlevel"in m&&n(i(1,c=m.zoomlevel))},s.$$.update=()=>{s.$$.dirty&517&&ce(o.addCallbackAndRun(m=>{var Q,A;m===r.layerDef.id?(Q=d==null?void 0:d.classList)==null||Q.add("glowing-shadow"):(A=d==null?void 0:d.classList)==null||A.remove("glowing-shadow")}))},[r,c,d,t,a,g,v,_,b,o,h,w,q]}class tt extends O{constructor(e){super(),M(this,e,Ke,He,N,{filteredLayer:0,highlightedLayer:9,zoomlevel:1})}}export{de as C,tt as F,R as L};
