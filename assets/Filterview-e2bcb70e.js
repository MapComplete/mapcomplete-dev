import{S as Z,i as E,s as x,e as S,d,t as c,C as b,D as $,g as m,h as g,O,E as ee,F as te,l as C,P as q,Q as N,n as F,c as k,a as L,b as I,m as v,f as D,j as w,L as ie,o as re}from"./index-ef97fd34.js";import{U as se}from"./Utils-cf50a89b.js";import{L as fe,T as ae,a as ue}from"./Tr-08267f1f.js";import{s as ce}from"./Dropdown-df8d17c7.js";import"./Constants-33c50e4a.js";import{U as _e,I as P}from"./LocalStorageSource-9618259f.js";import{T as le}from"./ToSvelte-2c8283e3.js";import{F as me,V as pe,C as ne,I as de}from"./If-4f78a9c8.js";function j(s,t,n){const e=s.slice();return e[11]=t[n],e[13]=n,e}function ge(s){let t=s[11].message+"",n;return{c(){n=q(t)},m(e,l){d(e,n,l)},p(e,l){l&1&&t!==(t=e[11].message+"")&&N(n,t)},i:F,o:F,d(e){e&&g(n)}}}function he(s){let t,n,e,l;return n=new pe({props:{value:s[1][s[11].subs],type:s[2][s[11].subs]}}),{c(){t=S("span"),k(n.$$.fragment),e=L(),I(t,"class","mx-1")},m(r,o){d(r,t,o),v(n,t,null),D(t,e),l=!0},p(r,o){const f={};o&3&&(f.value=r[1][r[11].subs]),o&5&&(f.type=r[2][r[11].subs]),n.$set(f)},i(r){l||(c(n.$$.fragment,r),l=!0)},o(r){m(n.$$.fragment,r),l=!1},d(r){r&&g(t),w(n)}}}function A(s){let t,n,e,l;const r=[he,ge],o=[];function f(i,a){return i[11].subs?0:1}return t=f(s),n=o[t]=r[t](s),{c(){n.c(),e=C()},m(i,a){o[t].m(i,a),d(i,e,a),l=!0},p(i,a){let u=t;t=f(i),t===u?o[t].p(i,a):(b(),m(o[u],1,1,()=>{o[u]=null}),$(),n=o[t],n?n.p(i,a):(n=o[t]=r[t](i),n.c()),c(n,1),n.m(e.parentNode,e))},i(i){l||(c(n),l=!0)},o(i){m(n),l=!1},d(i){o[t].d(i),i&&g(e)}}}function be(s){let t,n,e=s[0],l=[];for(let o=0;o<e.length;o+=1)l[o]=A(j(s,e,o));const r=o=>m(l[o],1,1,()=>{l[o]=null});return{c(){t=S("div");for(let o=0;o<l.length;o+=1)l[o].c()},m(o,f){d(o,t,f);for(let i=0;i<l.length;i+=1)l[i]&&l[i].m(t,null);n=!0},p(o,[f]){if(f&7){e=o[0];let i;for(i=0;i<e.length;i+=1){const a=j(o,e,i);l[i]?(l[i].p(a,f),c(l[i],1)):(l[i]=A(a),l[i].c(),c(l[i],1),l[i].m(t,null))}for(b(),i=e.length;i<l.length;i+=1)r(i);$()}},i(o){if(!n){for(let f=0;f<e.length;f+=1)c(l[f]);n=!0}},o(o){l=l.filter(Boolean);for(let f=0;f<l.length;f+=1)m(l[f]);n=!1},d(o){o&&g(t),O(l,o)}}}function $e(s,t,n){let e,{filteredLayer:l}=t,{option:r}=t,{id:o}=t,f,i=fe.language;ee(s,i,_=>n(7,e=_));let a={},u={},h=l.appliedFilters.get(o),U=JSON.parse((h==null?void 0:h.data)??"{}");function B(){const _={};for(const y in a){const T=a[y].data;T===void 0?_[y]=void 0:_[y]=T}h==null||h.setData(me.fieldsToString(_))}for(const _ of r.fields){const y=new _e(U[_.name]??"");u[_.name]=_.type,a[_.name]=y,te(y.stabilized(200).addCallback(()=>{B()}))}return s.$$set=_=>{"filteredLayer"in _&&n(4,l=_.filteredLayer),"option"in _&&n(5,r=_.option),"id"in _&&n(6,o=_.id)},s.$$.update=()=>{if(s.$$.dirty&160){const _=r.question.textFor(e);n(0,f=se.splitIntoSubstitutionParts(_))}},[f,a,u,i,l,r,o,e]}class ke extends Z{constructor(t){super(),E(this,t,$e,be,x,{filteredLayer:4,option:5,id:6})}}function J(s,t,n){const e=s.slice();return e[13]=t[n],e}function Q(s,t,n){const e=s.slice();return e[16]=t[n],e[18]=n,e}function R(s){var o;let t,n,e,l;n=new ne({props:{selected:s[6],$$slots:{default:[ye]},$$scope:{ctx:s}}});let r=s[4]&&((o=s[0].layerDef.filters)==null?void 0:o.length)>0&&G(s);return{c(){t=S("div"),k(n.$$.fragment),e=L(),r&&r.c(),I(t,"class","mb-1.5")},m(f,i){d(f,t,i),v(n,t,null),D(t,e),r&&r.m(t,null),s[12](t),l=!0},p(f,i){var u;const a={};i&524297&&(a.$$scope={dirty:i,ctx:f}),n.$set(a),f[4]&&((u=f[0].layerDef.filters)==null?void 0:u.length)>0?r?(r.p(f,i),i&17&&c(r,1)):(r=G(f),r.c(),c(r,1),r.m(t,null)):r&&(b(),m(r,1,1,()=>{r=null}),$())},i(f){l||(c(n.$$.fragment,f),c(r),l=!0)},o(f){m(n.$$.fragment,f),m(r),l=!1},d(f){f&&g(t),w(n),r&&r.d(),s[12](null)}}}function ve(s){let t,n;return t=new le({props:{construct:s[11]}}),{c(){k(t.$$.fragment)},m(e,l){v(t,e,l),n=!0},p:F,i(e){n||(c(t.$$.fragment,e),n=!0)},o(e){m(t.$$.fragment,e),n=!1},d(e){w(t,e)}}}function we(s){let t,n;return t=new le({props:{slot:"else",construct:s[10]}}),{c(){k(t.$$.fragment)},m(e,l){v(t,e,l),n=!0},p:F,i(e){n||(c(t.$$.fragment,e),n=!0)},o(e){m(t.$$.fragment,e),n=!1},d(e){w(t,e)}}}function W(s){let t,n,e;return n=new ae({props:{t:ue.t.general.layerSelection.zoomInToSeeThisLayer}}),{c(){t=S("span"),k(n.$$.fragment),I(t,"class","alert")},m(l,r){d(l,t,r),v(n,t,null),e=!0},p:F,i(l){e||(c(n.$$.fragment,l),e=!0)},o(l){m(n.$$.fragment,l),e=!1},d(l){l&&g(t),w(n)}}}function ye(s){let t,n,e=s[0].layerDef.name+"",l,r,o,f;t=new de({props:{condition:s[0].isDisplayed,$$slots:{else:[we],default:[ve]},$$scope:{ctx:s}}});let i=s[3]<s[5].minzoom&&W();return{c(){k(t.$$.fragment),n=L(),l=q(e),r=L(),i&&i.c(),o=C()},m(a,u){v(t,a,u),d(a,n,u),d(a,l,u),d(a,r,u),i&&i.m(a,u),d(a,o,u),f=!0},p(a,u){const h={};u&1&&(h.condition=a[0].isDisplayed),u&524288&&(h.$$scope={dirty:u,ctx:a}),t.$set(h),(!f||u&1)&&e!==(e=a[0].layerDef.name+"")&&N(l,e),a[3]<a[5].minzoom?i?(i.p(a,u),u&8&&c(i,1)):(i=W(),i.c(),c(i,1),i.m(o.parentNode,o)):i&&(b(),m(i,1,1,()=>{i=null}),$())},i(a){f||(c(t.$$.fragment,a),c(i),f=!0)},o(a){m(t.$$.fragment,a),m(i),f=!1},d(a){w(t,a),a&&g(n),a&&g(l),a&&g(r),i&&i.d(a),a&&g(o)}}}function G(s){let t,n,e=s[0].layerDef.filters,l=[];for(let o=0;o<e.length;o+=1)l[o]=Y(J(s,e,o));const r=o=>m(l[o],1,1,()=>{l[o]=null});return{c(){t=S("div");for(let o=0;o<l.length;o+=1)l[o].c();I(t,"id","subfilters"),I(t,"class","ml-4 flex flex-col gap-y-1")},m(o,f){d(o,t,f);for(let i=0;i<l.length;i+=1)l[i]&&l[i].m(t,null);n=!0},p(o,f){if(f&385){e=o[0].layerDef.filters;let i;for(i=0;i<e.length;i+=1){const a=J(o,e,i);l[i]?(l[i].p(a,f),c(l[i],1)):(l[i]=Y(a),l[i].c(),c(l[i],1),l[i].m(t,null))}for(b(),i=e.length;i<l.length;i+=1)r(i);$()}},i(o){if(!n){for(let f=0;f<e.length;f+=1)c(l[f]);n=!0}},o(o){l=l.filter(Boolean);for(let f=0;f<l.length;f+=1)m(l[f]);n=!1},d(o){o&&g(t),O(l,o)}}}function H(s){let t,n;return t=new ne({props:{selected:s[7](s[13]),$$slots:{default:[Le]},$$scope:{ctx:s}}}),{c(){k(t.$$.fragment)},m(e,l){v(t,e,l),n=!0},p(e,l){const r={};l&1&&(r.selected=e[7](e[13])),l&524289&&(r.$$scope={dirty:l,ctx:e}),t.$set(r)},i(e){n||(c(t.$$.fragment,e),n=!0)},o(e){m(t.$$.fragment,e),n=!1},d(e){w(t,e)}}}function Le(s){let t=s[13].options[0].question+"",n;return{c(){n=q(t)},m(e,l){d(e,n,l)},p(e,l){l&1&&t!==(t=e[13].options[0].question+"")&&N(n,t)},d(e){e&&g(n)}}}function K(s){let t,n;return t=new ke({props:{id:s[13].id,filteredLayer:s[0],option:s[13].options[0]}}),{c(){k(t.$$.fragment)},m(e,l){v(t,e,l),n=!0},p(e,l){const r={};l&1&&(r.id=e[13].id),l&1&&(r.filteredLayer=e[0]),l&1&&(r.option=e[13].options[0]),t.$set(r)},i(e){n||(c(t.$$.fragment,e),n=!0)},o(e){m(t.$$.fragment,e),n=!1},d(e){w(t,e)}}}function M(s){let t,n;return t=new ce({props:{value:s[8](s[13]),$$slots:{default:[De]},$$scope:{ctx:s}}}),{c(){k(t.$$.fragment)},m(e,l){v(t,e,l),n=!0},p(e,l){const r={};l&1&&(r.value=e[8](e[13])),l&524289&&(r.$$scope={dirty:l,ctx:e}),t.$set(r)},i(e){n||(c(t.$$.fragment,e),n=!0)},o(e){m(t.$$.fragment,e),n=!1},d(e){w(t,e)}}}function X(s){let t,n=s[16].question+"",e,l;return{c(){t=S("option"),e=q(n),l=L(),t.__value=s[18],t.value=t.__value},m(r,o){d(r,t,o),D(t,e),D(t,l)},p(r,o){o&1&&n!==(n=r[16].question+"")&&N(e,n)},d(r){r&&g(t)}}}function De(s){let t,n=s[13].options,e=[];for(let l=0;l<n.length;l+=1)e[l]=X(Q(s,n,l));return{c(){for(let l=0;l<e.length;l+=1)e[l].c();t=C()},m(l,r){for(let o=0;o<e.length;o+=1)e[o]&&e[o].m(l,r);d(l,t,r)},p(l,r){if(r&1){n=l[13].options;let o;for(o=0;o<n.length;o+=1){const f=Q(l,n,o);e[o]?e[o].p(f,r):(e[o]=X(f),e[o].c(),e[o].m(t.parentNode,t))}for(;o<e.length;o+=1)e[o].d(1);e.length=n.length}},d(l){O(e,l),l&&g(t)}}}function Y(s){let t,n,e,l,r,o=s[13].options.length===1&&s[13].options[0].fields.length===0&&H(s),f=s[13].options.length===1&&s[13].options[0].fields.length>0&&K(s),i=s[13].options.length>1&&M(s);return{c(){t=S("div"),o&&o.c(),n=L(),f&&f.c(),e=L(),i&&i.c(),l=L()},m(a,u){d(a,t,u),o&&o.m(t,null),D(t,n),f&&f.m(t,null),D(t,e),i&&i.m(t,null),D(t,l),r=!0},p(a,u){a[13].options.length===1&&a[13].options[0].fields.length===0?o?(o.p(a,u),u&1&&c(o,1)):(o=H(a),o.c(),c(o,1),o.m(t,n)):o&&(b(),m(o,1,1,()=>{o=null}),$()),a[13].options.length===1&&a[13].options[0].fields.length>0?f?(f.p(a,u),u&1&&c(f,1)):(f=K(a),f.c(),c(f,1),f.m(t,e)):f&&(b(),m(f,1,1,()=>{f=null}),$()),a[13].options.length>1?i?(i.p(a,u),u&1&&c(i,1)):(i=M(a),i.c(),c(i,1),i.m(t,l)):i&&(b(),m(i,1,1,()=>{i=null}),$())},i(a){r||(c(o),c(f),c(i),r=!0)},o(a){m(o),m(f),m(i),r=!1},d(a){a&&g(t),o&&o.d(),f&&f.d(),i&&i.d()}}}function Se(s){let t,n,e=s[0].layerDef.name&&R(s);return{c(){e&&e.c(),t=C()},m(l,r){e&&e.m(l,r),d(l,t,r),n=!0},p(l,[r]){l[0].layerDef.name?e?(e.p(l,r),r&1&&c(e,1)):(e=R(l),e.c(),c(e,1),e.m(t.parentNode,t)):e&&(b(),m(e,1,1,()=>{e=null}),$())},i(l){n||(c(e),n=!0)},o(l){m(e),n=!1},d(l){e&&e.d(l),l&&g(t)}}}function ze(s,t,n){let e,l=F,r=()=>(l(),l=ie(a,p=>n(3,e=p)),a),o;s.$$.on_destroy.push(()=>l());let{filteredLayer:f}=t,{highlightedLayer:i=new P(void 0)}=t,{zoomlevel:a=new P(22)}=t;r();let u=f.layerDef,h=f.isDisplayed;ee(s,h,p=>n(4,o=p));function U(p){return f.appliedFilters.get(p.id).sync(z=>z===0,[],z=>z?0:void 0)}function B(p){return f.appliedFilters.get(p.id)}let _;const y=()=>{var p;return(p=u.defaultIcon())==null?void 0:p.SetClass("block h-6 w-6 no-image-background opacity-50")},T=()=>{var p;return(p=u.defaultIcon())==null?void 0:p.SetClass("block h-6 w-6 no-image-background")};function oe(p){re[p?"unshift":"push"](()=>{_=p,n(2,_)})}return s.$$set=p=>{"filteredLayer"in p&&n(0,f=p.filteredLayer),"highlightedLayer"in p&&n(9,i=p.highlightedLayer),"zoomlevel"in p&&r(n(1,a=p.zoomlevel))},s.$$.update=()=>{s.$$.dirty&517&&te(i.addCallbackAndRun(p=>{var V,z;p===f.layerDef.id?(V=_==null?void 0:_.classList)==null||V.add("glowing-shadow"):(z=_==null?void 0:_.classList)==null||z.remove("glowing-shadow")}))},[f,a,_,e,o,u,h,U,B,i,y,T,oe]}class Ve extends Z{constructor(t){super(),E(this,t,ze,Se,x,{filteredLayer:0,highlightedLayer:9,zoomlevel:1})}}export{Ve as F};
//# sourceMappingURL=Filterview-e2bcb70e.js.map
