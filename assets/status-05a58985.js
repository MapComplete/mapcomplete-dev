import"./modulepreload-polyfill-3cfb730f.js";import{S as A,i as B,s as G,D as ee,k as M,l as X,b as E,p as R,d as h,f as L,q as F,E as te,F as re,G as se,r as ne,t as _,g,h as $,u as oe,v as x,w as ae,x as J,y as V,z as j,A as T,N as P,O as z,n as N,c as k,m as D,j as y,B as W,e as q,a as U,M as le}from"./index-333c7d73.js";import{a as v,U as w}from"./UIEventSource-d7cbe0b0.js";import{L as Y}from"./Loading-d3eb8a8f.js";import{X as ie}from"./XCircle-f7d7242b.js";import{t as C}from"./tw-join-70ce42f3.js";import{E as ce}from"./Exclamation-0e9d9de5.js";import{A as ue}from"./AccordionSingle-bc92d3b8.js";import{O as fe}from"./OsmConnection-1d7eb7a3.js";import{C as S}from"./Constants-9c9daa5d.js";import"./Loading-dbd65049.js";import"./LocalStorageSource-60367253.js";function me(a){let e,r,t,n,l;const u=a[2].default,m=ee(u,a,a[1],null);let c=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 20 20"},{fill:"currentColor"},{"aria-hidden":"true"},a[0]],i={};for(let s=0;s<c.length;s+=1)i=M(i,c[s]);return{c(){e=X("svg"),m&&m.c(),r=X("path"),E(r,"fill-rule","evenodd"),E(r,"d","M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z"),E(r,"clip-rule","evenodd"),R(e,i)},m(s,f){h(s,e,f),m&&m.m(e,null),L(e,r),t=!0,n||(l=[F(e,"click",a[3]),F(e,"mouseover",a[4]),F(e,"mouseenter",a[5]),F(e,"mouseleave",a[6]),F(e,"keydown",a[7])],n=!0)},p(s,[f]){m&&m.p&&(!t||f&2)&&te(m,u,s,s[1],t?se(u,s[1],f,null):re(s[1]),null),R(e,i=ne(c,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 20 20"},{fill:"currentColor"},{"aria-hidden":"true"},f&1&&s[0]]))},i(s){t||(_(m,s),t=!0)},o(s){g(m,s),t=!1},d(s){s&&$(e),m&&m.d(s),n=!1,oe(l)}}}function de(a,e,r){const t=[];let n=x(e,t),{$$slots:l={},$$scope:u}=e;function m(o){J.call(this,a,o)}function c(o){J.call(this,a,o)}function i(o){J.call(this,a,o)}function s(o){J.call(this,a,o)}function f(o){J.call(this,a,o)}return a.$$set=o=>{e=M(M({},e),ae(o)),r(0,n=x(e,t)),"$$scope"in o&&r(1,u=o.$$scope)},[n,u,l,m,c,i,s,f]}class pe extends A{constructor(e){super(),B(this,e,de,me,G,{})}}function _e(a){let e,r;return{c(){e=P("? "),r=P(a[0])},m(t,n){h(t,e,n),h(t,r,n)},p(t,n){n&1&&z(r,t[0])},i:N,o:N,d(t){t&&$(e),t&&$(r)}}}function ge(a){let e,r;return e=new Y({}),{c(){k(e.$$.fragment)},m(t,n){D(e,t,n),r=!0},p:N,i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){g(e.$$.fragment,t),r=!1},d(t){y(e,t)}}}function he(a){let e,r;return e=new ie({props:{class:C(a[1],"rounded-full"),style:"color: #bb2222"}}),{c(){k(e.$$.fragment)},m(t,n){D(e,t,n),r=!0},p(t,n){const l={};n&2&&(l.class=C(t[1],"rounded-full")),e.$set(l)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){g(e.$$.fragment,t),r=!1},d(t){y(e,t)}}}function $e(a){let e,r;return e=new ce({props:{class:C(a[1],"rounded-full"),style:"color: #eecc22"}}),{c(){k(e.$$.fragment)},m(t,n){D(e,t,n),r=!0},p(t,n){const l={};n&2&&(l.class=C(t[1],"rounded-full")),e.$set(l)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){g(e.$$.fragment,t),r=!1},d(t){y(e,t)}}}function ve(a){let e,r;return e=new pe({props:{class:C(a[1],"rounded-full"),style:"color: #22cc22"}}),{c(){k(e.$$.fragment)},m(t,n){D(e,t,n),r=!0},p(t,n){const l={};n&2&&(l.class=C(t[1],"rounded-full")),e.$set(l)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){g(e.$$.fragment,t),r=!1},d(t){y(e,t)}}}function we(a){let e,r,t,n;const l=[ve,$e,he,ge,_e],u=[];function m(c,i){return c[0]==="online"?0:c[0]==="degraded"?1:c[0]==="offline"?2:c[0]===void 0?3:4}return e=m(a),r=u[e]=l[e](a),{c(){r.c(),t=V()},m(c,i){u[e].m(c,i),h(c,t,i),n=!0},p(c,[i]){let s=e;e=m(c),e===s?u[e].p(c,i):(j(),g(u[s],1,1,()=>{u[s]=null}),T(),r=u[e],r?r.p(c,i):(r=u[e]=l[e](c),r.c()),_(r,1),r.m(t.parentNode,t))},i(c){n||(_(r),n=!0)},o(c){g(r),n=!1},d(c){u[e].d(c),c&&$(t)}}}function be(a,e,r){let{status:t}=e,{cls:n="w-6 h-6 mx-1"}=e;return a.$$set=l=>{"status"in l&&r(0,t=l.status),"cls"in l&&r(1,n=l.cls)},[t,n]}class Z extends A{constructor(e){super(),B(this,e,be,we,G,{status:0,cls:1})}}function ke(a){let e;return{c(){e=P("No extra information available")},m(r,t){h(r,e,t)},p:N,d(r){r&&$(e)}}}function De(a){let e;return{c(){e=P(a[2])},m(r,t){h(r,e,t)},p(r,t){t&4&&z(e,r[2])},d(r){r&&$(e)}}}function ye(a){let e;function r(l,u){return l[2]?De:ke}let t=r(a),n=t(a);return{c(){e=q("div"),n.c(),E(e,"class","mx-4")},m(l,u){h(l,e,u),n.m(e,null)},p(l,u){t===(t=r(l))&&n?n.p(l,u):(n.d(1),n=t(l),n&&(n.c(),n.m(e,null)))},d(l){l&&$(e),n.d()}}}function Se(a){let e,r,t,n=a[0].name+"",l,u;return r=new Z({props:{status:a[1]}}),{c(){e=q("h3"),k(r.$$.fragment),t=U(),l=P(n),E(e,"slot","header"),E(e,"class","flex items-center m-0")},m(m,c){h(m,e,c),D(r,e,null),L(e,t),L(e,l),u=!0},p(m,c){const i={};c&2&&(i.status=m[1]),r.$set(i),(!u||c&1)&&n!==(n=m[0].name+"")&&z(l,n)},i(m){u||(_(r.$$.fragment,m),u=!0)},o(m){g(r.$$.fragment,m),u=!1},d(m){m&&$(e),y(r)}}}function Ee(a){let e,r;return e=new ue({props:{$$slots:{header:[Se],default:[ye]},$$scope:{ctx:a}}}),{c(){k(e.$$.fragment)},m(t,n){D(e,t,n),r=!0},p(t,[n]){const l={};n&39&&(l.$$scope={dirty:n,ctx:t}),e.$set(l)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){g(e.$$.fragment,t),r=!1},d(t){y(e,t)}}}function Ce(a,e,r){let t,n,{service:l}=e,u=l.status;W(a,u,c=>r(1,t=c));let m=l.message;return W(a,m,c=>r(2,n=c)),a.$$set=c=>{"service"in c&&r(0,l=c.service)},[l,t,n,u,m]}class Fe extends A{constructor(e){super(),B(this,e,Ce,Ee,G,{service:0})}}function H(a,e,r){const t=a.slice();return t[7]=e[r],t}function K(a){let e,r;return e=new Y({}),{c(){k(e.$$.fragment)},m(t,n){D(e,t,n),r=!0},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){g(e.$$.fragment,t),r=!1},d(t){y(e,t)}}}function Q(a){let e,r;return e=new Fe({props:{service:a[7]}}),{c(){k(e.$$.fragment)},m(t,n){D(e,t,n),r=!0},p:N,i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){g(e.$$.fragment,t),r=!1},d(t){y(e,t)}}}function Je(a){let e,r,t,n,l,u,m,c=a[0]&&K();n=new Z({props:{status:a[1],cls:"w-16 h-16"}});let i=a[2],s=[];for(let o=0;o<i.length;o+=1)s[o]=Q(H(a,i,o));const f=o=>g(s[o],1,1,()=>{s[o]=null});return{c(){e=q("h1"),e.textContent="MapComplete status indicators",r=U(),c&&c.c(),t=U(),k(n.$$.fragment),l=U();for(let o=0;o<s.length;o+=1)s[o].c();u=V()},m(o,d){h(o,e,d),h(o,r,d),c&&c.m(o,d),h(o,t,d),D(n,o,d),h(o,l,d);for(let b=0;b<s.length;b+=1)s[b]&&s[b].m(o,d);h(o,u,d),m=!0},p(o,[d]){o[0]?c?d&1&&_(c,1):(c=K(),c.c(),_(c,1),c.m(t.parentNode,t)):c&&(j(),g(c,1,1,()=>{c=null}),T());const b={};if(d&2&&(b.status=o[1]),n.$set(b),d&4){i=o[2];let p;for(p=0;p<i.length;p+=1){const O=H(o,i,p);s[p]?(s[p].p(O,d),_(s[p],1)):(s[p]=Q(O),s[p].c(),_(s[p],1),s[p].m(u.parentNode,u))}for(j(),p=i.length;p<s.length;p+=1)f(p);T()}},i(o){if(!m){_(c),_(n.$$.fragment,o);for(let d=0;d<i.length;d+=1)_(s[d]);m=!0}},o(o){g(c),g(n.$$.fragment,o),s=s.filter(Boolean);for(let d=0;d<s.length;d+=1)g(s[d]);m=!1},d(o){o&&$(e),o&&$(r),c&&c.d(o),o&&$(t),y(n,o),o&&$(l),le(s,o),o&&$(u)}}}function I(a){return a.mapD(e=>e.success?JSON.stringify(e.success):e.error)}function Pe(a,e,r){let t,n,l=[];{const i=new fe,s=i.apiIsOnline;l.push({name:i.Backend(),status:s.mapD(f=>{switch(f){case"offline":return"offline";case"online":return"online";case"readonly":return"degraded";case"unknown":return;case"unreachable":return"offline"}}),message:s})}{const i="https://studio.mapcomplete.org",s=v.FromPromiseWithErr(w.downloadJson(i+"/overview"));l.push({name:i,status:s.mapD(f=>{if(f.error)return"offline";const o=f.success.allFiles;return o.length<10?"offline":o.length<100?"degraded":"online"}),message:s.mapD(f=>f.error?f.error:"Contains "+(f.success.allFiles.length??"no")+" files")})}l.push({name:S.GeoIpServer,status:v.FromPromiseWithErr(w.downloadJson(S.GeoIpServer+"/status")).mapD(i=>i.success.online?"online":i.error?"offline":"degraded"),message:I(v.FromPromiseWithErr(w.downloadJson(S.GeoIpServer+"/ip")))});{const i=S.ErrorReportServer,s=v.FromPromiseWithErr(w.downloadJson(i.replace(/\/report$/,"/status")));l.push({name:i,status:s.mapD(f=>f.error?"offline":f.success.errors_today===0?"online":"degraded"),message:I(s)})}{const i=S.linkedDataProxy.replace(/\/[^/]*$/,""),s=v.FromPromiseWithErr(w.downloadJson(i+"/status"));l.push({name:i,status:s.mapD(f=>{if(f.error)return"offline";const o=f.success;return o.cached_entries<10||o.uptime<60*60?"degraded":"online"}),message:I(s)})}{const i=S.SummaryServer,s=v.FromPromiseWithErr(w.downloadJson(i+"/summary/status.json"));l.push({name:i,status:s.mapD(f=>{if(f.error)return"offline";console.log(f);const o=f.success.meta,d=new Date(o.current_timestamp);return console.log("Last update:",d,o.current_timestamp,o),(new Date().getTime()-d.getTime())/1e3/(60*60*26)>7?"degraded":"online"}),message:s.mapD(f=>{if(f.error)return f.error;const o=f.success.meta,d=new Date(o.current_timestamp),p=(new Date().getTime()-d.getTime())/1e3/(60*60*26),O=JSON.stringify(f.success,null,"  ");return"Database is "+Math.floor(p)+` days out of sync

`+O})})}{const i=S.countryCoderEndpoint,s=v.FromPromiseWithErr(w.downloadJson(i+"/0.0.0.json"));l.push({name:i,status:s.mapD(f=>{if(f.error)return"offline";const o=f.success;return Array.isArray(o)?"online":"degraded"}),message:s.map(f=>JSON.stringify(f))})}for(const i of S.defaultOverpassUrls){const s=i.replace(/\/interpreter$/,"/status"),f=v.FromPromiseWithErr(w.download(s));l.push({name:"Overpass-server: "+i,status:f.mapD(o=>o.error?"offline":(o.success.split(`
`),"online")),message:I(f)})}l.push({name:"Mangrove reviews",status:v.FromPromiseWithErr(w.download("https://api.mangrove.reviews")).mapD(i=>i.success?"online":"offline")});let u=new v("online");W(a,u,i=>r(1,n=i));let m=new v(!0);W(a,m,i=>r(0,t=i));function c(){const i=w.NoNull(l.map(s=>s.status.data));m.setData(i.length!==l.length),i.some(s=>s==="offline")?u.setData("offline"):i.some(s=>s==="degraded")?u.setData("degraded"):i.some(s=>s==="online")?u.setData("online"):u.setData(void 0)}for(const i of l)i.status.addCallbackD(()=>{c()});return[t,n,l,u,m]}class Ne extends A{constructor(e){super(),B(this,e,Pe,Je,G,{})}}class Oe{setup(){new Ne({target:document.getElementById("main")})}}new Oe().setup();
//# sourceMappingURL=status-05a58985.js.map
