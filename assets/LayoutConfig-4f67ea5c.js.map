{"version":3,"file":"LayoutConfig-4f67ea5c.js","sources":["../../src/Models/ThemeConfig/ExtraLinkConfig.ts","../../src/Models/ThemeConfig/LayoutConfig.ts"],"sourcesContent":["import ExtraLinkConfigJson from \"./Json/ExtraLinkConfigJson\"\nimport { Translation } from \"../../UI/i18n/Translation\"\nimport Translations from \"../../UI/i18n/Translations\"\n\nexport default class ExtraLinkConfig {\n    public readonly icon?: string\n    public readonly text?: Translation\n    public readonly href: string\n    public readonly newTab?: false | boolean\n    public readonly requirements?: Set<\n        \"iframe\" | \"no-iframe\" | \"welcome-message\" | \"no-welcome-message\"\n    >\n\n    constructor(configJson: ExtraLinkConfigJson, context) {\n        this.icon = configJson.icon\n        this.text = Translations.T(configJson.text, \"themes:\" + context + \".text\")\n        this.href = configJson.href\n        this.newTab = configJson.newTab\n        this.requirements = new Set(configJson.requirements)\n\n        for (let requirement of configJson.requirements) {\n            if (this.requirements.has(<any>(\"no-\" + requirement))) {\n                throw (\n                    \"Conflicting requirements found for \" +\n                    context +\n                    \".extraLink: both '\" +\n                    requirement +\n                    \"' and 'no-\" +\n                    requirement +\n                    \"' found\"\n                )\n            }\n        }\n\n        if (this.icon === undefined && this.text === undefined) {\n            throw (\n                \"At \" +\n                context +\n                \".extraLink: define at least an icon or a text to show. Both are undefined, this is not allowed\"\n            )\n        }\n    }\n}\n","import { Translation } from \"../../UI/i18n/Translation\"\nimport { LayoutConfigJson } from \"./Json/LayoutConfigJson\"\nimport LayerConfig from \"./LayerConfig\"\nimport { LayerConfigJson } from \"./Json/LayerConfigJson\"\nimport Constants from \"../Constants\"\nimport { ExtractImages } from \"./Conversion/FixImages\"\nimport ExtraLinkConfig from \"./ExtraLinkConfig\"\nimport { Utils } from \"../../Utils\"\nimport LanguageUtils from \"../../Utils/LanguageUtils\"\n\nimport { RasterLayerProperties } from \"../RasterLayerProperties\"\n\nimport { ConversionContext } from \"./Conversion/ConversionContext\"\nimport { Translatable } from \"./Json/Translatable\"\n\n/**\n * Minimal information about a theme\n **/\nexport class LayoutInformation {\n    id: string\n    icon: string\n    title: Translatable | Translation\n    shortDescription: Translatable | Translation\n    definition?: Translatable | Translation\n    mustHaveLanguage?: boolean\n    hideFromOverview?: boolean\n    keywords?: (Translatable | Translation)[]\n}\n\nexport default class LayoutConfig implements LayoutInformation {\n    public static readonly defaultSocialImage = \"assets/SocialImage.png\"\n    public readonly id: string\n    public readonly credits?: string\n    /**\n     * The languages this theme supports.\n     * Defaults to all languages the title has\n     */\n    public readonly language: string[]\n    public readonly title: Translation\n    public readonly shortDescription: Translation\n    public readonly description: Translation\n    public readonly descriptionTail?: Translation\n    public readonly icon: string\n    public readonly socialImage?: string\n    public readonly startZoom: number\n    public readonly startLat: number\n    public readonly startLon: number\n    public widenFactor: number\n    public defaultBackgroundId?: string\n    public layers: LayerConfig[]\n    public tileLayerSources: (RasterLayerProperties & { defaultState?: true | boolean })[]\n    public readonly hideFromOverview: boolean\n    public lockLocation: boolean | [[number, number], [number, number]]\n    public readonly enableUserBadge: boolean\n    public readonly enableShareScreen: boolean\n    public readonly enableMoreQuests: boolean\n    public readonly enableAddNewPoints: boolean\n    public readonly enableLayers: boolean\n    public readonly enableSearch: boolean\n    public readonly enableGeolocation: boolean\n    public readonly enableBackgroundLayerSelection: boolean\n    public readonly enableShowAllQuestions: boolean\n    public readonly enableExportButton: boolean\n    public readonly enablePdfDownload: boolean\n    public readonly enableTerrain: boolean\n    public readonly enableMorePrivacy: boolean\n\n    public readonly customCss?: string\n\n    public readonly overpassUrl: string[]\n    public overpassTimeout: number\n    public readonly overpassMaxZoom: number\n    public readonly osmApiTileSize: number\n    public readonly official: boolean\n\n    private usedImages: string[]\n    public readonly extraLink?: ExtraLinkConfig\n\n    public readonly definedAtUrl?: string\n    public readonly definitionRaw?: string\n\n    private readonly layersDict: Map<string, LayerConfig>\n    private readonly source: LayoutConfigJson\n\n    constructor(\n        json: LayoutConfigJson,\n        official = true,\n        options?: {\n            definedAtUrl?: string\n            definitionRaw?: string\n        }\n    ) {\n        if (json === undefined) {\n            throw \"Cannot construct a layout config, the parameter 'json' is undefined\"\n        }\n        this.source = json\n        this.official = official\n        this.id = json.id\n        this.definedAtUrl = options?.definedAtUrl\n        this.definitionRaw = options?.definitionRaw\n        if (official) {\n            if (json.id.toLowerCase() !== json.id) {\n                throw \"The id of a theme should be lowercase: \" + json.id\n            }\n            if (json.id.match(/[a-z0-9-_]/) == null) {\n                throw \"The id of a theme should match [a-z0-9-_]*: \" + json.id\n            }\n        }\n        const context = this.id\n        this.credits = Array.isArray(json.credits) ? json.credits.join(\"; \") : json.credits\n        if (!json.title) {\n            throw `The theme ${json.id} does not have a title defined.`\n        }\n        this.language = json.mustHaveLanguage ?? Object.keys(json.title)\n\n        {\n            if (typeof json.title === \"string\") {\n                throw `The title of a theme should always be a translation, as it sets the corresponding languages (${context}.title). The themenID is ${\n                    this.id\n                }; the offending object is ${JSON.stringify(\n                    json.title\n                )} which is a ${typeof json.title})`\n            }\n            if (this.language.length == 0) {\n                throw `No languages defined. Define at least one language. You can do this by adding a title`\n            }\n            if (json.title === undefined) {\n                throw \"Title not defined in \" + this.id\n            }\n            if (json.description === undefined) {\n                throw \"Description not defined in \" + this.id\n            }\n\n            if (json[\"hideInOverview\"]) {\n                throw (\n                    \"The json for \" +\n                    this.id +\n                    \" contains a 'hideInOverview'. Did you mean hideFromOverview instead?\"\n                )\n            }\n            if (json.layers === undefined) {\n                throw \"Got undefined layers for \" + json.id + \" at \" + context\n            }\n        }\n        this.title = new Translation(json.title, \"themes:\" + context + \".title\")\n        this.description = new Translation(json.description, \"themes:\" + context + \".description\")\n        this.shortDescription =\n            json.shortDescription === undefined\n                ? this.description.FirstSentence()\n                : new Translation(json.shortDescription, \"themes:\" + context + \".shortdescription\")\n        this.descriptionTail =\n            json.descriptionTail === undefined\n                ? undefined\n                : new Translation(json.descriptionTail, \"themes:\" + context + \".descriptionTail\")\n        this.icon = json.icon\n        this.socialImage = json.socialImage ?? LayoutConfig.defaultSocialImage\n        if (this.socialImage === \"\") {\n            if (official) {\n                throw \"Theme \" + json.id + \" has empty string as social image\"\n            }\n        }\n        this.startZoom = json.startZoom\n        this.startLat = json.startLat\n        this.startLon = json.startLon\n        this.widenFactor = 1.5\n\n        this.defaultBackgroundId = json.defaultBackgroundId\n        this.tileLayerSources = json.tileLayerSources ?? []\n        // At this point, layers should be expanded and validated either by the generateScript or the LegacyJsonConvert\n        this.layers = json.layers.map(\n            (lyrJson) =>\n                new LayerConfig(\n                    <LayerConfigJson>lyrJson,\n                    json.id + \".layers.\" + lyrJson[\"id\"],\n                    official\n                )\n        )\n\n        this.extraLink = new ExtraLinkConfig(\n            json.extraLink ?? {\n                icon: \"./assets/svg/pop-out.svg\",\n                href: \"https://{basepath}/{theme}.html?lat={lat}&lon={lon}&z={zoom}&language={language}\",\n                newTab: true,\n                requirements: [\"iframe\", \"no-welcome-message\"],\n            },\n            context + \".extraLink\"\n        )\n\n        this.hideFromOverview = json.hideFromOverview ?? false\n        this.lockLocation = <[[number, number], [number, number]]>json.lockLocation ?? undefined\n        this.enableUserBadge = json.enableUserBadge ?? true\n        this.enableShareScreen = json.enableShareScreen ?? true\n        this.enableMoreQuests = json.enableMoreQuests ?? true\n        this.enableLayers = json.enableLayers ?? true\n        this.enableSearch = json.enableSearch ?? true\n        this.enableGeolocation = json.enableGeolocation ?? true\n        this.enableAddNewPoints = json.enableAddNewPoints ?? true\n        this.enableBackgroundLayerSelection = json.enableBackgroundLayerSelection ?? true\n        this.enableShowAllQuestions = json.enableShowAllQuestions ?? false\n        this.enableExportButton = json.enableDownload ?? true\n        this.enablePdfDownload = json.enablePdfDownload ?? true\n        this.enableTerrain = json.enableTerrain ?? false\n        this.customCss = json.customCss\n        this.overpassUrl = json.overpassUrl ?? Constants.defaultOverpassUrls\n        this.overpassTimeout = json.overpassTimeout ?? 30\n        this.overpassMaxZoom = json.overpassMaxZoom ?? 16\n        this.osmApiTileSize = json.osmApiTileSize ?? this.overpassMaxZoom + 1\n        this.enableMorePrivacy =\n            json.enableMorePrivacy ||\n            json.layers.some((l) => (<LayerConfigJson>l).enableMorePrivacy)\n\n        this.layersDict = new Map<string, LayerConfig>()\n        for (const layer of this.layers) {\n            this.layersDict.set(layer.id, layer)\n        }\n    }\n\n    public CustomCodeSnippets(): string[] {\n        if (this.official) {\n            return []\n        }\n        const msg =\n            \"<br/><b>This layout uses <span class='alert'>custom javascript</span>, loaded for the wide internet. The code is printed below, please report suspicious code on the issue tracker of MapComplete:</b><br/>\"\n        const custom = []\n        for (const layer of this.layers) {\n            custom.push(...layer.CustomCodeSnippets().map((code) => code + \"<br />\"))\n        }\n        if (custom.length === 0) {\n            return custom\n        }\n        custom.splice(0, 0, msg)\n        return custom\n    }\n\n    public getLayer(id: string) {\n        return this.layersDict.get(id)\n    }\n\n    public isLeftRightSensitive() {\n        return this.layers.some((l) => l.isLeftRightSensitive())\n    }\n\n    public hasNoteLayer() {\n        return this.layers.some((l) => l.id === \"note\")\n    }\n\n    public hasPresets() {\n        return this.layers.some((l) => l.presets?.length > 0)\n    }\n\n    public missingTranslations(extraInspection: any): {\n        untranslated: Map<string, string[]>\n        total: number\n    } {\n        let total = 0\n        const untranslated = new Map<string, string[]>()\n\n        Utils.WalkObject(\n            [this, extraInspection],\n            (o) => {\n                const translation = <Translation>(<any>o)\n                if (translation.translations[\"*\"] !== undefined) {\n                    return\n                }\n                if (translation.context === undefined || translation.context.indexOf(\":\") < 0) {\n                    // no source given - lets ignore\n                    return\n                }\n\n                total++\n                LanguageUtils.usedLanguagesSorted.forEach((ln) => {\n                    const trans = translation.translations\n                    if (trans[\"*\"] !== undefined) {\n                        return\n                    }\n                    if (translation.context.indexOf(\":\") < 0) {\n                        return\n                    }\n                    if (trans[ln] === undefined) {\n                        if (!untranslated.has(ln)) {\n                            untranslated.set(ln, [])\n                        }\n                        untranslated\n                            .get(ln)\n                            .push(\n                                translation.context.replace(\n                                    /^note_import_[a-zA-Z0-9_]*/,\n                                    \"note_import\"\n                                )\n                            )\n                    }\n                })\n            },\n            (o) => {\n                if (o === undefined || o === null) {\n                    return false\n                }\n                return o instanceof Translation\n            }\n        )\n\n        return { untranslated, total }\n    }\n    public getMatchingLayer(tags: Record<string, string>): LayerConfig | undefined {\n        if (tags === undefined) {\n            return undefined\n        }\n        if (tags.id.startsWith(\"current_view\")) {\n            return this.getLayer(\"current_view\")\n        }\n        for (const layer of this.layers) {\n            if (!layer.source) {\n                if (layer.isShown?.matchesProperties(tags)) {\n                    return layer\n                }\n                continue\n            }\n            if (layer.source.osmTags.matchesProperties(tags)) {\n                if (!layer.isShown || layer.isShown.matchesProperties(tags)) {\n                    // https://github.com/pietervdvn/MapComplete/issues/1959\n                    return layer\n                }\n            }\n        }\n        console.log(\"Fallthrough\", this, tags)\n        return undefined\n    }\n\n    public getUsedImages() {\n        if (this.usedImages) {\n            return this.usedImages\n        }\n        const json = this.source\n        // The 'favourite'-layer contains pretty much all images as it bundles all layers, so we exclude it\n        const jsonNoFavourites = {\n            ...json,\n            layers: json.layers.filter((l) => l[\"id\"] !== \"favourite\"),\n        }\n        const usedImages =\n            new ExtractImages(this.official, undefined)\n                .convertStrict(\n                    jsonNoFavourites,\n                    ConversionContext.construct([json.id], [\"ExtractImages\"])\n                )\n                .flatMap((i) => i.path)\n        usedImages.sort()\n\n        this.usedImages = Utils.Dedup(usedImages)\n        return this.usedImages\n    }\n}\n"],"names":["ExtraLinkConfig","configJson","context","__publicField","Translations","requirement","_LayoutConfig","json","official","options","Translation","lyrJson","LayerConfig","Constants","l","layer","msg","custom","code","id","_a","extraInspection","total","untranslated","Utils","o","translation","LanguageUtils","ln","trans","tags","jsonNoFavourites","usedImages","ExtractImages","ConversionContext","i","LayoutConfig"],"mappings":"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"}