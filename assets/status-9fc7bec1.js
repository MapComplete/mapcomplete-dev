import"./modulepreload-polyfill-3cfb730f.js";import{S as Y,i as Z,s as x,D as ge,k as ee,l as re,b as U,p as ae,d as D,f as j,q as M,E as he,F as $e,G as ke,r as be,t as $,g as b,h as S,u as me,v as oe,w as ve,x as q,y as we,z as Q,A as V,N as z,O as te,n as W,e as R,c as O,m as N,j as A,B as X,a as E,M as De}from"./index-c311521b.js";import{a as F,S as Se,U as L}from"./UIEventSource-8b436857.js";import{L as de}from"./Loading-fd21a5f0.js";import{X as ye}from"./XCircle-a9cd6f86.js";import{t as T}from"./tw-join-70ce42f3.js";import{E as Ce,C as pe}from"./Checkbox-0316d5e0.js";import{A as Oe}from"./AccordionSingle-f746a702.js";import{O as Ne}from"./OsmConnection-ad605a7f.js";import{C as I}from"./Constants-6e685be0.js";import"./Loading-e87e783e.js";import"./LocalStorageSource-465b9dd6.js";function Ae(s){let e,n,t,r,a;const c=s[2].default,m=ge(c,s,s[1],null);let u=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 20 20"},{fill:"currentColor"},{"aria-hidden":"true"},s[0]],_={};for(let d=0;d<u.length;d+=1)_=ee(_,u[d]);return{c(){e=re("svg"),m&&m.c(),n=re("path"),U(n,"fill-rule","evenodd"),U(n,"d","M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z"),U(n,"clip-rule","evenodd"),ae(e,_)},m(d,k){D(d,e,k),m&&m.m(e,null),j(e,n),t=!0,r||(a=[M(e,"click",s[3]),M(e,"mouseover",s[4]),M(e,"mouseenter",s[5]),M(e,"mouseleave",s[6]),M(e,"keydown",s[7])],r=!0)},p(d,[k]){m&&m.p&&(!t||k&2)&&he(m,c,d,d[1],t?ke(c,d[1],k,null):$e(d[1]),null),ae(e,_=be(u,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 20 20"},{fill:"currentColor"},{"aria-hidden":"true"},k&1&&d[0]]))},i(d){t||($(m,d),t=!0)},o(d){b(m,d),t=!1},d(d){d&&S(e),m&&m.d(d),r=!1,me(a)}}}function Ie(s,e,n){const t=[];let r=oe(e,t),{$$slots:a={},$$scope:c}=e;function m(h){q.call(this,s,h)}function u(h){q.call(this,s,h)}function _(h){q.call(this,s,h)}function d(h){q.call(this,s,h)}function k(h){q.call(this,s,h)}return s.$$set=h=>{e=ee(ee({},e),ve(h)),n(0,r=oe(e,t)),"$$scope"in h&&n(1,c=h.$$scope)},[r,c,a,m,u,_,d,k]}class Le extends Y{constructor(e){super(),Z(this,e,Ie,Ae,x,{})}}function Ue(s){let e,n;return{c(){e=z("? "),n=z(s[0])},m(t,r){D(t,e,r),D(t,n,r)},p(t,r){r&1&&te(n,t[0])},i:W,o:W,d(t){t&&S(e),t&&S(n)}}}function Ee(s){let e,n,t,r;return n=new de({}),{c(){e=R("div"),O(n.$$.fragment),U(e,"class",t=T(s[1],"shrink-0 rounded-full"))},m(a,c){D(a,e,c),N(n,e,null),r=!0},p(a,c){(!r||c&2&&t!==(t=T(a[1],"shrink-0 rounded-full")))&&U(e,"class",t)},i(a){r||($(n.$$.fragment,a),r=!0)},o(a){b(n.$$.fragment,a),r=!1},d(a){a&&S(e),A(n)}}}function Te(s){let e,n;return e=new ye({props:{class:T(s[1],"shrink-0 rounded-full"),style:"color: #bb2222"}}),{c(){O(e.$$.fragment)},m(t,r){N(e,t,r),n=!0},p(t,r){const a={};r&2&&(a.class=T(t[1],"shrink-0 rounded-full")),e.$set(a)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){b(e.$$.fragment,t),n=!1},d(t){A(e,t)}}}function Je(s){let e,n;return e=new Ce({props:{class:T(s[1],"shrink-0  rounded-full"),style:"color: #eecc22"}}),{c(){O(e.$$.fragment)},m(t,r){N(e,t,r),n=!0},p(t,r){const a={};r&2&&(a.class=T(t[1],"shrink-0  rounded-full")),e.$set(a)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){b(e.$$.fragment,t),n=!1},d(t){A(e,t)}}}function Be(s){let e,n;return e=new Le({props:{class:T(s[1],"shrink-0 rounded-full"),style:"color: #22cc22"}}),{c(){O(e.$$.fragment)},m(t,r){N(e,t,r),n=!0},p(t,r){const a={};r&2&&(a.class=T(t[1],"shrink-0 rounded-full")),e.$set(a)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){b(e.$$.fragment,t),n=!1},d(t){A(e,t)}}}function Ge(s){let e,n,t,r;const a=[Be,Je,Te,Ee,Ue],c=[];function m(u,_){return u[0]==="online"?0:u[0]==="degraded"?1:u[0]==="offline"?2:u[0]===void 0?3:4}return e=m(s),n=c[e]=a[e](s),{c(){n.c(),t=we()},m(u,_){c[e].m(u,_),D(u,t,_),r=!0},p(u,[_]){let d=e;e=m(u),e===d?c[e].p(u,_):(Q(),b(c[d],1,1,()=>{c[d]=null}),V(),n=c[e],n?n.p(u,_):(n=c[e]=a[e](u),n.c()),$(n,1),n.m(t.parentNode,t))},i(u){r||($(n),r=!0)},o(u){b(n),r=!1},d(u){c[e].d(u),u&&S(t)}}}function Me(s,e,n){let{status:t}=e,{cls:r="w-6 h-6 mx-1"}=e;return s.$$set=a=>{"status"in a&&n(0,t=a.status),"cls"in a&&n(1,r=a.cls)},[t,r]}class _e extends Y{constructor(e){super(),Z(this,e,Me,Ge,x,{status:0,cls:1})}}function je(s){let e;return{c(){e=z("No extra information available")},m(n,t){D(n,e,t)},p:W,d(n){n&&S(e)}}}function Re(s){let e;return{c(){e=z(s[2])},m(n,t){D(n,e,t)},p(n,t){t&4&&te(e,n[2])},d(n){n&&S(e)}}}function ze(s){let e;function n(a,c){return a[2]?Re:je}let t=n(s),r=t(s);return{c(){e=R("div"),r.c(),U(e,"class","mx-4")},m(a,c){D(a,e,c),r.m(e,null)},p(a,c){t===(t=n(a))&&r?r.p(a,c):(r.d(1),r=t(a),r&&(r.c(),r.m(e,null)))},d(a){a&&S(e),r.d()}}}function Fe(s){let e,n,t,r=s[0].name+"",a,c;return n=new _e({props:{status:s[1]}}),{c(){e=R("h3"),O(n.$$.fragment),t=E(),a=z(r),U(e,"slot","header"),U(e,"class","m-0 flex items-center")},m(m,u){D(m,e,u),N(n,e,null),j(e,t),j(e,a),c=!0},p(m,u){const _={};u&2&&(_.status=m[1]),n.$set(_),(!c||u&1)&&r!==(r=m[0].name+"")&&te(a,r)},i(m){c||($(n.$$.fragment,m),c=!0)},o(m){b(n.$$.fragment,m),c=!1},d(m){m&&S(e),A(n)}}}function Pe(s){let e,n;return e=new Oe({props:{$$slots:{header:[Fe],default:[ze]},$$scope:{ctx:s}}}),{c(){O(e.$$.fragment)},m(t,r){N(e,t,r),n=!0},p(t,[r]){const a={};r&39&&(a.$$scope={dirty:r,ctx:t}),e.$set(a)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){b(e.$$.fragment,t),n=!1},d(t){A(e,t)}}}function qe(s,e,n){let t,r,{service:a}=e,c=a.status;X(s,c,u=>n(1,t=u));let m=a.message;return X(s,m,u=>n(2,r=u)),s.$$set=u=>{"service"in u&&n(0,a=u.service)},[a,t,r,c,m]}class Xe extends Y{constructor(e){super(),Z(this,e,qe,Pe,x,{service:0})}}function le(s,e,n){const t=s.slice();return t[16]=e[n],t}function ie(s){let e,n;return e=new de({}),{c(){O(e.$$.fragment)},m(t,r){N(e,t,r),n=!0},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){b(e.$$.fragment,t),n=!1},d(t){A(e,t)}}}function He(s){let e;return{c(){e=z("Automatically check again every 10s")},m(n,t){D(n,e,t)},d(n){n&&S(e)}}}function ce(s){let e,n;return e=new pe({props:{selected:s[9],$$slots:{default:[Ke]},$$scope:{ctx:s}}}),{c(){O(e.$$.fragment)},m(t,r){N(e,t,r),n=!0},p(t,r){const a={};r&524288&&(a.$$scope={dirty:r,ctx:t}),e.$set(a)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){b(e.$$.fragment,t),n=!1},d(t){A(e,t)}}}function Ke(s){let e;return{c(){e=z("Enable traffic light")},m(n,t){D(n,e,t)},d(n){n&&S(e)}}}function ue(s){let e,n;return e=new Xe({props:{service:s[16]}}),{c(){O(e.$$.fragment)},m(t,r){N(e,t,r),n=!0},p:W,i(t){n||($(e.$$.fragment,t),n=!0)},o(t){b(e.$$.fragment,t),n=!1},d(t){A(e,t)}}}function Qe(s){var g;let e,n,t,r,a,c,m,u,_,d,k,h,J,B,G,P,w=s[0]&&ie();a=new _e({props:{status:s[1],cls:"w-16 h-16"}}),_=new pe({props:{selected:s[5],$$slots:{default:[He]},$$scope:{ctx:s}}});let v=((g=s[2])==null?void 0:g.success)&&ce(s),i=s[3],o=[];for(let l=0;l<i.length;l+=1)o[l]=ue(le(s,i,l));const f=l=>b(o[l],1,1,()=>{o[l]=null});return{c(){e=R("h1"),e.textContent="MapComplete status indicators",n=E(),t=R("div"),w&&w.c(),r=E(),O(a.$$.fragment),c=E(),m=R("button"),m.textContent="Check again",u=E(),O(_.$$.fragment),d=E(),v&&v.c(),k=E();for(let l=0;l<o.length;l+=1)o[l].c();h=E(),J=R("button"),J.textContent="Test error report function",U(t,"class","flex")},m(l,p){D(l,e,p),D(l,n,p),D(l,t,p),w&&w.m(t,null),j(t,r),N(a,t,null),j(t,c),j(t,m),j(t,u),N(_,t,null),D(l,d,p),v&&v.m(l,p),D(l,k,p);for(let C=0;C<o.length;C+=1)o[C]&&o[C].m(l,p);D(l,h,p),D(l,J,p),B=!0,G||(P=[M(m,"click",s[10]),M(J,"click",s[11])],G=!0)},p(l,[p]){var ne;l[0]?w?p&1&&$(w,1):(w=ie(),w.c(),$(w,1),w.m(t,r)):w&&(Q(),b(w,1,1,()=>{w=null}),V());const C={};p&2&&(C.status=l[1]),a.$set(C);const H={};if(p&524288&&(H.$$scope={dirty:p,ctx:l}),_.$set(H),(ne=l[2])!=null&&ne.success?v?(v.p(l,p),p&4&&$(v,1)):(v=ce(l),v.c(),$(v,1),v.m(k.parentNode,k)):v&&(Q(),b(v,1,1,()=>{v=null}),V()),p&8){i=l[3];let y;for(y=0;y<i.length;y+=1){const se=le(l,i,y);o[y]?(o[y].p(se,p),$(o[y],1)):(o[y]=ue(se),o[y].c(),$(o[y],1),o[y].m(h.parentNode,h))}for(Q(),y=i.length;y<o.length;y+=1)f(y);V()}},i(l){if(!B){$(w),$(a.$$.fragment,l),$(_.$$.fragment,l),$(v);for(let p=0;p<i.length;p+=1)$(o[p]);B=!0}},o(l){b(w),b(a.$$.fragment,l),b(_.$$.fragment,l),b(v),o=o.filter(Boolean);for(let p=0;p<o.length;p+=1)b(o[p]);B=!1},d(l){l&&S(e),l&&S(n),l&&S(t),w&&w.d(),A(a),A(_),l&&S(d),v&&v.d(l),l&&S(k),De(o,l),l&&S(h),l&&S(J),G=!1,me(P)}}}const fe="http://traffic_light_bicycle.local/";function K(s){return s.mapD(e=>e.success?JSON.stringify(e.success):e.error)}function Ve(s,e,n){let t,r,a,c=[],m=new F(void 0),u=Se.Chronic(1e4),_=new F(!1);function d(i,o=!1){const f=new F(void 0);function g(){var p;f.setData(void 0);const l=o?L.download(i):L.downloadJson(i);(p=l==null?void 0:l.then(C=>f.setData({success:C})))==null||p.catch(C=>f.setData({error:C}))}return g(),m.addCallback(l=>g()),u.addCallback(l=>{_.data&&g()}),f}{const i=new Ne,o=i.apiIsOnline;c.push({name:i.Backend(),status:o.mapD(f=>{switch(f){case"offline":return"offline";case"online":return"online";case"readonly":return"degraded";case"unknown":return;case"unreachable":return"offline"}}),message:o})}{const i="https://studio.mapcomplete.org",o=d(i+"/overview");c.push({name:i,status:o.mapD(f=>{if(f.error)return"offline";const g=f.success.allFiles;return g.length<10?"offline":g.length<100?"degraded":"online"}),message:o.mapD(f=>f.error?f.error:"Contains "+(f.success.allFiles.length??"no")+" files")})}c.push({name:I.GeoIpServer,status:d(I.GeoIpServer+"/status").mapD(i=>i.success.online?"online":i.error?"offline":"degraded"),message:K(d(I.GeoIpServer+"/ip"))});{const i=I.ErrorReportServer,o=d(i.replace(/\/report$/,"/status"));c.push({name:i,status:o.mapD(f=>f.error?"offline":f.success.errors_today===0?"online":"degraded"),message:K(o)})}{const i=I.linkedDataProxy.replace(/\/[^/]*$/,""),o=d(i+"/status");c.push({name:i,status:o.mapD(f=>{if(f.error)return"offline";const g=f.success;return g.cached_entries<10||g.uptime<60*60?"degraded":"online"}),message:K(o)})}{const i=I.SummaryServer,o=d(i+"/summary/status.json");c.push({name:i,status:o.mapD(f=>{if(f.error)return"offline";console.log(f);const g=f.success.meta,l=new Date(g.current_timestamp);return console.log("Last update:",l,g.current_timestamp,g),(new Date().getTime()-l.getTime())/1e3/(60*60*26)>30?"degraded":"online"}),message:o.mapD(f=>{if(f.error)return f.error;const g=f.success.meta,l=new Date(g.current_timestamp),C=(new Date().getTime()-l.getTime())/1e3/(60*60*26),H=JSON.stringify(f.success,null,"  ");return"Database is "+Math.floor(C)+` days out of sync

`+H})})}{const i=I.countryCoderEndpoint,o=d(i+"/0.0.0.json");c.push({name:i,status:o.mapD(f=>{if(f.error)return"offline";const g=f.success;return Array.isArray(g)?"online":"degraded"}),message:o.map(f=>JSON.stringify(f))})}for(const i of I.defaultOverpassUrls){const o=i.replace(/\/interpreter$/,"/status"),f=d(o,!0);c.push({name:"Overpass-server: "+i,status:f.mapD(g=>g.error?"offline":(g.success.split(`
`),"online")),message:K(f)})}c.push({name:"Mangrove reviews",status:d("https://api.mangrove.reviews",!0).mapD(i=>i.success?"online":"offline")});let k=new F("online");X(s,k,i=>n(1,r=i));let h=new F(!0);X(s,h,i=>n(0,t=i));function J(){const i=L.NoNull(c.map(o=>o.status.data));h.setData(i.length!==c.length),i.some(o=>o==="offline")?k.setData("offline"):i.some(o=>o==="degraded")?k.setData("degraded"):i.some(o=>o==="online")?k.setData("online"):k.setData(void 0)}for(const i of c)i.status.addCallbackD(()=>{J()});let B=d(fe+"/status",!0);X(s,B,i=>n(2,a=i));let G=new F(!0);async function P(i){try{const o=fe,f=await L.downloadJson(o+"status");if(console.log(f),!G.data){await L.download(o+"configure?mode=0");return}switch(i){case"offline":await L.download(o+"configure?mode=3");break;case"degraded":await L.download(o+"configure?mode=2");break;case"online":await L.download(o+"configure?mode=1");break;default:await L.download(o+"configure?mode=7");break}}catch{console.log("Could not connect to the traffic light")}}return k.addCallbackAndRunD(i=>{P(i)}),G.addCallbackAndRunD(i=>{P(k.data)}),[t,r,a,c,m,_,k,h,B,G,()=>m.ping(),()=>{fetch(I.ErrorReportServer,{method:"POST",body:JSON.stringify({message:"Test via the status page, not an actual error",version:I.vNumber})})}]}class We extends Y{constructor(e){super(),Z(this,e,Ve,Qe,x,{})}}class Ye{setup(){new We({target:document.getElementById("main")})}}new Ye().setup();
//# sourceMappingURL=status-9fc7bec1.js.map
