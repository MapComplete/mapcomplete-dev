import"./modulepreload-polyfill-3cfb730f.js";import{S as W,i as Y,s as Z,D as _e,k as x,l as se,b as N,p as re,d as D,f as G,q as F,E as ge,F as he,G as $e,r as ke,t as $,g as b,h as y,u as we,v as ae,w as be,x as q,y as fe,z as K,A as Q,N as J,O as ee,n as V,e as R,c as O,m as A,j as I,B as P,a as B,M as ve}from"./index-333c7d73.js";import{a as z,S as De,U as L}from"./UIEventSource-4d1d2b8a.js";import{L as me}from"./Loading-d3eb8a8f.js";import{X as ye}from"./XCircle-f7d7242b.js";import{t as E}from"./tw-join-70ce42f3.js";import{E as Ce,C as de}from"./Checkbox-a5de816c.js";import{A as Se}from"./AccordionSingle-bc92d3b8.js";import{O as Oe}from"./OsmConnection-0c438e74.js";import{C as U}from"./Constants-ba5f4ac4.js";import"./Loading-dbd65049.js";import"./LocalStorageSource-115f95d9.js";function Ae(s){let e,n,t,r,a;const c=s[2].default,f=_e(c,s,s[1],null);let u=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 20 20"},{fill:"currentColor"},{"aria-hidden":"true"},s[0]],_={};for(let m=0;m<u.length;m+=1)_=x(_,u[m]);return{c(){e=se("svg"),f&&f.c(),n=se("path"),N(n,"fill-rule","evenodd"),N(n,"d","M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z"),N(n,"clip-rule","evenodd"),re(e,_)},m(m,k){D(m,e,k),f&&f.m(e,null),G(e,n),t=!0,r||(a=[F(e,"click",s[3]),F(e,"mouseover",s[4]),F(e,"mouseenter",s[5]),F(e,"mouseleave",s[6]),F(e,"keydown",s[7])],r=!0)},p(m,[k]){f&&f.p&&(!t||k&2)&&ge(f,c,m,m[1],t?$e(c,m[1],k,null):he(m[1]),null),re(e,_=ke(u,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 20 20"},{fill:"currentColor"},{"aria-hidden":"true"},k&1&&m[0]]))},i(m){t||($(f,m),t=!0)},o(m){b(f,m),t=!1},d(m){m&&y(e),f&&f.d(m),r=!1,we(a)}}}function Ie(s,e,n){const t=[];let r=ae(e,t),{$$slots:a={},$$scope:c}=e;function f(h){q.call(this,s,h)}function u(h){q.call(this,s,h)}function _(h){q.call(this,s,h)}function m(h){q.call(this,s,h)}function k(h){q.call(this,s,h)}return s.$$set=h=>{e=x(x({},e),be(h)),n(0,r=ae(e,t)),"$$scope"in h&&n(1,c=h.$$scope)},[r,c,a,f,u,_,m,k]}class Le extends W{constructor(e){super(),Y(this,e,Ie,Ae,Z,{})}}function Ne(s){let e,n;return{c(){e=J("? "),n=J(s[0])},m(t,r){D(t,e,r),D(t,n,r)},p(t,r){r&1&&ee(n,t[0])},i:V,o:V,d(t){t&&y(e),t&&y(n)}}}function Ue(s){let e,n,t,r;return n=new me({}),{c(){e=R("div"),O(n.$$.fragment),N(e,"class",t=E(s[1],"rounded-full shrink-0"))},m(a,c){D(a,e,c),A(n,e,null),r=!0},p(a,c){(!r||c&2&&t!==(t=E(a[1],"rounded-full shrink-0")))&&N(e,"class",t)},i(a){r||($(n.$$.fragment,a),r=!0)},o(a){b(n.$$.fragment,a),r=!1},d(a){a&&y(e),I(n)}}}function Ee(s){let e,n;return e=new ye({props:{class:E(s[1],"rounded-full shrink-0"),style:"color: #bb2222"}}),{c(){O(e.$$.fragment)},m(t,r){A(e,t,r),n=!0},p(t,r){const a={};r&2&&(a.class=E(t[1],"rounded-full shrink-0")),e.$set(a)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){b(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function Be(s){let e,n;return e=new Ce({props:{class:E(s[1],"rounded-full  shrink-0"),style:"color: #eecc22"}}),{c(){O(e.$$.fragment)},m(t,r){A(e,t,r),n=!0},p(t,r){const a={};r&2&&(a.class=E(t[1],"rounded-full  shrink-0")),e.$set(a)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){b(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function Ge(s){let e,n;return e=new Le({props:{class:E(s[1],"rounded-full shrink-0"),style:"color: #22cc22"}}),{c(){O(e.$$.fragment)},m(t,r){A(e,t,r),n=!0},p(t,r){const a={};r&2&&(a.class=E(t[1],"rounded-full shrink-0")),e.$set(a)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){b(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function Je(s){let e,n,t,r;const a=[Ge,Be,Ee,Ue,Ne],c=[];function f(u,_){return u[0]==="online"?0:u[0]==="degraded"?1:u[0]==="offline"?2:u[0]===void 0?3:4}return e=f(s),n=c[e]=a[e](s),{c(){n.c(),t=fe()},m(u,_){c[e].m(u,_),D(u,t,_),r=!0},p(u,[_]){let m=e;e=f(u),e===m?c[e].p(u,_):(K(),b(c[m],1,1,()=>{c[m]=null}),Q(),n=c[e],n?n.p(u,_):(n=c[e]=a[e](u),n.c()),$(n,1),n.m(t.parentNode,t))},i(u){r||($(n),r=!0)},o(u){b(n),r=!1},d(u){c[e].d(u),u&&y(t)}}}function Me(s,e,n){let{status:t}=e,{cls:r="w-6 h-6 mx-1"}=e;return s.$$set=a=>{"status"in a&&n(0,t=a.status),"cls"in a&&n(1,r=a.cls)},[t,r]}class pe extends W{constructor(e){super(),Y(this,e,Me,Je,Z,{status:0,cls:1})}}function Te(s){let e;return{c(){e=J("No extra information available")},m(n,t){D(n,e,t)},p:V,d(n){n&&y(e)}}}function je(s){let e;return{c(){e=J(s[2])},m(n,t){D(n,e,t)},p(n,t){t&4&&ee(e,n[2])},d(n){n&&y(e)}}}function ze(s){let e;function n(a,c){return a[2]?je:Te}let t=n(s),r=t(s);return{c(){e=R("div"),r.c(),N(e,"class","mx-4")},m(a,c){D(a,e,c),r.m(e,null)},p(a,c){t===(t=n(a))&&r?r.p(a,c):(r.d(1),r=t(a),r&&(r.c(),r.m(e,null)))},d(a){a&&y(e),r.d()}}}function Fe(s){let e,n,t,r=s[0].name+"",a,c;return n=new pe({props:{status:s[1]}}),{c(){e=R("h3"),O(n.$$.fragment),t=B(),a=J(r),N(e,"slot","header"),N(e,"class","flex items-center m-0")},m(f,u){D(f,e,u),A(n,e,null),G(e,t),G(e,a),c=!0},p(f,u){const _={};u&2&&(_.status=f[1]),n.$set(_),(!c||u&1)&&r!==(r=f[0].name+"")&&ee(a,r)},i(f){c||($(n.$$.fragment,f),c=!0)},o(f){b(n.$$.fragment,f),c=!1},d(f){f&&y(e),I(n)}}}function Re(s){let e,n;return e=new Se({props:{$$slots:{header:[Fe],default:[ze]},$$scope:{ctx:s}}}),{c(){O(e.$$.fragment)},m(t,r){A(e,t,r),n=!0},p(t,[r]){const a={};r&39&&(a.$$scope={dirty:r,ctx:t}),e.$set(a)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){b(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function qe(s,e,n){let t,r,{service:a}=e,c=a.status;P(s,c,u=>n(1,t=u));let f=a.message;return P(s,f,u=>n(2,r=u)),s.$$set=u=>{"service"in u&&n(0,a=u.service)},[a,t,r,c,f]}class Pe extends W{constructor(e){super(),Y(this,e,qe,Re,Z,{service:0})}}function le(s,e,n){const t=s.slice();return t[15]=e[n],t}function oe(s){let e,n;return e=new me({}),{c(){O(e.$$.fragment)},m(t,r){A(e,t,r),n=!0},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){b(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function Xe(s){let e;return{c(){e=J("Automatically check again every 10s")},m(n,t){D(n,e,t)},d(n){n&&y(e)}}}function ie(s){let e,n;return e=new de({props:{selected:s[9],$$slots:{default:[He]},$$scope:{ctx:s}}}),{c(){O(e.$$.fragment)},m(t,r){A(e,t,r),n=!0},p(t,r){const a={};r&262144&&(a.$$scope={dirty:r,ctx:t}),e.$set(a)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){b(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function He(s){let e;return{c(){e=J("Enable traffic light")},m(n,t){D(n,e,t)},d(n){n&&y(e)}}}function ce(s){let e,n;return e=new Pe({props:{service:s[15]}}),{c(){O(e.$$.fragment)},m(t,r){A(e,t,r),n=!0},p:V,i(t){n||($(e.$$.fragment,t),n=!0)},o(t){b(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function Ke(s){var g;let e,n,t,r,a,c,f,u,_,m,k,h,M,T,j,w=s[0]&&oe();a=new pe({props:{status:s[1],cls:"w-16 h-16"}}),_=new de({props:{selected:s[5],$$slots:{default:[Xe]},$$scope:{ctx:s}}});let v=((g=s[2])==null?void 0:g.success)&&ie(s),i=s[3],l=[];for(let o=0;o<i.length;o+=1)l[o]=ce(le(s,i,o));const d=o=>b(l[o],1,1,()=>{l[o]=null});return{c(){e=R("h1"),e.textContent="MapComplete status indicators",n=B(),t=R("div"),w&&w.c(),r=B(),O(a.$$.fragment),c=B(),f=R("button"),f.textContent="Check again",u=B(),O(_.$$.fragment),m=B(),v&&v.c(),k=B();for(let o=0;o<l.length;o+=1)l[o].c();h=fe(),N(t,"class","flex")},m(o,p){D(o,e,p),D(o,n,p),D(o,t,p),w&&w.m(t,null),G(t,r),A(a,t,null),G(t,c),G(t,f),G(t,u),A(_,t,null),D(o,m,p),v&&v.m(o,p),D(o,k,p);for(let S=0;S<l.length;S+=1)l[S]&&l[S].m(o,p);D(o,h,p),M=!0,T||(j=F(f,"click",s[10]),T=!0)},p(o,[p]){var te;o[0]?w?p&1&&$(w,1):(w=oe(),w.c(),$(w,1),w.m(t,r)):w&&(K(),b(w,1,1,()=>{w=null}),Q());const S={};p&2&&(S.status=o[1]),a.$set(S);const X={};if(p&262144&&(X.$$scope={dirty:p,ctx:o}),_.$set(X),(te=o[2])!=null&&te.success?v?(v.p(o,p),p&4&&$(v,1)):(v=ie(o),v.c(),$(v,1),v.m(k.parentNode,k)):v&&(K(),b(v,1,1,()=>{v=null}),Q()),p&8){i=o[3];let C;for(C=0;C<i.length;C+=1){const ne=le(o,i,C);l[C]?(l[C].p(ne,p),$(l[C],1)):(l[C]=ce(ne),l[C].c(),$(l[C],1),l[C].m(h.parentNode,h))}for(K(),C=i.length;C<l.length;C+=1)d(C);Q()}},i(o){if(!M){$(w),$(a.$$.fragment,o),$(_.$$.fragment,o),$(v);for(let p=0;p<i.length;p+=1)$(l[p]);M=!0}},o(o){b(w),b(a.$$.fragment,o),b(_.$$.fragment,o),b(v),l=l.filter(Boolean);for(let p=0;p<l.length;p+=1)b(l[p]);M=!1},d(o){o&&y(e),o&&y(n),o&&y(t),w&&w.d(),I(a),I(_),o&&y(m),v&&v.d(o),o&&y(k),ve(l,o),o&&y(h),T=!1,j()}}}const ue="http://traffic_light_bicycle.local/";function H(s){return s.mapD(e=>e.success?JSON.stringify(e.success):e.error)}function Qe(s,e,n){let t,r,a,c=[],f=new z(void 0),u=De.Chronic(1e4),_=new z(!1);function m(i,l=!1){const d=new z(void 0);function g(){var p;const o=l?L.download(i):L.downloadJson(i);(p=o==null?void 0:o.then(S=>d.setData({success:S})))==null||p.catch(S=>d.setData({error:S}))}return g(),f.addCallback(o=>g()),u.addCallback(o=>{_.data&&g()}),d}{const i=new Oe,l=i.apiIsOnline;c.push({name:i.Backend(),status:l.mapD(d=>{switch(d){case"offline":return"offline";case"online":return"online";case"readonly":return"degraded";case"unknown":return;case"unreachable":return"offline"}}),message:l})}{const i="https://studio.mapcomplete.org",l=m(i+"/overview");c.push({name:i,status:l.mapD(d=>{if(d.error)return"offline";const g=d.success.allFiles;return g.length<10?"offline":g.length<100?"degraded":"online"}),message:l.mapD(d=>d.error?d.error:"Contains "+(d.success.allFiles.length??"no")+" files")})}c.push({name:U.GeoIpServer,status:m(U.GeoIpServer+"/status").mapD(i=>i.success.online?"online":i.error?"offline":"degraded"),message:H(m(U.GeoIpServer+"/ip"))});{const i=U.ErrorReportServer,l=m(i.replace(/\/report$/,"/status"));c.push({name:i,status:l.mapD(d=>d.error?"offline":d.success.errors_today===0?"online":"degraded"),message:H(l)})}{const i=U.linkedDataProxy.replace(/\/[^/]*$/,""),l=m(i+"/status");c.push({name:i,status:l.mapD(d=>{if(d.error)return"offline";const g=d.success;return g.cached_entries<10||g.uptime<60*60?"degraded":"online"}),message:H(l)})}{const i=U.SummaryServer,l=m(i+"/summary/status.json");c.push({name:i,status:l.mapD(d=>{if(d.error)return"offline";console.log(d);const g=d.success.meta,o=new Date(g.current_timestamp);return console.log("Last update:",o,g.current_timestamp,g),(new Date().getTime()-o.getTime())/1e3/(60*60*26)>7?"degraded":"online"}),message:l.mapD(d=>{if(d.error)return d.error;const g=d.success.meta,o=new Date(g.current_timestamp),S=(new Date().getTime()-o.getTime())/1e3/(60*60*26),X=JSON.stringify(d.success,null,"  ");return"Database is "+Math.floor(S)+` days out of sync

`+X})})}{const i=U.countryCoderEndpoint,l=m(i+"/0.0.0.json");c.push({name:i,status:l.mapD(d=>{if(d.error)return"offline";const g=d.success;return Array.isArray(g)?"online":"degraded"}),message:l.map(d=>JSON.stringify(d))})}for(const i of U.defaultOverpassUrls){const l=i.replace(/\/interpreter$/,"/status"),d=m(l,!0);c.push({name:"Overpass-server: "+i,status:d.mapD(g=>g.error?"offline":(g.success.split(`
`),"online")),message:H(d)})}c.push({name:"Mangrove reviews",status:m("https://api.mangrove.reviews",!0).mapD(i=>i.success?"online":"offline")});let k=new z("online");P(s,k,i=>n(1,r=i));let h=new z(!0);P(s,h,i=>n(0,t=i));function M(){const i=L.NoNull(c.map(l=>l.status.data));h.setData(i.length!==c.length),i.some(l=>l==="offline")?k.setData("offline"):i.some(l=>l==="degraded")?k.setData("degraded"):i.some(l=>l==="online")?k.setData("online"):k.setData(void 0)}for(const i of c)i.status.addCallbackD(()=>{M()});let T=m(ue+"/status",!0);P(s,T,i=>n(2,a=i));let j=new z(!0);async function w(i){try{const l=ue,d=await L.downloadJson(l+"status");if(console.log(d),!j.data){await L.download(l+"configure?mode=0");return}switch(i){case"offline":await L.download(l+"configure?mode=3");break;case"degraded":await L.download(l+"configure?mode=2");break;case"online":await L.download(l+"configure?mode=1");break;default:await L.download(l+"configure?mode=7");break}}catch{console.log("Could not connect to the traffic light")}}return k.addCallbackAndRunD(i=>{w(i)}),j.addCallbackAndRunD(i=>{w(k.data)}),[t,r,a,c,f,_,k,h,T,j,()=>f.ping()]}class Ve extends W{constructor(e){super(),Y(this,e,Qe,Ke,Z,{})}}class We{setup(){new Ve({target:document.getElementById("main")})}}new We().setup();
//# sourceMappingURL=status-6aa9e88c.js.map
