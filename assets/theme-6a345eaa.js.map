{"version":3,"file":"theme-6a345eaa.js","sources":["../../node_modules/lz-string/libs/lz-string.js","../../src/Models/ThemeConfig/Conversion/LegacyJsonConvert.ts","../../src/Logic/DetermineLayout.ts","../../src/index.ts"],"sourcesContent":["// Copyright (c) 2013 Pieroxy <pieroxy@pieroxy.net>\n// This work is free. You can redistribute it and/or modify it\n// under the terms of the WTFPL, Version 2\n// For more information see LICENSE.txt or http://www.wtfpl.net/\n//\n// For more information, the home page:\n// http://pieroxy.net/blog/pages/lz-string/testing.html\n//\n// LZ-based compression algorithm, version 1.4.4\nvar LZString = (function() {\n\n// private property\nvar f = String.fromCharCode;\nvar keyStrBase64 = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\nvar keyStrUriSafe = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$\";\nvar baseReverseDic = {};\n\nfunction getBaseValue(alphabet, character) {\n  if (!baseReverseDic[alphabet]) {\n    baseReverseDic[alphabet] = {};\n    for (var i=0 ; i<alphabet.length ; i++) {\n      baseReverseDic[alphabet][alphabet.charAt(i)] = i;\n    }\n  }\n  return baseReverseDic[alphabet][character];\n}\n\nvar LZString = {\n  compressToBase64 : function (input) {\n    if (input == null) return \"\";\n    var res = LZString._compress(input, 6, function(a){return keyStrBase64.charAt(a);});\n    switch (res.length % 4) { // To produce valid Base64\n    default: // When could this happen ?\n    case 0 : return res;\n    case 1 : return res+\"===\";\n    case 2 : return res+\"==\";\n    case 3 : return res+\"=\";\n    }\n  },\n\n  decompressFromBase64 : function (input) {\n    if (input == null) return \"\";\n    if (input == \"\") return null;\n    return LZString._decompress(input.length, 32, function(index) { return getBaseValue(keyStrBase64, input.charAt(index)); });\n  },\n\n  compressToUTF16 : function (input) {\n    if (input == null) return \"\";\n    return LZString._compress(input, 15, function(a){return f(a+32);}) + \" \";\n  },\n\n  decompressFromUTF16: function (compressed) {\n    if (compressed == null) return \"\";\n    if (compressed == \"\") return null;\n    return LZString._decompress(compressed.length, 16384, function(index) { return compressed.charCodeAt(index) - 32; });\n  },\n\n  //compress into uint8array (UCS-2 big endian format)\n  compressToUint8Array: function (uncompressed) {\n    var compressed = LZString.compress(uncompressed);\n    var buf=new Uint8Array(compressed.length*2); // 2 bytes per character\n\n    for (var i=0, TotalLen=compressed.length; i<TotalLen; i++) {\n      var current_value = compressed.charCodeAt(i);\n      buf[i*2] = current_value >>> 8;\n      buf[i*2+1] = current_value % 256;\n    }\n    return buf;\n  },\n\n  //decompress from uint8array (UCS-2 big endian format)\n  decompressFromUint8Array:function (compressed) {\n    if (compressed===null || compressed===undefined){\n        return LZString.decompress(compressed);\n    } else {\n        var buf=new Array(compressed.length/2); // 2 bytes per character\n        for (var i=0, TotalLen=buf.length; i<TotalLen; i++) {\n          buf[i]=compressed[i*2]*256+compressed[i*2+1];\n        }\n\n        var result = [];\n        buf.forEach(function (c) {\n          result.push(f(c));\n        });\n        return LZString.decompress(result.join(''));\n\n    }\n\n  },\n\n\n  //compress into a string that is already URI encoded\n  compressToEncodedURIComponent: function (input) {\n    if (input == null) return \"\";\n    return LZString._compress(input, 6, function(a){return keyStrUriSafe.charAt(a);});\n  },\n\n  //decompress from an output of compressToEncodedURIComponent\n  decompressFromEncodedURIComponent:function (input) {\n    if (input == null) return \"\";\n    if (input == \"\") return null;\n    input = input.replace(/ /g, \"+\");\n    return LZString._decompress(input.length, 32, function(index) { return getBaseValue(keyStrUriSafe, input.charAt(index)); });\n  },\n\n  compress: function (uncompressed) {\n    return LZString._compress(uncompressed, 16, function(a){return f(a);});\n  },\n  _compress: function (uncompressed, bitsPerChar, getCharFromInt) {\n    if (uncompressed == null) return \"\";\n    var i, value,\n        context_dictionary= {},\n        context_dictionaryToCreate= {},\n        context_c=\"\",\n        context_wc=\"\",\n        context_w=\"\",\n        context_enlargeIn= 2, // Compensate for the first entry which should not count\n        context_dictSize= 3,\n        context_numBits= 2,\n        context_data=[],\n        context_data_val=0,\n        context_data_position=0,\n        ii;\n\n    for (ii = 0; ii < uncompressed.length; ii += 1) {\n      context_c = uncompressed.charAt(ii);\n      if (!Object.prototype.hasOwnProperty.call(context_dictionary,context_c)) {\n        context_dictionary[context_c] = context_dictSize++;\n        context_dictionaryToCreate[context_c] = true;\n      }\n\n      context_wc = context_w + context_c;\n      if (Object.prototype.hasOwnProperty.call(context_dictionary,context_wc)) {\n        context_w = context_wc;\n      } else {\n        if (Object.prototype.hasOwnProperty.call(context_dictionaryToCreate,context_w)) {\n          if (context_w.charCodeAt(0)<256) {\n            for (i=0 ; i<context_numBits ; i++) {\n              context_data_val = (context_data_val << 1);\n              if (context_data_position == bitsPerChar-1) {\n                context_data_position = 0;\n                context_data.push(getCharFromInt(context_data_val));\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n            }\n            value = context_w.charCodeAt(0);\n            for (i=0 ; i<8 ; i++) {\n              context_data_val = (context_data_val << 1) | (value&1);\n              if (context_data_position == bitsPerChar-1) {\n                context_data_position = 0;\n                context_data.push(getCharFromInt(context_data_val));\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n              value = value >> 1;\n            }\n          } else {\n            value = 1;\n            for (i=0 ; i<context_numBits ; i++) {\n              context_data_val = (context_data_val << 1) | value;\n              if (context_data_position ==bitsPerChar-1) {\n                context_data_position = 0;\n                context_data.push(getCharFromInt(context_data_val));\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n              value = 0;\n            }\n            value = context_w.charCodeAt(0);\n            for (i=0 ; i<16 ; i++) {\n              context_data_val = (context_data_val << 1) | (value&1);\n              if (context_data_position == bitsPerChar-1) {\n                context_data_position = 0;\n                context_data.push(getCharFromInt(context_data_val));\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n              value = value >> 1;\n            }\n          }\n          context_enlargeIn--;\n          if (context_enlargeIn == 0) {\n            context_enlargeIn = Math.pow(2, context_numBits);\n            context_numBits++;\n          }\n          delete context_dictionaryToCreate[context_w];\n        } else {\n          value = context_dictionary[context_w];\n          for (i=0 ; i<context_numBits ; i++) {\n            context_data_val = (context_data_val << 1) | (value&1);\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n            value = value >> 1;\n          }\n\n\n        }\n        context_enlargeIn--;\n        if (context_enlargeIn == 0) {\n          context_enlargeIn = Math.pow(2, context_numBits);\n          context_numBits++;\n        }\n        // Add wc to the dictionary.\n        context_dictionary[context_wc] = context_dictSize++;\n        context_w = String(context_c);\n      }\n    }\n\n    // Output the code for w.\n    if (context_w !== \"\") {\n      if (Object.prototype.hasOwnProperty.call(context_dictionaryToCreate,context_w)) {\n        if (context_w.charCodeAt(0)<256) {\n          for (i=0 ; i<context_numBits ; i++) {\n            context_data_val = (context_data_val << 1);\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n          }\n          value = context_w.charCodeAt(0);\n          for (i=0 ; i<8 ; i++) {\n            context_data_val = (context_data_val << 1) | (value&1);\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n            value = value >> 1;\n          }\n        } else {\n          value = 1;\n          for (i=0 ; i<context_numBits ; i++) {\n            context_data_val = (context_data_val << 1) | value;\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n            value = 0;\n          }\n          value = context_w.charCodeAt(0);\n          for (i=0 ; i<16 ; i++) {\n            context_data_val = (context_data_val << 1) | (value&1);\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n            value = value >> 1;\n          }\n        }\n        context_enlargeIn--;\n        if (context_enlargeIn == 0) {\n          context_enlargeIn = Math.pow(2, context_numBits);\n          context_numBits++;\n        }\n        delete context_dictionaryToCreate[context_w];\n      } else {\n        value = context_dictionary[context_w];\n        for (i=0 ; i<context_numBits ; i++) {\n          context_data_val = (context_data_val << 1) | (value&1);\n          if (context_data_position == bitsPerChar-1) {\n            context_data_position = 0;\n            context_data.push(getCharFromInt(context_data_val));\n            context_data_val = 0;\n          } else {\n            context_data_position++;\n          }\n          value = value >> 1;\n        }\n\n\n      }\n      context_enlargeIn--;\n      if (context_enlargeIn == 0) {\n        context_enlargeIn = Math.pow(2, context_numBits);\n        context_numBits++;\n      }\n    }\n\n    // Mark the end of the stream\n    value = 2;\n    for (i=0 ; i<context_numBits ; i++) {\n      context_data_val = (context_data_val << 1) | (value&1);\n      if (context_data_position == bitsPerChar-1) {\n        context_data_position = 0;\n        context_data.push(getCharFromInt(context_data_val));\n        context_data_val = 0;\n      } else {\n        context_data_position++;\n      }\n      value = value >> 1;\n    }\n\n    // Flush the last char\n    while (true) {\n      context_data_val = (context_data_val << 1);\n      if (context_data_position == bitsPerChar-1) {\n        context_data.push(getCharFromInt(context_data_val));\n        break;\n      }\n      else context_data_position++;\n    }\n    return context_data.join('');\n  },\n\n  decompress: function (compressed) {\n    if (compressed == null) return \"\";\n    if (compressed == \"\") return null;\n    return LZString._decompress(compressed.length, 32768, function(index) { return compressed.charCodeAt(index); });\n  },\n\n  _decompress: function (length, resetValue, getNextValue) {\n    var dictionary = [],\n        next,\n        enlargeIn = 4,\n        dictSize = 4,\n        numBits = 3,\n        entry = \"\",\n        result = [],\n        i,\n        w,\n        bits, resb, maxpower, power,\n        c,\n        data = {val:getNextValue(0), position:resetValue, index:1};\n\n    for (i = 0; i < 3; i += 1) {\n      dictionary[i] = i;\n    }\n\n    bits = 0;\n    maxpower = Math.pow(2,2);\n    power=1;\n    while (power!=maxpower) {\n      resb = data.val & data.position;\n      data.position >>= 1;\n      if (data.position == 0) {\n        data.position = resetValue;\n        data.val = getNextValue(data.index++);\n      }\n      bits |= (resb>0 ? 1 : 0) * power;\n      power <<= 1;\n    }\n\n    switch (next = bits) {\n      case 0:\n          bits = 0;\n          maxpower = Math.pow(2,8);\n          power=1;\n          while (power!=maxpower) {\n            resb = data.val & data.position;\n            data.position >>= 1;\n            if (data.position == 0) {\n              data.position = resetValue;\n              data.val = getNextValue(data.index++);\n            }\n            bits |= (resb>0 ? 1 : 0) * power;\n            power <<= 1;\n          }\n        c = f(bits);\n        break;\n      case 1:\n          bits = 0;\n          maxpower = Math.pow(2,16);\n          power=1;\n          while (power!=maxpower) {\n            resb = data.val & data.position;\n            data.position >>= 1;\n            if (data.position == 0) {\n              data.position = resetValue;\n              data.val = getNextValue(data.index++);\n            }\n            bits |= (resb>0 ? 1 : 0) * power;\n            power <<= 1;\n          }\n        c = f(bits);\n        break;\n      case 2:\n        return \"\";\n    }\n    dictionary[3] = c;\n    w = c;\n    result.push(c);\n    while (true) {\n      if (data.index > length) {\n        return \"\";\n      }\n\n      bits = 0;\n      maxpower = Math.pow(2,numBits);\n      power=1;\n      while (power!=maxpower) {\n        resb = data.val & data.position;\n        data.position >>= 1;\n        if (data.position == 0) {\n          data.position = resetValue;\n          data.val = getNextValue(data.index++);\n        }\n        bits |= (resb>0 ? 1 : 0) * power;\n        power <<= 1;\n      }\n\n      switch (c = bits) {\n        case 0:\n          bits = 0;\n          maxpower = Math.pow(2,8);\n          power=1;\n          while (power!=maxpower) {\n            resb = data.val & data.position;\n            data.position >>= 1;\n            if (data.position == 0) {\n              data.position = resetValue;\n              data.val = getNextValue(data.index++);\n            }\n            bits |= (resb>0 ? 1 : 0) * power;\n            power <<= 1;\n          }\n\n          dictionary[dictSize++] = f(bits);\n          c = dictSize-1;\n          enlargeIn--;\n          break;\n        case 1:\n          bits = 0;\n          maxpower = Math.pow(2,16);\n          power=1;\n          while (power!=maxpower) {\n            resb = data.val & data.position;\n            data.position >>= 1;\n            if (data.position == 0) {\n              data.position = resetValue;\n              data.val = getNextValue(data.index++);\n            }\n            bits |= (resb>0 ? 1 : 0) * power;\n            power <<= 1;\n          }\n          dictionary[dictSize++] = f(bits);\n          c = dictSize-1;\n          enlargeIn--;\n          break;\n        case 2:\n          return result.join('');\n      }\n\n      if (enlargeIn == 0) {\n        enlargeIn = Math.pow(2, numBits);\n        numBits++;\n      }\n\n      if (dictionary[c]) {\n        entry = dictionary[c];\n      } else {\n        if (c === dictSize) {\n          entry = w + w.charAt(0);\n        } else {\n          return null;\n        }\n      }\n      result.push(entry);\n\n      // Add w+entry[0] to the dictionary.\n      dictionary[dictSize++] = w + entry.charAt(0);\n      enlargeIn--;\n\n      w = entry;\n\n      if (enlargeIn == 0) {\n        enlargeIn = Math.pow(2, numBits);\n        numBits++;\n      }\n\n    }\n  }\n};\n  return LZString;\n})();\n\nif (typeof define === 'function' && define.amd) {\n  define(function () { return LZString; });\n} else if( typeof module !== 'undefined' && module != null ) {\n  module.exports = LZString\n}\n","import { LayoutConfigJson } from \"../Json/LayoutConfigJson\"\nimport { Utils } from \"../../../Utils\"\nimport LineRenderingConfigJson from \"../Json/LineRenderingConfigJson\"\nimport { LayerConfigJson } from \"../Json/LayerConfigJson\"\nimport { DesugaringStep, Each, Fuse, On } from \"./Conversion\"\nimport PointRenderingConfigJson from \"../Json/PointRenderingConfigJson\"\nimport { ConversionContext } from \"./ConversionContext\"\n\nexport class UpdateLegacyLayer extends DesugaringStep<\n    LayerConfigJson | string | { builtin; override }\n> {\n    constructor() {\n        super(\n            \"Updates various attributes from the old data format to the new to provide backwards compatibility with the formats\",\n            [\"overpassTags\", \"source.osmtags\", \"tagRenderings[*].id\", \"mapRendering\"],\n            \"UpdateLegacyLayer\"\n        )\n    }\n\n    convert(json: LayerConfigJson, context: ConversionContext): LayerConfigJson {\n        if (typeof json === \"string\" || json[\"builtin\"] !== undefined) {\n            // Reuse of an already existing layer; return as-is\n            return json\n        }\n        context = context.enter(json.id)\n        let config = { ...json }\n\n        if (config[\"overpassTags\"]) {\n            config.source = config.source ?? {\n                osmTags: config[\"overpassTags\"],\n            }\n            config.source[\"osmTags\"] = config[\"overpassTags\"]\n            delete config[\"overpassTags\"]\n        }\n\n        for (const preset of config.presets ?? []) {\n            const preciseInput = preset[\"preciseInput\"]\n            if (typeof preciseInput === \"boolean\") {\n                delete preset[\"preciseInput\"]\n            } else if (preciseInput !== undefined) {\n                delete preciseInput[\"preferredBackground\"]\n                preset.snapToLayer = preciseInput.snapToLayer\n                delete preciseInput.snapToLayer\n                if (preciseInput.maxSnapDistance) {\n                    preset.maxSnapDistance = preciseInput.maxSnapDistance\n                    delete preciseInput.maxSnapDistance\n                }\n                if (Object.keys(preciseInput).length == 0) {\n                    delete preset[\"preciseInput\"]\n                }\n            }\n\n            if (typeof preset.snapToLayer === \"string\") {\n                preset.snapToLayer = [preset.snapToLayer]\n            }\n        }\n\n        if (config.tagRenderings !== undefined) {\n            let i = 0\n            for (const tagRendering of config.tagRenderings) {\n                if (!tagRendering) {\n                    continue\n                }\n                i++\n                if (\n                    typeof tagRendering === \"string\" ||\n                    tagRendering[\"builtin\"] !== undefined ||\n                    tagRendering[\"rewrite\"] !== undefined\n                ) {\n                    continue\n                }\n                if (tagRendering[\"id\"] === undefined) {\n                    if (tagRendering[\"#\"] !== undefined) {\n                        tagRendering[\"id\"] = tagRendering[\"#\"]\n                        delete tagRendering[\"#\"]\n                    } else if (tagRendering[\"freeform\"]?.key !== undefined) {\n                        tagRendering[\"id\"] = config.id + \"-\" + tagRendering[\"freeform\"][\"key\"]\n                    } else {\n                        tagRendering[\"id\"] = \"tr-\" + i\n                    }\n                }\n            }\n        }\n\n        if (\n            config[\"mapRendering\"] === undefined &&\n            config.pointRendering === undefined &&\n            config.lineRendering === undefined\n        ) {\n            config[\"mapRendering\"] = []\n            // This is a legacy format, lets create a pointRendering\n            let location: (\"point\" | \"centroid\")[] = [\"point\"]\n            let wayHandling: number = config[\"wayHandling\"] ?? 0\n            if (wayHandling !== 0) {\n                location = [\"point\", \"centroid\"]\n            }\n            if (config[\"icon\"] ?? config[\"label\"] !== undefined) {\n                const pointConfig = {\n                    icon: config[\"icon\"],\n                    iconBadges: config[\"iconOverlays\"],\n                    label: config[\"label\"],\n                    iconSize: config[\"iconSize\"],\n                    location,\n                    rotation: config[\"rotation\"],\n                }\n                config[\"mapRendering\"].push(pointConfig)\n            }\n\n            if (wayHandling !== 1) {\n                const lineRenderConfig = <LineRenderingConfigJson>{\n                    color: config[\"color\"],\n                    width: config[\"width\"],\n                    dashArray: config[\"dashArray\"],\n                }\n                if (Object.keys(lineRenderConfig).length > 0) {\n                    config[\"mapRendering\"].push(lineRenderConfig)\n                }\n            }\n            if (config[\"mapRendering\"].length === 0) {\n                throw (\n                    \"Could not convert the legacy theme into a new theme: no renderings defined for layer \" +\n                    config.id\n                )\n            }\n        }\n\n        delete config[\"color\"]\n        delete config[\"width\"]\n        delete config[\"dashArray\"]\n\n        delete config[\"icon\"]\n        delete config[\"iconOverlays\"]\n        delete config[\"label\"]\n        delete config[\"iconSize\"]\n        delete config[\"rotation\"]\n        delete config[\"wayHandling\"]\n        delete config[\"hideUnderlayingFeaturesMinPercentage\"]\n\n        for (const mapRenderingElement of config[\"mapRendering\"] ?? []) {\n            if (mapRenderingElement[\"iconOverlays\"] !== undefined) {\n                mapRenderingElement[\"iconBadges\"] = mapRenderingElement[\"iconOverlays\"]\n            }\n            for (const overlay of mapRenderingElement[\"iconBadges\"] ?? []) {\n                if (overlay[\"badge\"] !== true) {\n                    context.enters(\"iconBadges\", \"badge\").warn(\"Non-overlay element\")\n                }\n                delete overlay[\"badge\"]\n            }\n        }\n\n        if (config[\"mapRendering\"]) {\n            const pointRenderings: PointRenderingConfigJson[] = []\n            const lineRenderings: LineRenderingConfigJson[] = []\n            for (const mapRenderingElement of config[\"mapRendering\"]) {\n                if (mapRenderingElement[\"location\"]) {\n                    // This is a pointRendering\n                    pointRenderings.push(<any>mapRenderingElement)\n                } else {\n                    lineRenderings.push(<any>mapRenderingElement)\n                }\n            }\n            config[\"pointRendering\"] = pointRenderings\n            config[\"lineRendering\"] = lineRenderings\n            delete config[\"mapRendering\"]\n        }\n\n        for (const rendering of config.pointRendering ?? []) {\n            const pr = rendering\n            if (pr[\"icon\"]) {\n                try {\n                    let iconConfig = pr[\"icon\"]\n                    if (\n                        Object.keys(iconConfig).length === 1 &&\n                        iconConfig[\"render\"] !== undefined\n                    ) {\n                        iconConfig = iconConfig.render\n                    }\n                    const icon = Utils.NoEmpty(iconConfig.split(\";\"))\n                    pr.marker = icon.map((i) => {\n                        if (i.startsWith(\"http\")) {\n                            return { icon: i }\n                        }\n                        const [iconPath, color] = i.split(\":\")\n                        return { icon: iconPath, color }\n                    })\n                    delete pr[\"icon\"]\n                } catch (e) {\n                    console.error(\"Could not handle icon in\", json.id)\n                    pr.marker = [{ icon: pr[\"icon\"] }]\n                    delete pr[\"icon\"]\n                }\n            }\n\n            let iconSize = pr.iconSize\n            if (!iconSize) {\n                continue\n            }\n\n            if (Object.keys(pr.iconSize).length === 1 && pr.iconSize[\"render\"] !== undefined) {\n                iconSize = pr.iconSize[\"render\"]\n            }\n\n            if (typeof iconSize === \"string\")\n                if ([\"bottom\", \"center\", \"top\"].some((a) => (<string>iconSize).endsWith(a))) {\n                    const parts = iconSize.split(\",\").map((parts) => parts.toLowerCase().trim())\n                    pr.anchor = parts.pop()\n                    pr.iconSize = parts.join(\",\")\n                }\n        }\n\n        if (config.pointRendering)\n            for (const rendering of config.pointRendering) {\n                for (const key in rendering) {\n                    if (!rendering[key]) {\n                        continue\n                    }\n                    if (\n                        typeof rendering[key][\"render\"] === \"string\" &&\n                        Object.keys(rendering[key]).length === 1\n                    ) {\n                        rendering[key] = rendering[key][\"render\"]\n                    }\n                }\n            }\n        if (config.lineRendering)\n            for (const rendering of config.lineRendering) {\n                for (const key in rendering) {\n                    if (!rendering[key]) {\n                        continue\n                    }\n                    if (\n                        typeof rendering[key][\"render\"] === \"string\" &&\n                        Object.keys(rendering[key]).length === 1\n                    ) {\n                        rendering[key] = rendering[key][\"render\"]\n                    }\n                }\n            }\n\n        return config\n    }\n}\n\nclass UpdateLegacyTheme extends DesugaringStep<LayoutConfigJson> {\n    constructor() {\n        super(\"Small fixes in the theme config\", [\"roamingRenderings\"], \"UpdateLegacyTheme\")\n    }\n\n    convert(json: LayoutConfigJson, context: ConversionContext): LayoutConfigJson {\n        const oldThemeConfig = { ...json }\n\n        if (oldThemeConfig.socialImage === \"\") {\n            delete oldThemeConfig.socialImage\n        }\n\n        if (typeof oldThemeConfig.credits === \"string\") {\n            oldThemeConfig.credits = [oldThemeConfig.credits]\n        }\n\n        if (oldThemeConfig[\"roamingRenderings\"] !== undefined) {\n            if (oldThemeConfig[\"roamingRenderings\"].length == 0) {\n                delete oldThemeConfig[\"roamingRenderings\"]\n            } else {\n                context.err(\"The theme contains roamingRenderings. These are not supported anymore\")\n                return null\n            }\n        }\n\n        oldThemeConfig.layers = Utils.NoNull(oldThemeConfig.layers)\n        delete oldThemeConfig[\"language\"]\n        delete oldThemeConfig[\"version\"]\n        delete oldThemeConfig[\"clustering\"]\n\n        if (oldThemeConfig.startLat === 0) {\n            delete oldThemeConfig.startLat\n        }\n        if (oldThemeConfig.startLon === 0) {\n            delete oldThemeConfig.startLon\n        }\n        if (oldThemeConfig.startZoom <= 2) {\n            delete oldThemeConfig.startZoom\n        }\n        if (oldThemeConfig[\"maintainer\"] !== undefined) {\n            if (oldThemeConfig.credits === undefined) {\n                oldThemeConfig[\"credits\"] = oldThemeConfig[\"maintainer\"]\n                delete oldThemeConfig[\"maintainer\"]\n            } else if (oldThemeConfig[\"maintainer\"].toLowerCase().trim() === \"mapcomplete\") {\n                delete oldThemeConfig[\"maintainer\"]\n            } else if (oldThemeConfig[\"maintainer\"].toLowerCase().trim() === \"\") {\n                delete oldThemeConfig[\"maintainer\"]\n            }\n        }\n\n        return oldThemeConfig\n    }\n}\n\nexport class FixLegacyTheme extends Fuse<LayoutConfigJson> {\n    constructor() {\n        super(\n            \"Fixes a legacy theme to the modern JSON format geared to humans. Syntactic sugars are kept (i.e. no tagRenderings are expandend, no dependencies are automatically gathered)\",\n            new UpdateLegacyTheme(),\n            new On(\"layers\", new Each(new UpdateLegacyLayer()))\n        )\n    }\n}\n","import LayoutConfig from \"../Models/ThemeConfig/LayoutConfig\"\nimport { QueryParameters } from \"./Web/QueryParameters\"\nimport { AllKnownLayouts } from \"../Customizations/AllKnownLayouts\"\nimport { FixedUiElement } from \"../UI/Base/FixedUiElement\"\nimport { Utils } from \"../Utils\"\nimport { UIEventSource } from \"./UIEventSource\"\nimport { LocalStorageSource } from \"./Web/LocalStorageSource\"\nimport LZString from \"lz-string\"\nimport { FixLegacyTheme } from \"../Models/ThemeConfig/Conversion/LegacyJsonConvert\"\nimport { LayerConfigJson } from \"../Models/ThemeConfig/Json/LayerConfigJson\"\nimport known_layers from \"../assets/generated/known_layers.json\"\nimport { PrepareTheme } from \"../Models/ThemeConfig/Conversion/PrepareTheme\"\nimport licenses from \"../assets/generated/license_info.json\"\nimport TagRenderingConfig from \"../Models/ThemeConfig/TagRenderingConfig\"\nimport { FixImages } from \"../Models/ThemeConfig/Conversion/FixImages\"\nimport questions from \"../assets/generated/layers/questions.json\"\nimport {\n    DoesImageExist,\n    PrevalidateTheme,\n    ValidateThemeAndLayers,\n} from \"../Models/ThemeConfig/Conversion/Validation\"\nimport { DesugaringContext } from \"../Models/ThemeConfig/Conversion/Conversion\"\nimport { TagRenderingConfigJson } from \"../Models/ThemeConfig/Json/TagRenderingConfigJson\"\nimport Hash from \"./Web/Hash\"\nimport { QuestionableTagRenderingConfigJson } from \"../Models/ThemeConfig/Json/QuestionableTagRenderingConfigJson\"\n\nexport default class DetermineLayout {\n    private static readonly _knownImages = new Set(Array.from(licenses).map((l) => l.path))\n    private static readonly loadCustomThemeParam = QueryParameters.GetQueryParameter(\n        \"userlayout\",\n        \"false\",\n        \"If not 'false', a custom (non-official) theme is loaded. This custom layout can be done in multiple ways: \\n\\n- The hash of the URL contains a base64-encoded .json-file containing the theme definition\\n- The hash of the URL contains a lz-compressed .json-file, as generated by the custom theme generator\\n- The parameter itself is an URL, in which case that URL will be downloaded. It should point to a .json of a theme\"\n    )\n    public static getCustomDefinition(): string {\n        const layoutFromBase64 = decodeURIComponent(DetermineLayout.loadCustomThemeParam.data)\n\n        if (layoutFromBase64.startsWith(\"http\")) {\n            return layoutFromBase64\n        }\n\n        if (layoutFromBase64 !== \"false\") {\n            // We have to load something from the hash (or from disk)\n            const hash = Hash.hash.data\n            try {\n                JSON.parse(atob(hash))\n                return atob(hash)\n            } catch (e) {\n                // We try to decode with lz-string\n                JSON.parse(Utils.UnMinify(LZString.decompressFromBase64(hash)))\n                return Utils.UnMinify(LZString.decompressFromBase64(hash))\n            }\n        }\n        return undefined\n    }\n\n    /**\n     * Gets the correct layout for this website\n     */\n    public static async GetLayout(): Promise<LayoutConfig | undefined> {\n        const layoutFromBase64 = decodeURIComponent(DetermineLayout.loadCustomThemeParam.data)\n\n        if (layoutFromBase64.startsWith(\"http\")) {\n            return await DetermineLayout.LoadRemoteTheme(layoutFromBase64)\n        }\n\n        if (layoutFromBase64 !== \"false\") {\n            // We have to load something from the hash (or from disk)\n            return DetermineLayout.LoadLayoutFromHash(DetermineLayout.loadCustomThemeParam)\n        }\n\n        let layoutId: string = undefined\n\n        const path = window.location.pathname.split(\"/\").slice(-1)[0]\n        if (path !== \"theme.html\" && path !== \"\") {\n            layoutId = path\n            if (path.endsWith(\".html\")) {\n                layoutId = path.substr(0, path.length - 5)\n            }\n            console.log(\"Using layout\", layoutId)\n        }\n        layoutId = QueryParameters.GetQueryParameter(\n            \"layout\",\n            layoutId,\n            \"The layout to load into MapComplete\"\n        ).data\n        const layout = AllKnownLayouts.allKnownLayouts.get(layoutId?.toLowerCase())\n        if (layout === undefined) {\n            throw \"No builtin map theme with name \" + layoutId + \" exists\"\n        }\n        return layout\n    }\n\n    public static LoadLayoutFromHash(userLayoutParam: UIEventSource<string>): LayoutConfig | null {\n        let hash = location.hash.substr(1)\n        let json: any\n\n        // layoutFromBase64 contains the name of the theme. This is partly to do tracking with goat counter\n        const dedicatedHashFromLocalStorage = LocalStorageSource.Get(\n            \"user-layout-\" + userLayoutParam.data?.replace(\" \", \"_\")\n        )\n        if (dedicatedHashFromLocalStorage.data?.length < 10) {\n            dedicatedHashFromLocalStorage.setData(undefined)\n        }\n\n        const hashFromLocalStorage = LocalStorageSource.Get(\"last-loaded-user-layout\")\n        if (hash.length < 10) {\n            hash = dedicatedHashFromLocalStorage.data ?? hashFromLocalStorage.data\n        } else {\n            console.log(\"Saving hash to local storage\")\n            hashFromLocalStorage.setData(hash)\n            dedicatedHashFromLocalStorage.setData(hash)\n        }\n\n        try {\n            json = JSON.parse(atob(hash))\n        } catch (e) {\n            // We try to decode with lz-string\n            json = JSON.parse(Utils.UnMinify(LZString.decompressFromBase64(hash)))\n        }\n\n        const layoutToUse = DetermineLayout.prepCustomTheme(json)\n        userLayoutParam.setData(layoutToUse.id)\n        return layoutToUse\n    }\n\n    private static getSharedTagRenderings(): Map<string, QuestionableTagRenderingConfigJson> {\n        const dict = new Map<string, QuestionableTagRenderingConfigJson>()\n\n        for (const tagRendering of questions.tagRenderings) {\n            dict.set(tagRendering.id, tagRendering)\n        }\n\n        return dict\n    }\n\n    private static prepCustomTheme(json: any, sourceUrl?: string, forceId?: string): LayoutConfig {\n        if (json.layers === undefined && json.tagRenderings !== undefined) {\n            // We got fed a layer instead of a theme\n            const layerConfig = <LayerConfigJson>json\n            const iconTr: string | TagRenderingConfigJson =\n                <any>(\n                    layerConfig.pointRendering\n                        .map((mr) => mr?.marker?.find((icon) => icon.icon !== undefined)?.icon)\n                        .find((i) => i !== undefined)\n                ) ?? \"bug\"\n            const icon = new TagRenderingConfig(iconTr).render.txt\n            json = {\n                id: json.id,\n                description: json.description,\n                descriptionTail: {\n                    en: \"<div class='alert'>Layer only mode.</div> The loaded custom theme actually isn't a custom theme, but only contains a layer.\",\n                },\n                icon,\n                title: json.name,\n                layers: [json],\n            }\n        }\n\n        const knownLayersDict = new Map<string, LayerConfigJson>()\n        for (const key in known_layers[\"layers\"]) {\n            const layer = known_layers[\"layers\"][key]\n            knownLayersDict.set(layer.id, <LayerConfigJson>layer)\n        }\n        const convertState: DesugaringContext = {\n            tagRenderings: DetermineLayout.getSharedTagRenderings(),\n            sharedLayers: knownLayersDict,\n            publicLayers: new Set<string>(),\n        }\n        json = new FixLegacyTheme().convertStrict(json)\n        const raw = json\n\n        json = new FixImages(DetermineLayout._knownImages).convertStrict(json)\n        json.enableNoteImports = json.enableNoteImports ?? false\n        json = new PrepareTheme(convertState).convertStrict(json)\n        console.log(\"The layoutconfig is \", json)\n\n        json.id = forceId ?? json.id\n\n        {\n            new PrevalidateTheme().convertStrict(json)\n        }\n        {\n            new ValidateThemeAndLayers(\n                new DoesImageExist(new Set<string>(), (_) => true),\n                \"\",\n                false\n            ).convertStrict(json)\n        }\n        return new LayoutConfig(json, false, {\n            definitionRaw: JSON.stringify(raw, null, \"  \"),\n            definedAtUrl: sourceUrl,\n        })\n    }\n\n    private static async LoadRemoteTheme(link: string): Promise<LayoutConfig | null> {\n        console.log(\"Downloading map theme from \", link)\n\n        new FixedUiElement(`Downloading the theme from the <a href=\"${link}\">link</a>...`).AttachTo(\n            \"maindiv\"\n        )\n\n        let parsed = await Utils.downloadJson(link)\n        let forcedId = parsed.id\n        const url = new URL(link)\n        if (!(url.hostname === \"localhost\" || url.hostname === \"127.0.0.1\")) {\n            forcedId = link\n        }\n        console.log(\"Loaded remote link:\", link)\n        return DetermineLayout.prepCustomTheme(parsed, link, forcedId)\n    }\n}\n","import DetermineLayout from \"./Logic/DetermineLayout\"\nimport ThemeViewState from \"./Models/ThemeViewState\"\nimport SvelteUIElement from \"./UI/Base/SvelteUIElement\"\nimport ThemeViewGUI from \"./UI/ThemeViewGUI.svelte\"\nimport { FixedUiElement } from \"./UI/Base/FixedUiElement\"\nimport Combine from \"./UI/Base/Combine\"\nimport { SubtleButton } from \"./UI/Base/SubtleButton\"\nimport { Utils } from \"./Utils\"\nimport Download from \"./assets/svg/Download.svelte\"\nimport Constants from \"./Models/Constants\"\n\nfunction webgl_support() {\n    try {\n        const canvas = document.createElement(\"canvas\")\n        return (\n            !!window.WebGLRenderingContext &&\n            (canvas.getContext(\"webgl\") || canvas.getContext(\"experimental-webgl\"))\n        )\n    } catch (e) {\n        return false\n    }\n}\nasync function getAvailableLayers(): Promise<Set<string>> {\n    try {\n        const host = new URL(Constants.VectorTileServer).host\n        const status = await Utils.downloadJson(\"https://\" + host + \"/summary/status.json\")\n        return new Set<string>(status.layers)\n    } catch (e) {\n        console.error(\"Could not get MVT available layers due to\", e)\n        return new Set<string>()\n    }\n}\nasync function main() {\n    // @ts-ignore\n    try {\n        if (!webgl_support()) {\n            throw \"WebGL is not supported or not enabled. This is essential for MapComplete to function, please enable this.\"\n        }\n        const [layout, availableLayers] = await Promise.all([\n            DetermineLayout.GetLayout(),\n            await getAvailableLayers(),\n        ])\n        console.log(\"The available layers on server are\", Array.from(availableLayers))\n        const state = new ThemeViewState(layout, availableLayers)\n        const main = new SvelteUIElement(ThemeViewGUI, { state })\n        main.AttachTo(\"maindiv\")\n    } catch (err) {\n        console.error(\"Error while initializing: \", err, err.stack)\n        const customDefinition = DetermineLayout.getCustomDefinition()\n        new Combine([\n            new FixedUiElement(err).SetClass(\"block alert\"),\n\n            customDefinition?.length > 0\n                ? new SubtleButton(new SvelteUIElement(Download), \"Download the raw file\").onClick(\n                      () =>\n                          Utils.offerContentsAsDownloadableFile(\n                              DetermineLayout.getCustomDefinition(),\n                              \"mapcomplete-theme.json\",\n                              { mimetype: \"application/json\" }\n                          )\n                  )\n                : undefined,\n        ]).AttachTo(\"maindiv\")\n    }\n}\n\nmain().then((_) => {})\n"],"names":["LZString","f","keyStrBase64","keyStrUriSafe","baseReverseDic","getBaseValue","alphabet","character","i","input","res","a","index","compressed","uncompressed","buf","TotalLen","current_value","result","c","bitsPerChar","getCharFromInt","value","context_dictionary","context_dictionaryToCreate","context_c","context_wc","context_w","context_enlargeIn","context_dictSize","context_numBits","context_data","context_data_val","context_data_position","ii","length","resetValue","getNextValue","dictionary","enlargeIn","dictSize","numBits","entry","w","bits","resb","maxpower","power","data","module","UpdateLegacyLayer","DesugaringStep","json","context","config","preset","preciseInput","tagRendering","_a","location","wayHandling","pointConfig","lineRenderConfig","mapRenderingElement","overlay","pointRenderings","lineRenderings","rendering","pr","iconConfig","icon","Utils","iconPath","color","iconSize","parts","key","UpdateLegacyTheme","oldThemeConfig","FixLegacyTheme","Fuse","On","Each","_DetermineLayout","layoutFromBase64","hash","Hash","layoutId","path","QueryParameters","layout","AllKnownLayouts","userLayoutParam","dedicatedHashFromLocalStorage","LocalStorageSource","_b","hashFromLocalStorage","layoutToUse","dict","questions","sourceUrl","forceId","iconTr","mr","TagRenderingConfig","knownLayersDict","known_layers","layer","convertState","raw","FixImages","PrepareTheme","PrevalidateTheme","ValidateThemeAndLayers","DoesImageExist","_","LayoutConfig","link","FixedUiElement","parsed","forcedId","url","__publicField","licenses","l","DetermineLayout","webgl_support","canvas","getAvailableLayers","host","Constants","status","e","main","availableLayers","state","ThemeViewState","SvelteUIElement","ThemeViewGUI","err","customDefinition","Combine","SubtleButton","Download"],"mappings":"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","x_google_ignoreList":[0]}